2025-11-20 21:48:43,402 - __main__ - INFO - ============================================================
2025-11-20 21:48:43,402 - __main__ - INFO - Starting Notification Service
2025-11-20 21:48:43,402 - __main__ - INFO - ============================================================
2025-11-20 21:48:43,402 - __main__ - INFO - Initializing database...
2025-11-20 21:48:43,402 - data.database - INFO - Initializing database...
2025-11-20 21:48:43,698 - data.database - INFO - Database initialized successfully
2025-11-20 21:48:43,699 - __main__ - INFO - Starting queue listener...
2025-11-20 21:48:43,699 - consumer.queue_listener - INFO - QueueListener initialized for queue: event_notifications
2025-11-20 21:48:43,699 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 21:48:43,731 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 21:48:43,739 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.172.159.105', 59573), raddr=('34.196.5.176', 5672)>
2025-11-20 21:48:43,739 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105c65e80>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105c65e80> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 21:48:43,761 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105c65e80> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 21:48:43,762 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105c65e80> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 21:48:43,762 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105c65e80> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 21:48:43,762 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 21:48:43,784 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 21:48:43,784 - consumer.queue_listener - INFO - Starting to consume messages from queue: event_notifications
2025-11-20 21:48:43,792 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 21:51:34,684 - __main__ - INFO - ============================================================
2025-11-20 21:51:34,684 - __main__ - INFO - Starting Notification Service
2025-11-20 21:51:34,684 - __main__ - INFO - ============================================================
2025-11-20 21:51:34,685 - __main__ - INFO - Initializing database...
2025-11-20 21:51:34,685 - data.database - INFO - Initializing database...
2025-11-20 21:51:34,888 - data.database - INFO - Database initialized successfully
2025-11-20 21:51:34,888 - __main__ - INFO - Starting queue listener...
2025-11-20 21:51:34,888 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-20 21:51:34,888 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 21:51:34,922 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 21:51:34,929 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.172.159.105', 60190), raddr=('34.196.5.176', 5672)>
2025-11-20 21:51:34,929 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x106965d30>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x106965d30> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 21:51:34,951 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x106965d30> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 21:51:34,951 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x106965d30> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 21:51:34,951 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x106965d30> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 21:51:34,952 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 21:51:34,971 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 21:51:34,971 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-20 21:51:34,978 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 21:51:34,984 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-20 21:51:34,984 - consumer.queue_listener - INFO - Processing notification: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 21:51:34,984 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-20 21:51:34,984 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-20 21:51:34,984 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 21:51:34,984 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-20 21:51:34,984 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-20 21:51:35,018 - processor.notification_processor - INFO - Step 3: Total participants to process: 0
2025-11-20 21:51:35,018 - processor.notification_processor - WARNING - No participants found for event_id=bd8814f8-5901-44bf-84a2-65041925f4de
2025-11-20 21:51:35,026 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 21:51:35,033 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-20 21:51:35,033 - consumer.queue_listener - INFO - Processing notification: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 21:51:35,033 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-20 21:51:35,033 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-20 21:51:35,033 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 21:51:35,033 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-20 21:51:35,033 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-20 21:51:35,058 - processor.notification_processor - INFO - Step 3: Total participants to process: 0
2025-11-20 21:51:35,058 - processor.notification_processor - WARNING - No participants found for event_id=bd8814f8-5901-44bf-84a2-65041925f4de
2025-11-20 21:51:35,067 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 21:55:25,863 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-20 21:55:25,866 - consumer.queue_listener - INFO - Processing notification: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 21:55:25,874 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-20 21:55:25,879 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-20 21:55:25,882 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 21:55:25,882 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-20 21:55:25,883 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-20 21:55:25,925 - processor.notification_processor - INFO - Step 3: Total participants to process: 0
2025-11-20 21:55:25,925 - processor.notification_processor - WARNING - No participants found for event_id=10111111-1111-1111-1111-111111111111
2025-11-20 21:55:25,934 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:00:06,517 - __main__ - INFO - ============================================================
2025-11-20 22:00:06,517 - __main__ - INFO - Starting Notification Service
2025-11-20 22:00:06,517 - __main__ - INFO - ============================================================
2025-11-20 22:00:06,517 - __main__ - INFO - Initializing database...
2025-11-20 22:00:06,517 - data.database - INFO - Initializing database...
2025-11-20 22:00:06,752 - data.database - INFO - Database initialized successfully
2025-11-20 22:00:06,752 - __main__ - INFO - Starting queue listener...
2025-11-20 22:00:06,752 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-20 22:00:06,752 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 22:00:06,782 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 22:00:06,790 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.172.159.105', 61990), raddr=('34.196.5.176', 5672)>
2025-11-20 22:00:06,791 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105b31be0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105b31be0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 22:00:06,813 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105b31be0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 22:00:06,813 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105b31be0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 22:00:06,813 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105b31be0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 22:00:06,814 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 22:00:06,841 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 22:00:06,842 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-20 22:00:06,849 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 22:00:09,432 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-20 22:00:09,433 - consumer.queue_listener - INFO - Processing notification: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:00:09,434 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-20 22:00:09,434 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-20 22:00:09,435 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:00:09,435 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-20 22:00:09,435 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-20 22:00:09,461 - processor.notification_processor - INFO - Step 3: Total participants to process: 1
2025-11-20 22:00:09,472 - processor.notification_processor - INFO - Step 4: Processing batch 1 (1 participants, offset=0)
2025-11-20 22:00:09,472 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-20 22:00:09,574 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Server not connected
2025-11-20 22:00:09,574 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 1/3)
2025-11-20 22:00:14,626 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Server not connected
2025-11-20 22:00:14,626 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 2/3)
2025-11-20 22:00:19,695 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Server not connected
2025-11-20 22:00:19,695 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 3/3)
2025-11-20 22:00:24,744 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Server not connected
2025-11-20 22:00:24,746 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu after 3 retries
2025-11-20 22:00:24,746 - email_service.email_service - INFO - Batch email results: 0 successful, 1 failed
2025-11-20 22:00:24,746 - processor.notification_processor - INFO - Batch 1 complete: 0 sent, 1 failed
2025-11-20 22:00:24,756 - processor.notification_processor - INFO - No more participants to process
2025-11-20 22:00:24,756 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 0 emails sent successfully, 1 failed out of 1 total
2025-11-20 22:00:24,764 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:02:00,697 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-20 22:02:00,699 - consumer.queue_listener - INFO - Processing notification: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:02:00,699 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-20 22:02:00,699 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-20 22:02:00,701 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:02:00,701 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-20 22:02:00,701 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-20 22:02:00,746 - processor.notification_processor - INFO - Step 3: Total participants to process: 2
2025-11-20 22:02:00,755 - processor.notification_processor - INFO - Step 4: Processing batch 1 (2 participants, offset=0)
2025-11-20 22:02:00,755 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-20 22:02:00,822 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Server not connected
2025-11-20 22:02:00,822 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 1/3)
2025-11-20 22:02:00,831 - email_service.email_service - ERROR - Failed to send email to chethanr2000@gmail.com: Server not connected
2025-11-20 22:02:00,831 - email_service.email_service - INFO - Retrying email to chethanr2000@gmail.com (attempt 1/3)
2025-11-20 22:02:05,881 - email_service.email_service - ERROR - Failed to send email to chethanr2000@gmail.com: Server not connected
2025-11-20 22:02:05,881 - email_service.email_service - INFO - Retrying email to chethanr2000@gmail.com (attempt 2/3)
2025-11-20 22:02:05,891 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Server not connected
2025-11-20 22:02:05,891 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 2/3)
2025-11-20 22:02:10,940 - email_service.email_service - ERROR - Failed to send email to chethanr2000@gmail.com: Server not connected
2025-11-20 22:02:10,941 - email_service.email_service - INFO - Retrying email to chethanr2000@gmail.com (attempt 3/3)
2025-11-20 22:02:10,949 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Server not connected
2025-11-20 22:02:10,949 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 3/3)
2025-11-20 22:02:16,003 - email_service.email_service - ERROR - Failed to send email to chethanr2000@gmail.com: Server not connected
2025-11-20 22:02:16,003 - email_service.email_service - ERROR - Failed to send email to chethanr2000@gmail.com after 3 retries
2025-11-20 22:02:16,006 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Server not connected
2025-11-20 22:02:16,007 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu after 3 retries
2025-11-20 22:02:16,007 - email_service.email_service - INFO - Batch email results: 0 successful, 2 failed
2025-11-20 22:02:16,007 - processor.notification_processor - INFO - Batch 1 complete: 0 sent, 2 failed
2025-11-20 22:02:16,014 - processor.notification_processor - INFO - No more participants to process
2025-11-20 22:02:16,014 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 0 emails sent successfully, 2 failed out of 2 total
2025-11-20 22:02:16,023 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:08:45,975 - __main__ - INFO - ============================================================
2025-11-20 22:08:45,975 - __main__ - INFO - Starting Notification Service
2025-11-20 22:08:45,975 - __main__ - INFO - ============================================================
2025-11-20 22:08:45,975 - __main__ - INFO - Initializing database...
2025-11-20 22:08:45,975 - data.database - INFO - Initializing database...
2025-11-20 22:08:46,613 - data.database - INFO - Database initialized successfully
2025-11-20 22:08:46,613 - __main__ - INFO - Starting queue listener...
2025-11-20 22:08:46,613 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-20 22:08:46,613 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 22:08:46,671 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 22:08:46,678 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.172.159.105', 63827), raddr=('34.196.5.176', 5672)>
2025-11-20 22:08:46,679 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103af9be0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103af9be0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 22:08:46,700 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103af9be0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 22:08:46,700 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103af9be0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 22:08:46,700 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103af9be0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 22:08:46,701 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 22:08:46,722 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 22:08:46,722 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-20 22:08:46,729 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 22:08:54,274 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-20 22:08:54,275 - consumer.queue_listener - INFO - Processing notification: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:08:54,275 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-20 22:08:54,276 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-20 22:08:54,277 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:08:54,277 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-20 22:08:54,277 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-20 22:08:54,320 - processor.notification_processor - INFO - Step 3: Total participants to process: 2
2025-11-20 22:08:54,334 - processor.notification_processor - INFO - Step 4: Processing batch 1 (2 participants, offset=0)
2025-11-20 22:08:54,334 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-20 22:08:54,428 - email_service.email_service - ERROR - Failed to send email to chethanr2000@gmail.com: Server not connected
2025-11-20 22:08:54,428 - email_service.email_service - INFO - Retrying email to chethanr2000@gmail.com (attempt 1/3)
2025-11-20 22:08:54,431 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Server not connected
2025-11-20 22:08:54,431 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 1/3)
2025-11-20 22:08:59,498 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Server not connected
2025-11-20 22:08:59,498 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 2/3)
2025-11-20 22:08:59,499 - email_service.email_service - ERROR - Failed to send email to chethanr2000@gmail.com: Server not connected
2025-11-20 22:08:59,499 - email_service.email_service - INFO - Retrying email to chethanr2000@gmail.com (attempt 2/3)
2025-11-20 22:09:04,561 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Server not connected
2025-11-20 22:09:04,562 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 3/3)
2025-11-20 22:09:04,566 - email_service.email_service - ERROR - Failed to send email to chethanr2000@gmail.com: Server not connected
2025-11-20 22:09:04,566 - email_service.email_service - INFO - Retrying email to chethanr2000@gmail.com (attempt 3/3)
2025-11-20 22:09:09,627 - email_service.email_service - ERROR - Failed to send email to chethanr2000@gmail.com: Server not connected
2025-11-20 22:09:09,628 - email_service.email_service - ERROR - Failed to send email to chethanr2000@gmail.com after 3 retries
2025-11-20 22:09:09,633 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Server not connected
2025-11-20 22:09:09,633 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu after 3 retries
2025-11-20 22:09:09,633 - email_service.email_service - INFO - Batch email results: 0 successful, 2 failed
2025-11-20 22:09:09,633 - processor.notification_processor - INFO - Batch 1 complete: 0 sent, 2 failed
2025-11-20 22:09:09,645 - processor.notification_processor - INFO - No more participants to process
2025-11-20 22:09:09,645 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 0 emails sent successfully, 2 failed out of 2 total
2025-11-20 22:09:09,661 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:12:58,331 - __main__ - INFO - ============================================================
2025-11-20 22:12:58,331 - __main__ - INFO - Starting Notification Service
2025-11-20 22:12:58,331 - __main__ - INFO - ============================================================
2025-11-20 22:12:58,331 - __main__ - INFO - Initializing database...
2025-11-20 22:12:58,331 - data.database - INFO - Initializing database...
2025-11-20 22:12:58,525 - data.database - INFO - Database initialized successfully
2025-11-20 22:12:58,525 - __main__ - INFO - Starting queue listener...
2025-11-20 22:12:58,525 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-20 22:12:58,525 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 22:12:58,549 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 22:12:58,556 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.172.159.105', 64712), raddr=('34.196.5.176', 5672)>
2025-11-20 22:12:58,557 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103841be0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103841be0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 22:12:59,045 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103841be0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 22:12:59,045 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103841be0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 22:12:59,045 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103841be0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 22:12:59,046 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 22:12:59,066 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 22:12:59,067 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-20 22:12:59,074 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 22:13:02,876 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-20 22:13:02,876 - consumer.queue_listener - INFO - Processing notification: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:13:02,876 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-20 22:13:02,876 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-20 22:13:02,877 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:13:02,877 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-20 22:13:02,877 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-20 22:13:02,903 - processor.notification_processor - INFO - Step 3: Total participants to process: 2
2025-11-20 22:13:02,914 - processor.notification_processor - INFO - Step 4: Processing batch 1 (2 participants, offset=0)
2025-11-20 22:13:02,915 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-20 22:13:04,093 - email_service.email_service - INFO - Email sent successfully to chethanr2000@gmail.com
2025-11-20 22:13:04,431 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-20 22:13:04,432 - email_service.email_service - INFO - Batch email results: 2 successful, 0 failed
2025-11-20 22:13:04,432 - processor.notification_processor - INFO - Batch 1 complete: 2 sent, 0 failed
2025-11-20 22:13:04,440 - processor.notification_processor - INFO - No more participants to process
2025-11-20 22:13:04,440 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 2 emails sent successfully, 0 failed out of 2 total
2025-11-20 22:13:04,449 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 22:55:55,322 - __main__ - INFO - ============================================================
2025-11-20 22:55:55,322 - __main__ - INFO - Starting Notification Service
2025-11-20 22:55:55,322 - __main__ - INFO - ============================================================
2025-11-20 22:55:55,322 - __main__ - INFO - Initializing database...
2025-11-20 22:55:55,322 - data.database - INFO - Initializing database...
2025-11-20 22:55:56,165 - data.database - INFO - Database initialized successfully
2025-11-20 22:55:56,165 - __main__ - INFO - Database initialized successfully
2025-11-20 22:55:56,165 - __main__ - INFO - Starting reminder scheduler...
2025-11-20 22:55:56,165 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-20 22:55:56,171 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-20 22:55:56,172 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-20 22:55:56,172 - apscheduler.scheduler - INFO - Scheduler started
2025-11-20 22:55:56,172 - scheduler.reminder_scheduler - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 22:55:56,172 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 22:55:56,173 - __main__ - INFO - Starting queue listener...
2025-11-20 22:55:56,173 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-20 22:55:56,173 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 22:55:56,185 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 22:55:56,191 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.172.159.105', 57091), raddr=('34.196.5.176', 5672)>
2025-11-20 22:55:56,192 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1044463c0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1044463c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 22:55:56,212 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1044463c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 22:55:56,212 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1044463c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 22:55:56,212 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1044463c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 22:55:56,212 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 22:55:56,231 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 22:55:56,231 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-20 22:55:56,238 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 23:04:07,155 - __main__ - INFO - ============================================================
2025-11-20 23:04:07,155 - __main__ - INFO - Starting Notification Service
2025-11-20 23:04:07,155 - __main__ - INFO - ============================================================
2025-11-20 23:04:07,155 - __main__ - INFO - Initializing database...
2025-11-20 23:04:07,155 - data.database - INFO - Initializing database...
2025-11-20 23:04:08,495 - data.database - INFO - Database initialized successfully
2025-11-20 23:04:08,496 - __main__ - INFO - Database initialized successfully
2025-11-20 23:04:08,496 - __main__ - INFO - Starting reminder scheduler...
2025-11-20 23:04:08,496 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-20 23:04:08,502 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-20 23:04:08,503 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-20 23:04:08,503 - apscheduler.scheduler - INFO - Scheduler started
2025-11-20 23:04:08,503 - scheduler.reminder_scheduler - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 23:04:08,503 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 23:04:08,503 - __main__ - INFO - Starting queue listener...
2025-11-20 23:04:08,503 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-20 23:04:08,503 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 23:04:08,517 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:04:08,525 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.172.159.105', 58842), raddr=('34.196.5.176', 5672)>
2025-11-20 23:04:08,525 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10422e510>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10422e510> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:04:08,546 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10422e510> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:04:08,546 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10422e510> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:04:08,546 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10422e510> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:04:08,546 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:04:08,567 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 23:04:08,567 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-20 23:04:08,574 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 23:05:08,508 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:06:08 EST)" (scheduled at 2025-11-20 23:05:08.502134-05:00)
2025-11-20 23:05:08,510 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:05:08,555 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:06:08 EST)" executed successfully
2025-11-20 23:06:08,509 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:07:08 EST)" (scheduled at 2025-11-20 23:06:08.502134-05:00)
2025-11-20 23:06:08,511 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:06:08,563 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:07:08 EST)" executed successfully
2025-11-20 23:07:08,509 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:08:08 EST)" (scheduled at 2025-11-20 23:07:08.502134-05:00)
2025-11-20 23:07:08,512 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:07:08,565 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:08:08 EST)" executed successfully
2025-11-20 23:08:08,507 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:09:08 EST)" (scheduled at 2025-11-20 23:08:08.502134-05:00)
2025-11-20 23:08:08,509 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:08:08,542 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:09:08 EST)" executed successfully
2025-11-20 23:09:08,511 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:10:08 EST)" (scheduled at 2025-11-20 23:09:08.502134-05:00)
2025-11-20 23:09:08,516 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:09:08,554 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:10:08 EST)" executed successfully
2025-11-20 23:10:08,508 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:11:08 EST)" (scheduled at 2025-11-20 23:10:08.502134-05:00)
2025-11-20 23:10:08,510 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:10:08,542 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:11:08 EST)" executed successfully
2025-11-20 23:13:48,860 - __main__ - INFO - ============================================================
2025-11-20 23:13:48,861 - __main__ - INFO - Starting Notification Service
2025-11-20 23:13:48,861 - __main__ - INFO - ============================================================
2025-11-20 23:13:48,861 - __main__ - INFO - Initializing database...
2025-11-20 23:13:48,861 - data.database - INFO - Initializing database...
2025-11-20 23:13:49,248 - data.database - INFO - Database initialized successfully
2025-11-20 23:13:49,249 - __main__ - INFO - Database initialized successfully
2025-11-20 23:13:49,249 - __main__ - INFO - Starting reminder scheduler...
2025-11-20 23:13:49,249 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-20 23:13:49,256 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-20 23:13:49,256 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-20 23:13:49,256 - apscheduler.scheduler - INFO - Scheduler started
2025-11-20 23:13:49,257 - scheduler.reminder_scheduler - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 23:13:49,257 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 23:13:49,257 - __main__ - INFO - Starting queue listener...
2025-11-20 23:13:49,257 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-20 23:13:49,257 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 23:13:49,276 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:13:49,283 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.172.159.105', 60891), raddr=('34.196.5.176', 5672)>
2025-11-20 23:13:49,284 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108202510>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108202510> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:13:49,304 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108202510> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:13:49,304 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108202510> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:13:49,304 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108202510> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:13:49,304 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:13:49,325 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 23:13:49,325 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-20 23:13:49,331 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 23:14:49,264 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:15:49 EST)" (scheduled at 2025-11-20 23:14:49.256027-05:00)
2025-11-20 23:14:49,265 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:14:49,315 - scheduler.reminder_scheduler - INFO - Found 1 pending one-day reminders
2025-11-20 23:14:49,354 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:14:49,362 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61096), raddr=('34.196.5.176', 5672)>
2025-11-20 23:14:49,365 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082120d0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082120d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:14:49,386 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082120d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:14:49,386 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082120d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:14:49,386 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082120d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:14:49,386 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:14:49,402 - scheduler.queue_publisher - ERROR - Failed to publish reminder for event bd8814f8-5901-44bf-84a2-65041925f4de: Object of type UUID is not JSON serializable
2025-11-20 23:14:49,402 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082120d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:14:49,408 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082120d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:14:49,408 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:14:49,408 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:14:49,414 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61096), raddr=('34.196.5.176', 5672)>
2025-11-20 23:14:49,415 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61096), raddr=('34.196.5.176', 5672)>
2025-11-20 23:14:49,415 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61096), raddr=('34.196.5.176', 5672)>
2025-11-20 23:14:49,415 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:14:49,415 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:14:49,415 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61096), raddr=('34.196.5.176', 5672)>
2025-11-20 23:14:49,415 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:14:49,424 - scheduler.reminder_scheduler - INFO - Found 1 pending one-hour reminders
2025-11-20 23:14:49,426 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:14:49,433 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61099), raddr=('34.196.5.176', 5672)>
2025-11-20 23:14:49,434 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108213390>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108213390> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:14:49,455 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108213390> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:14:49,455 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108213390> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:14:49,455 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108213390> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:14:49,455 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:14:49,469 - scheduler.queue_publisher - ERROR - Failed to publish reminder for event bd8814f8-5901-44bf-84a2-65041925f4de: Object of type UUID is not JSON serializable
2025-11-20 23:14:49,469 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108213390> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:14:49,476 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108213390> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:14:49,476 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:14:49,476 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:14:49,483 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61099), raddr=('34.196.5.176', 5672)>
2025-11-20 23:14:49,483 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61099), raddr=('34.196.5.176', 5672)>
2025-11-20 23:14:49,483 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61099), raddr=('34.196.5.176', 5672)>
2025-11-20 23:14:49,483 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:14:49,483 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:14:49,483 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61099), raddr=('34.196.5.176', 5672)>
2025-11-20 23:14:49,484 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:14:49,491 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:15:49 EST)" executed successfully
2025-11-20 23:15:49,261 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:16:49 EST)" (scheduled at 2025-11-20 23:15:49.256027-05:00)
2025-11-20 23:15:49,264 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:15:49,283 - scheduler.reminder_scheduler - INFO - Found 1 pending one-day reminders
2025-11-20 23:15:49,299 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:15:49,306 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61299), raddr=('34.196.5.176', 5672)>
2025-11-20 23:15:49,307 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108244c30>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108244c30> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:15:49,329 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108244c30> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:15:49,329 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108244c30> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:15:49,329 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108244c30> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:15:49,330 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:15:49,346 - scheduler.queue_publisher - ERROR - Failed to publish reminder for event bd8814f8-5901-44bf-84a2-65041925f4de: Object of type UUID is not JSON serializable
2025-11-20 23:15:49,346 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108244c30> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:15:49,353 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108244c30> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:15:49,353 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:15:49,353 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:15:49,360 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61299), raddr=('34.196.5.176', 5672)>
2025-11-20 23:15:49,360 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61299), raddr=('34.196.5.176', 5672)>
2025-11-20 23:15:49,361 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61299), raddr=('34.196.5.176', 5672)>
2025-11-20 23:15:49,361 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:15:49,361 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:15:49,361 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61299), raddr=('34.196.5.176', 5672)>
2025-11-20 23:15:49,361 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:15:49,369 - scheduler.reminder_scheduler - INFO - Found 1 pending one-hour reminders
2025-11-20 23:15:49,370 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:15:49,377 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61302), raddr=('34.196.5.176', 5672)>
2025-11-20 23:15:49,378 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108245ba0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108245ba0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:15:49,401 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108245ba0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:15:49,402 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108245ba0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:15:49,402 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108245ba0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:15:49,402 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:15:49,420 - scheduler.queue_publisher - ERROR - Failed to publish reminder for event bd8814f8-5901-44bf-84a2-65041925f4de: Object of type UUID is not JSON serializable
2025-11-20 23:15:49,420 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108245ba0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:15:49,428 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108245ba0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:15:49,428 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:15:49,428 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:15:49,435 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61302), raddr=('34.196.5.176', 5672)>
2025-11-20 23:15:49,436 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61302), raddr=('34.196.5.176', 5672)>
2025-11-20 23:15:49,436 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61302), raddr=('34.196.5.176', 5672)>
2025-11-20 23:15:49,436 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:15:49,436 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:15:49,436 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61302), raddr=('34.196.5.176', 5672)>
2025-11-20 23:15:49,436 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:15:49,443 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:16:49 EST)" executed successfully
2025-11-20 23:16:49,263 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:17:49 EST)" (scheduled at 2025-11-20 23:16:49.256027-05:00)
2025-11-20 23:16:49,265 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:16:49,307 - scheduler.reminder_scheduler - INFO - Found 1 pending one-day reminders
2025-11-20 23:16:49,336 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:16:49,344 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61523), raddr=('34.196.5.176', 5672)>
2025-11-20 23:16:49,344 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10820e570>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10820e570> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:16:49,370 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10820e570> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:16:49,370 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10820e570> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:16:49,370 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10820e570> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:16:49,370 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:16:49,385 - scheduler.queue_publisher - ERROR - Failed to publish reminder for event bd8814f8-5901-44bf-84a2-65041925f4de: Object of type UUID is not JSON serializable
2025-11-20 23:16:49,385 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10820e570> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:16:49,392 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10820e570> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:16:49,392 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:16:49,392 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:16:49,403 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61523), raddr=('34.196.5.176', 5672)>
2025-11-20 23:16:49,403 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61523), raddr=('34.196.5.176', 5672)>
2025-11-20 23:16:49,403 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61523), raddr=('34.196.5.176', 5672)>
2025-11-20 23:16:49,403 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:16:49,403 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:16:49,403 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61523), raddr=('34.196.5.176', 5672)>
2025-11-20 23:16:49,404 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:16:49,414 - scheduler.reminder_scheduler - INFO - Found 1 pending one-hour reminders
2025-11-20 23:16:49,417 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:16:49,423 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61526), raddr=('34.196.5.176', 5672)>
2025-11-20 23:16:49,424 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082548d0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082548d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:16:49,444 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082548d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:16:49,444 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082548d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:16:49,444 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082548d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:16:49,444 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:16:49,457 - scheduler.queue_publisher - ERROR - Failed to publish reminder for event bd8814f8-5901-44bf-84a2-65041925f4de: Object of type UUID is not JSON serializable
2025-11-20 23:16:49,457 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082548d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:16:49,532 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1082548d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:16:49,532 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:16:49,532 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:16:49,541 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61526), raddr=('34.196.5.176', 5672)>
2025-11-20 23:16:49,541 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61526), raddr=('34.196.5.176', 5672)>
2025-11-20 23:16:49,541 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61526), raddr=('34.196.5.176', 5672)>
2025-11-20 23:16:49,541 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:16:49,541 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:16:49,541 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61526), raddr=('34.196.5.176', 5672)>
2025-11-20 23:16:49,541 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:16:49,549 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:17:49 EST)" executed successfully
2025-11-20 23:17:49,263 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:18:49 EST)" (scheduled at 2025-11-20 23:17:49.256027-05:00)
2025-11-20 23:17:49,265 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:17:49,290 - scheduler.reminder_scheduler - INFO - Found 1 pending one-day reminders
2025-11-20 23:17:49,329 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:17:49,337 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61718), raddr=('34.196.5.176', 5672)>
2025-11-20 23:17:49,337 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108255370>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108255370> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:17:49,360 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108255370> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:17:49,360 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108255370> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:17:49,360 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108255370> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:17:49,361 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:17:49,375 - scheduler.queue_publisher - ERROR - Failed to publish reminder for event bd8814f8-5901-44bf-84a2-65041925f4de: Object of type UUID is not JSON serializable
2025-11-20 23:17:49,375 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108255370> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:17:49,382 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108255370> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:17:49,382 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:17:49,382 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:17:49,390 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61718), raddr=('34.196.5.176', 5672)>
2025-11-20 23:17:49,390 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61718), raddr=('34.196.5.176', 5672)>
2025-11-20 23:17:49,390 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61718), raddr=('34.196.5.176', 5672)>
2025-11-20 23:17:49,390 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:17:49,390 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:17:49,390 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61718), raddr=('34.196.5.176', 5672)>
2025-11-20 23:17:49,390 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:17:49,398 - scheduler.reminder_scheduler - INFO - Found 1 pending one-hour reminders
2025-11-20 23:17:49,400 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:17:49,407 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61721), raddr=('34.196.5.176', 5672)>
2025-11-20 23:17:49,407 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081f6b50>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081f6b50> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:17:49,428 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081f6b50> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:17:49,428 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081f6b50> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:17:49,428 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081f6b50> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:17:49,428 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:17:49,442 - scheduler.queue_publisher - ERROR - Failed to publish reminder for event bd8814f8-5901-44bf-84a2-65041925f4de: Object of type UUID is not JSON serializable
2025-11-20 23:17:49,442 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081f6b50> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:17:49,448 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081f6b50> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:17:49,449 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:17:49,449 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:17:49,455 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61721), raddr=('34.196.5.176', 5672)>
2025-11-20 23:17:49,456 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61721), raddr=('34.196.5.176', 5672)>
2025-11-20 23:17:49,456 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61721), raddr=('34.196.5.176', 5672)>
2025-11-20 23:17:49,456 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:17:49,456 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:17:49,456 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 61721), raddr=('34.196.5.176', 5672)>
2025-11-20 23:17:49,456 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:17:49,464 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:18:49 EST)" executed successfully
2025-11-20 23:20:11,889 - __main__ - INFO - ============================================================
2025-11-20 23:20:11,889 - __main__ - INFO - Starting Notification Service
2025-11-20 23:20:11,889 - __main__ - INFO - ============================================================
2025-11-20 23:20:11,889 - __main__ - INFO - Initializing database...
2025-11-20 23:20:11,889 - data.database - INFO - Initializing database...
2025-11-20 23:20:12,315 - data.database - INFO - Database initialized successfully
2025-11-20 23:20:12,315 - __main__ - INFO - Database initialized successfully
2025-11-20 23:20:12,315 - __main__ - INFO - Starting reminder scheduler...
2025-11-20 23:20:12,315 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-20 23:20:12,324 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-20 23:20:12,325 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-20 23:20:12,325 - apscheduler.scheduler - INFO - Scheduler started
2025-11-20 23:20:12,326 - scheduler.reminder_scheduler - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 23:20:12,326 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 23:20:12,326 - __main__ - INFO - Starting queue listener...
2025-11-20 23:20:12,326 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-20 23:20:12,326 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 23:20:12,349 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:20:12,367 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.172.159.105', 62144), raddr=('34.196.5.176', 5672)>
2025-11-20 23:20:12,368 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1055323c0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1055323c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:20:12,390 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1055323c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:20:12,390 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1055323c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:20:12,390 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1055323c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:20:12,390 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:20:12,412 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 23:20:12,412 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-20 23:20:12,419 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 23:21:12,333 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:22:12 EST)" (scheduled at 2025-11-20 23:21:12.324321-05:00)
2025-11-20 23:21:12,338 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:21:12,381 - scheduler.reminder_scheduler - INFO - Found 1 pending one-day reminders
2025-11-20 23:21:12,428 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:21:12,436 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 62244), raddr=('34.196.5.176', 5672)>
2025-11-20 23:21:12,437 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105541d10>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105541d10> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:21:12,468 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105541d10> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:21:12,468 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105541d10> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:21:12,468 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105541d10> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:21:12,469 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:21:12,495 - scheduler.queue_publisher - INFO - Published reminder: event_id=bd8814f8-5901-44bf-84a2-65041925f4de, type=one_day
2025-11-20 23:21:12,505 - consumer.queue_listener - INFO - Received message: {"type": "event_reminder", "event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "reminder_type": "one_day"}
2025-11-20 23:21:12,505 - consumer.queue_listener - ERROR - Invalid message format: Missing required field: 'event'
2025-11-20 23:21:12,516 - scheduler.reminder_scheduler - INFO - Sent one-day reminder for event bd8814f8-5901-44bf-84a2-65041925f4de
2025-11-20 23:21:12,517 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105541d10> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:21:12,526 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105541d10> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:21:12,526 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:21:12,526 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:21:12,532 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 62244), raddr=('34.196.5.176', 5672)>
2025-11-20 23:21:12,532 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 62244), raddr=('34.196.5.176', 5672)>
2025-11-20 23:21:12,532 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 62244), raddr=('34.196.5.176', 5672)>
2025-11-20 23:21:12,532 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:21:12,533 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:21:12,533 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 62244), raddr=('34.196.5.176', 5672)>
2025-11-20 23:21:12,533 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:21:12,551 - scheduler.reminder_scheduler - INFO - Found 1 pending one-hour reminders
2025-11-20 23:21:12,554 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:21:12,569 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 62247), raddr=('34.196.5.176', 5672)>
2025-11-20 23:21:12,569 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105543250>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105543250> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:21:12,602 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105543250> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:21:12,602 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105543250> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:21:12,602 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105543250> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:21:12,602 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:21:12,618 - scheduler.queue_publisher - INFO - Published reminder: event_id=bd8814f8-5901-44bf-84a2-65041925f4de, type=one_hour
2025-11-20 23:21:12,627 - consumer.queue_listener - INFO - Received message: {"type": "event_reminder", "event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "reminder_type": "one_hour"}
2025-11-20 23:21:12,627 - consumer.queue_listener - ERROR - Invalid message format: Missing required field: 'event'
2025-11-20 23:21:12,635 - scheduler.reminder_scheduler - INFO - Sent one-hour reminder for event bd8814f8-5901-44bf-84a2-65041925f4de
2025-11-20 23:21:12,635 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105543250> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:21:12,644 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105543250> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:21:12,644 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:21:12,644 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:21:12,653 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 62247), raddr=('34.196.5.176', 5672)>
2025-11-20 23:21:12,653 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 62247), raddr=('34.196.5.176', 5672)>
2025-11-20 23:21:12,653 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 62247), raddr=('34.196.5.176', 5672)>
2025-11-20 23:21:12,653 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:21:12,653 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:21:12,653 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 62247), raddr=('34.196.5.176', 5672)>
2025-11-20 23:21:12,653 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:21:12,653 - scheduler.reminder_scheduler - INFO - Reminder check complete: 1 one-day, 1 one-hour reminders sent
2025-11-20 23:21:12,653 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:22:12 EST)" executed successfully
2025-11-20 23:22:12,332 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:23:12 EST)" (scheduled at 2025-11-20 23:22:12.324321-05:00)
2025-11-20 23:22:12,334 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:22:12,386 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:23:12 EST)" executed successfully
2025-11-20 23:24:28,245 - __main__ - INFO - ============================================================
2025-11-20 23:24:28,246 - __main__ - INFO - Starting Notification Service
2025-11-20 23:24:28,246 - __main__ - INFO - ============================================================
2025-11-20 23:24:28,246 - __main__ - INFO - Initializing database...
2025-11-20 23:24:28,246 - data.database - INFO - Initializing database...
2025-11-20 23:24:28,630 - data.database - INFO - Database initialized successfully
2025-11-20 23:24:28,631 - __main__ - INFO - Database initialized successfully
2025-11-20 23:24:28,631 - __main__ - INFO - Starting reminder scheduler...
2025-11-20 23:24:28,631 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-20 23:24:28,637 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-20 23:24:28,637 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-20 23:24:28,638 - apscheduler.scheduler - INFO - Scheduler started
2025-11-20 23:24:28,638 - scheduler.reminder_scheduler - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 23:24:28,638 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 23:24:28,638 - __main__ - INFO - Starting queue listener...
2025-11-20 23:24:28,638 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-20 23:24:28,638 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-20 23:24:28,638 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-20 23:24:28,638 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 23:24:29,459 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:24:29,467 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.172.159.105', 62755), raddr=('34.196.5.176', 5672)>
2025-11-20 23:24:29,467 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10474a660>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10474a660> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:24:29,514 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10474a660> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:24:29,514 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10474a660> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:24:29,514 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10474a660> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:24:29,515 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:24:29,546 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 23:24:29,546 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-20 23:24:29,553 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 23:25:12,805 - __main__ - INFO - ============================================================
2025-11-20 23:25:12,805 - __main__ - INFO - Starting Notification Service
2025-11-20 23:25:12,805 - __main__ - INFO - ============================================================
2025-11-20 23:25:12,805 - __main__ - INFO - Initializing database...
2025-11-20 23:25:12,805 - data.database - INFO - Initializing database...
2025-11-20 23:25:13,176 - data.database - INFO - Database initialized successfully
2025-11-20 23:25:13,176 - __main__ - INFO - Database initialized successfully
2025-11-20 23:25:13,176 - __main__ - INFO - Starting reminder scheduler...
2025-11-20 23:25:13,176 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-20 23:25:13,181 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-20 23:25:13,182 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-20 23:25:13,182 - apscheduler.scheduler - INFO - Scheduler started
2025-11-20 23:25:13,182 - scheduler.reminder_scheduler - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 23:25:13,182 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 23:25:13,182 - __main__ - INFO - Starting queue listener...
2025-11-20 23:25:13,182 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-20 23:25:13,182 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-20 23:25:13,182 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-20 23:25:13,182 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 23:25:13,198 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:25:13,204 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.172.159.105', 62899), raddr=('34.196.5.176', 5672)>
2025-11-20 23:25:13,205 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10634a660>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10634a660> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:25:13,227 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10634a660> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:25:13,227 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10634a660> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:25:13,227 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10634a660> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:25:13,227 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:25:13,248 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 23:25:13,248 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-20 23:25:13,254 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 23:26:13,186 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:27:13 EST)" (scheduled at 2025-11-20 23:26:13.181205-05:00)
2025-11-20 23:26:13,188 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:26:13,212 - scheduler.reminder_scheduler - INFO - Found 1 pending one-day reminders
2025-11-20 23:26:13,221 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:26:13,237 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 63115), raddr=('34.196.5.176', 5672)>
2025-11-20 23:26:13,238 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x106359d10>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x106359d10> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:26:13,279 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x106359d10> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:26:13,279 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x106359d10> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:26:13,279 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x106359d10> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:26:13,279 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:26:13,311 - scheduler.queue_publisher - INFO - Published reminder: event_id=bd8814f8-5901-44bf-84a2-65041925f4de, type=one_day
2025-11-20 23:26:13,318 - consumer.queue_listener - INFO - Received message: {"type": "event_reminder", "event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "reminder_type": "one_day"}
2025-11-20 23:26:13,332 - scheduler.reminder_scheduler - INFO - Sent one-day reminder for event bd8814f8-5901-44bf-84a2-65041925f4de
2025-11-20 23:26:13,332 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x106359d10> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:26:13,334 - consumer.queue_listener - INFO - Enriched reminder message with event details
2025-11-20 23:26:13,339 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x106359d10> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:26:13,339 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:26:13,339 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:26:13,343 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 23:26:13,343 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-20 23:26:13,343 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_reminder
2025-11-20 23:26:13,346 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 63115), raddr=('34.196.5.176', 5672)>
2025-11-20 23:26:13,347 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 63115), raddr=('34.196.5.176', 5672)>
2025-11-20 23:26:13,347 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 63115), raddr=('34.196.5.176', 5672)>
2025-11-20 23:26:13,347 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:26:13,348 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:26:13,348 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 63115), raddr=('34.196.5.176', 5672)>
2025-11-20 23:26:13,348 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:26:13,357 - processor.notification_processor - INFO - Step 3: Total participants to process: 1
2025-11-20 23:26:13,367 - processor.notification_processor - INFO - Step 4: Processing batch 1 (1 participants, offset=0)
2025-11-20 23:26:13,367 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-20 23:26:13,373 - scheduler.reminder_scheduler - INFO - Reminder check complete: 1 one-day, 0 one-hour reminders sent
2025-11-20 23:26:13,374 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: interval[0:01:00], next run at: 2025-11-20 23:27:13 EST)" executed successfully
2025-11-20 23:26:14,551 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-20 23:26:14,552 - email_service.email_service - INFO - Batch email results: 1 successful, 0 failed
2025-11-20 23:26:14,552 - processor.notification_processor - INFO - Batch 1 complete: 1 sent, 0 failed
2025-11-20 23:26:14,560 - processor.notification_processor - INFO - No more participants to process
2025-11-20 23:26:14,560 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 1 emails sent successfully, 0 failed out of 1 total
2025-11-20 23:26:14,569 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 23:37:46,848 - __main__ - INFO - ============================================================
2025-11-20 23:37:46,848 - __main__ - INFO - Starting Notification Service
2025-11-20 23:37:46,848 - __main__ - INFO - ============================================================
2025-11-20 23:37:46,848 - __main__ - INFO - Initializing database...
2025-11-20 23:37:46,848 - data.database - INFO - Initializing database...
2025-11-20 23:37:47,733 - data.database - INFO - Database initialized successfully
2025-11-20 23:37:47,733 - __main__ - INFO - Database initialized successfully
2025-11-20 23:37:47,733 - __main__ - INFO - Starting reminder scheduler...
2025-11-20 23:37:47,733 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-20 23:37:47,741 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-20 23:37:47,742 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-20 23:37:47,742 - apscheduler.scheduler - INFO - Scheduler started
2025-11-20 23:37:47,743 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-11-20 23:37:47,743 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 23:37:47,743 - __main__ - INFO - Starting queue listener...
2025-11-20 23:37:47,743 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-20 23:37:47,743 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-20 23:37:47,743 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-20 23:37:47,743 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 23:37:47,762 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:37:47,769 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.172.159.105', 49172), raddr=('34.196.5.176', 5672)>
2025-11-20 23:37:47,769 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104f4f380>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104f4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:37:47,790 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104f4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:37:47,790 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104f4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:37:47,790 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104f4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:37:47,790 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:37:47,810 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 23:37:47,810 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-20 23:37:47,817 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 23:38:00,005 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:39:00 EST)" (scheduled at 2025-11-20 23:38:00-05:00)
2025-11-20 23:38:00,005 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:38:00,046 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:39:00 EST)" executed successfully
2025-11-20 23:38:20,301 - __main__ - INFO - ============================================================
2025-11-20 23:38:20,301 - __main__ - INFO - Starting Notification Service
2025-11-20 23:38:20,301 - __main__ - INFO - ============================================================
2025-11-20 23:38:20,301 - __main__ - INFO - Initializing database...
2025-11-20 23:38:20,301 - data.database - INFO - Initializing database...
2025-11-20 23:38:20,627 - data.database - INFO - Database initialized successfully
2025-11-20 23:38:20,627 - __main__ - INFO - Database initialized successfully
2025-11-20 23:38:20,627 - __main__ - INFO - Starting reminder scheduler...
2025-11-20 23:38:20,627 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-20 23:38:20,632 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-20 23:38:20,633 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-20 23:38:20,633 - apscheduler.scheduler - INFO - Scheduler started
2025-11-20 23:38:20,633 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-11-20 23:38:20,634 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-20 23:38:20,634 - __main__ - INFO - Starting queue listener...
2025-11-20 23:38:20,634 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-20 23:38:20,634 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-20 23:38:20,634 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-20 23:38:20,634 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-20 23:38:20,640 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:38:20,648 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.172.159.105', 49296), raddr=('34.196.5.176', 5672)>
2025-11-20 23:38:20,648 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103e4f380>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103e4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:38:20,672 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103e4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:38:20,672 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103e4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:38:20,672 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103e4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:38:20,672 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:38:20,695 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-20 23:38:20,695 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-20 23:38:20,703 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-20 23:39:00,007 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:40:00 EST)" (scheduled at 2025-11-20 23:39:00-05:00)
2025-11-20 23:39:00,008 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:39:00 EST)" (scheduled at 2025-11-20 23:39:00-05:00)
2025-11-20 23:39:00,009 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:39:00,009 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:39:00,048 - scheduler.reminder_scheduler - INFO - Found 1 pending one-hour reminders
2025-11-20 23:39:00,059 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:39:00,059 - scheduler.reminder_scheduler - INFO - Found 1 pending one-hour reminders
2025-11-20 23:39:00,065 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 49443), raddr=('34.196.5.176', 5672)>
2025-11-20 23:39:00,067 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104f5f110>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104f5f110> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:39:00,067 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-20 23:39:00,075 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 49446), raddr=('34.196.5.176', 5672)>
2025-11-20 23:39:00,078 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103e5ead0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103e5ead0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-20 23:39:00,090 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104f5f110> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:39:00,091 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104f5f110> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:39:00,091 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104f5f110> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:39:00,091 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:39:00,097 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103e5ead0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:39:00,097 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103e5ead0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:39:00,097 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103e5ead0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-20 23:39:00,097 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-20 23:39:00,105 - scheduler.queue_publisher - INFO - Published reminder: event_id=bd8814f8-5901-44bf-84a2-65041925f4de, type=one_hour
2025-11-20 23:39:00,109 - scheduler.queue_publisher - INFO - Published reminder: event_id=bd8814f8-5901-44bf-84a2-65041925f4de, type=one_hour
2025-11-20 23:39:00,112 - consumer.queue_listener - INFO - Received message: {"type": "event_reminder", "event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "reminder_type": "one_hour"}
2025-11-20 23:39:00,116 - consumer.queue_listener - INFO - Received message: {"type": "event_reminder", "event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "reminder_type": "one_hour"}
2025-11-20 23:39:00,122 - scheduler.reminder_scheduler - INFO - Sent one-hour reminder for event bd8814f8-5901-44bf-84a2-65041925f4de
2025-11-20 23:39:00,122 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104f5f110> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:39:00,128 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104f5f110> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:39:00,129 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:39:00,129 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:39:00,129 - scheduler.reminder_scheduler - INFO - Sent one-hour reminder for event bd8814f8-5901-44bf-84a2-65041925f4de
2025-11-20 23:39:00,129 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103e5ead0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:39:00,136 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103e5ead0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-20 23:39:00,136 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-20 23:39:00,136 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-20 23:39:00,136 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 49443), raddr=('34.196.5.176', 5672)>
2025-11-20 23:39:00,136 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 49443), raddr=('34.196.5.176', 5672)>
2025-11-20 23:39:00,136 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 49443), raddr=('34.196.5.176', 5672)>
2025-11-20 23:39:00,136 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:39:00,136 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:39:00,136 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 49443), raddr=('34.196.5.176', 5672)>
2025-11-20 23:39:00,137 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:39:00,137 - scheduler.reminder_scheduler - INFO - Reminder check complete: 0 one-day, 1 one-hour reminders sent
2025-11-20 23:39:00,137 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:40:00 EST)" executed successfully
2025-11-20 23:39:00,140 - consumer.queue_listener - INFO - Enriched reminder message with event details
2025-11-20 23:39:00,142 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 49446), raddr=('34.196.5.176', 5672)>
2025-11-20 23:39:00,142 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 49446), raddr=('34.196.5.176', 5672)>
2025-11-20 23:39:00,142 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 49446), raddr=('34.196.5.176', 5672)>
2025-11-20 23:39:00,143 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:39:00,143 - consumer.queue_listener - INFO - Enriched reminder message with event details
2025-11-20 23:39:00,143 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-20 23:39:00,144 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 49446), raddr=('34.196.5.176', 5672)>
2025-11-20 23:39:00,144 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-20 23:39:00,144 - scheduler.reminder_scheduler - INFO - Reminder check complete: 0 one-day, 1 one-hour reminders sent
2025-11-20 23:39:00,144 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:40:00 EST)" executed successfully
2025-11-20 23:39:00,149 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 23:39:00,150 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-20 23:39:00,150 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_reminder
2025-11-20 23:39:00,152 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 23:39:00,152 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-20 23:39:00,152 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_reminder
2025-11-20 23:39:00,165 - processor.notification_processor - INFO - Step 3: Total participants to process: 1
2025-11-20 23:39:00,169 - processor.notification_processor - INFO - Step 3: Total participants to process: 1
2025-11-20 23:39:00,174 - processor.notification_processor - INFO - Step 4: Processing batch 1 (1 participants, offset=0)
2025-11-20 23:39:00,174 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-20 23:39:00,179 - processor.notification_processor - INFO - Step 4: Processing batch 1 (1 participants, offset=0)
2025-11-20 23:39:00,179 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-20 23:39:01,325 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-20 23:39:01,326 - email_service.email_service - INFO - Batch email results: 1 successful, 0 failed
2025-11-20 23:39:01,326 - processor.notification_processor - INFO - Batch 1 complete: 1 sent, 0 failed
2025-11-20 23:39:01,334 - processor.notification_processor - INFO - No more participants to process
2025-11-20 23:39:01,334 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 1 emails sent successfully, 0 failed out of 1 total
2025-11-20 23:39:01,342 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 23:39:01,649 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-20 23:39:01,649 - email_service.email_service - INFO - Batch email results: 1 successful, 0 failed
2025-11-20 23:39:01,649 - processor.notification_processor - INFO - Batch 1 complete: 1 sent, 0 failed
2025-11-20 23:39:01,658 - processor.notification_processor - INFO - No more participants to process
2025-11-20 23:39:01,658 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 1 emails sent successfully, 0 failed out of 1 total
2025-11-20 23:39:01,669 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 23:39:17,381 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-20 23:39:17,383 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 23:39:17,383 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-20 23:39:17,383 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-20 23:39:17,399 - processor.notification_processor - INFO - Step 3: Total participants to process: 1
2025-11-20 23:39:17,407 - processor.notification_processor - INFO - Step 4: Processing batch 1 (1 participants, offset=0)
2025-11-20 23:39:17,408 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-20 23:39:18,985 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-20 23:39:18,986 - email_service.email_service - INFO - Batch email results: 1 successful, 0 failed
2025-11-20 23:39:18,986 - processor.notification_processor - INFO - Batch 1 complete: 1 sent, 0 failed
2025-11-20 23:39:18,993 - processor.notification_processor - INFO - No more participants to process
2025-11-20 23:39:18,993 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 1 emails sent successfully, 0 failed out of 1 total
2025-11-20 23:39:19,002 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-20 23:40:00,027 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:41:00 EST)" (scheduled at 2025-11-20 23:40:00-05:00)
2025-11-20 23:40:00,030 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:40:00,070 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:41:00 EST)" executed successfully
2025-11-20 23:41:00,016 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:42:00 EST)" (scheduled at 2025-11-20 23:41:00-05:00)
2025-11-20 23:41:00,017 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:41:00,055 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:42:00 EST)" executed successfully
2025-11-20 23:42:00,014 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:43:00 EST)" (scheduled at 2025-11-20 23:42:00-05:00)
2025-11-20 23:42:00,016 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:42:00,055 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:43:00 EST)" executed successfully
2025-11-20 23:43:00,015 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:44:00 EST)" (scheduled at 2025-11-20 23:43:00-05:00)
2025-11-20 23:43:00,017 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:43:00,050 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:44:00 EST)" executed successfully
2025-11-20 23:44:00,029 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:45:00 EST)" (scheduled at 2025-11-20 23:44:00-05:00)
2025-11-20 23:44:00,030 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-20 23:44:00,065 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-20 23:45:00 EST)" executed successfully
2025-11-21 00:06:44,364 - __main__ - INFO - ============================================================
2025-11-21 00:06:44,365 - __main__ - INFO - Starting Notification Service
2025-11-21 00:06:44,365 - __main__ - INFO - ============================================================
2025-11-21 00:06:44,365 - __main__ - INFO - Initializing database...
2025-11-21 00:06:44,365 - data.database - INFO - Initializing database...
2025-11-21 00:06:45,920 - data.database - INFO - Database initialized successfully
2025-11-21 00:06:45,921 - __main__ - INFO - Database initialized successfully
2025-11-21 00:06:45,921 - __main__ - INFO - Starting reminder scheduler...
2025-11-21 00:06:45,921 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-21 00:06:45,926 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-21 00:06:45,927 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-21 00:06:45,927 - apscheduler.scheduler - INFO - Scheduler started
2025-11-21 00:06:45,927 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-11-21 00:06:45,927 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-21 00:06:45,927 - __main__ - INFO - Starting queue listener...
2025-11-21 00:06:45,927 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-21 00:06:45,927 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-21 00:06:45,927 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-21 00:06:45,927 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-21 00:06:45,951 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-21 00:06:45,957 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.172.159.105', 55440), raddr=('34.196.5.176', 5672)>
2025-11-21 00:06:45,958 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a14b4d0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a14b4d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-21 00:06:45,979 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a14b4d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-21 00:06:45,979 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a14b4d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-21 00:06:45,979 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a14b4d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-21 00:06:45,979 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-21 00:06:46,001 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-21 00:06:46,001 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-21 00:06:46,007 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-21 00:06:46,012 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-21 00:06:46,013 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-21 00:06:46,013 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-21 00:06:46,013 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-21 00:06:46,033 - processor.notification_processor - INFO - Step 3: Total participants to process: 1
2025-11-21 00:06:46,044 - processor.notification_processor - INFO - Step 4: Processing batch 1 (1 participants, offset=0)
2025-11-21 00:06:46,044 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-21 00:06:47,248 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-21 00:06:47,249 - email_service.email_service - INFO - Batch email results: 1 successful, 0 failed
2025-11-21 00:06:47,249 - processor.notification_processor - INFO - Batch 1 complete: 1 sent, 0 failed
2025-11-21 00:06:47,264 - processor.notification_processor - INFO - No more participants to process
2025-11-21 00:06:47,264 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 1 emails sent successfully, 0 failed out of 1 total
2025-11-21 00:06:47,273 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-21 00:06:47,279 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-21 00:06:47,280 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-21 00:06:47,280 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-21 00:06:47,280 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-21 00:06:47,295 - processor.notification_processor - INFO - Step 3: Total participants to process: 1
2025-11-21 00:06:47,304 - processor.notification_processor - INFO - Step 4: Processing batch 1 (1 participants, offset=0)
2025-11-21 00:06:47,304 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-21 00:06:48,571 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-21 00:06:48,572 - email_service.email_service - INFO - Batch email results: 1 successful, 0 failed
2025-11-21 00:06:48,572 - processor.notification_processor - INFO - Batch 1 complete: 1 sent, 0 failed
2025-11-21 00:06:48,582 - processor.notification_processor - INFO - No more participants to process
2025-11-21 00:06:48,582 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 1 emails sent successfully, 0 failed out of 1 total
2025-11-21 00:06:48,593 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-21 00:06:48,599 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-21 00:06:48,599 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-21 00:06:48,600 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-21 00:06:48,600 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-21 00:06:48,615 - processor.notification_processor - INFO - Step 3: Total participants to process: 1
2025-11-21 00:06:48,623 - processor.notification_processor - INFO - Step 4: Processing batch 1 (1 participants, offset=0)
2025-11-21 00:06:48,623 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-21 00:06:49,634 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-21 00:06:49,635 - email_service.email_service - INFO - Batch email results: 1 successful, 0 failed
2025-11-21 00:06:49,636 - processor.notification_processor - INFO - Batch 1 complete: 1 sent, 0 failed
2025-11-21 00:06:49,644 - processor.notification_processor - INFO - No more participants to process
2025-11-21 00:06:49,644 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 1 emails sent successfully, 0 failed out of 1 total
2025-11-21 00:06:49,654 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-21 00:07:00,010 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-21 00:07:00 EST)" (scheduled at 2025-11-21 00:07:00-05:00)
2025-11-21 00:07:00,020 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-21 00:07:00,039 - scheduler.reminder_scheduler - INFO - Found 1 pending one-day reminders
2025-11-21 00:07:00,043 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-21 00:07:00,050 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 55489), raddr=('34.196.5.176', 5672)>
2025-11-21 00:07:00,050 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a15b890>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a15b890> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-21 00:07:00,070 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a15b890> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-21 00:07:00,070 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a15b890> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-21 00:07:00,070 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a15b890> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-21 00:07:00,070 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-21 00:07:00,082 - scheduler.queue_publisher - INFO - Published reminder: event_id=bd8814f8-5901-44bf-84a2-65041925f4de, type=one_day
2025-11-21 00:07:00,088 - consumer.queue_listener - INFO - Received message: {"type": "event_reminder", "event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "reminder_type": "one_day"}
2025-11-21 00:07:00,105 - consumer.queue_listener - INFO - Enriched reminder message with event details
2025-11-21 00:07:00,113 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-21 00:07:00,113 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-21 00:07:00,113 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_reminder
2025-11-21 00:07:00,127 - processor.notification_processor - INFO - Step 3: Total participants to process: 1
2025-11-21 00:07:00,136 - processor.notification_processor - INFO - Step 4: Processing batch 1 (1 participants, offset=0)
2025-11-21 00:07:00,136 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-21 00:07:00,168 - scheduler.reminder_scheduler - INFO - Sent one-day reminder for event bd8814f8-5901-44bf-84a2-65041925f4de
2025-11-21 00:07:00,168 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a15b890> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-21 00:07:00,174 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a15b890> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-21 00:07:00,175 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-21 00:07:00,175 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-21 00:07:00,180 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 55489), raddr=('34.196.5.176', 5672)>
2025-11-21 00:07:00,181 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 55489), raddr=('34.196.5.176', 5672)>
2025-11-21 00:07:00,181 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 55489), raddr=('34.196.5.176', 5672)>
2025-11-21 00:07:00,181 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-21 00:07:00,181 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-21 00:07:00,181 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 55489), raddr=('34.196.5.176', 5672)>
2025-11-21 00:07:00,181 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-21 00:07:00,196 - scheduler.reminder_scheduler - INFO - Found 1 pending one-hour reminders
2025-11-21 00:07:00,198 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-21 00:07:00,204 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 55493), raddr=('34.196.5.176', 5672)>
2025-11-21 00:07:00,204 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a1b02d0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a1b02d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-21 00:07:00,224 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a1b02d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-21 00:07:00,224 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a1b02d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-21 00:07:00,224 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a1b02d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-21 00:07:00,224 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-21 00:07:00,236 - scheduler.queue_publisher - INFO - Published reminder: event_id=bd8814f8-5901-44bf-84a2-65041925f4de, type=one_hour
2025-11-21 00:07:00,252 - scheduler.reminder_scheduler - INFO - Sent one-hour reminder for event bd8814f8-5901-44bf-84a2-65041925f4de
2025-11-21 00:07:00,252 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a1b02d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-21 00:07:00,259 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x11a1b02d0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-21 00:07:00,259 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-21 00:07:00,259 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-21 00:07:00,268 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 55493), raddr=('34.196.5.176', 5672)>
2025-11-21 00:07:00,268 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 55493), raddr=('34.196.5.176', 5672)>
2025-11-21 00:07:00,268 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 55493), raddr=('34.196.5.176', 5672)>
2025-11-21 00:07:00,268 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-21 00:07:00,268 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-21 00:07:00,268 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=16, family=2, type=1, proto=6, laddr=('10.172.159.105', 55493), raddr=('34.196.5.176', 5672)>
2025-11-21 00:07:00,269 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-21 00:07:00,269 - scheduler.reminder_scheduler - INFO - Reminder check complete: 1 one-day, 1 one-hour reminders sent
2025-11-21 00:07:00,269 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-21 00:08:00 EST)" executed successfully
2025-11-21 00:07:01,132 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-21 00:07:01,132 - email_service.email_service - INFO - Batch email results: 1 successful, 0 failed
2025-11-21 00:07:01,132 - processor.notification_processor - INFO - Batch 1 complete: 1 sent, 0 failed
2025-11-21 00:07:01,140 - processor.notification_processor - INFO - No more participants to process
2025-11-21 00:07:01,140 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 1 emails sent successfully, 0 failed out of 1 total
2025-11-21 00:07:01,150 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-21 00:07:01,155 - consumer.queue_listener - INFO - Received message: {"type": "event_reminder", "event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "reminder_type": "one_hour"}
2025-11-21 00:07:01,171 - consumer.queue_listener - INFO - Enriched reminder message with event details
2025-11-21 00:07:01,180 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-21 00:07:01,180 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-21 00:07:01,180 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_reminder
2025-11-21 00:07:01,194 - processor.notification_processor - INFO - Step 3: Total participants to process: 1
2025-11-21 00:07:01,205 - processor.notification_processor - INFO - Step 4: Processing batch 1 (1 participants, offset=0)
2025-11-21 00:07:01,205 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-21 00:07:02,189 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-21 00:07:02,189 - email_service.email_service - INFO - Batch email results: 1 successful, 0 failed
2025-11-21 00:07:02,190 - processor.notification_processor - INFO - Batch 1 complete: 1 sent, 0 failed
2025-11-21 00:07:02,200 - processor.notification_processor - INFO - No more participants to process
2025-11-21 00:07:02,200 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 1 emails sent successfully, 0 failed out of 1 total
2025-11-21 00:07:02,215 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_reminder, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-21 00:08:00,027 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-21 00:09:00 EST)" (scheduled at 2025-11-21 00:08:00-05:00)
2025-11-21 00:08:00,031 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-21 00:08:00,064 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-21 00:09:00 EST)" executed successfully
2025-11-21 00:09:00,013 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-21 00:10:00 EST)" (scheduled at 2025-11-21 00:09:00-05:00)
2025-11-21 00:09:00,017 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-21 00:09:00,053 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-21 00:10:00 EST)" executed successfully
2025-11-21 00:23:24,587 - __main__ - INFO - ============================================================
2025-11-21 00:23:24,587 - __main__ - INFO - Starting Notification Service
2025-11-21 00:23:24,587 - __main__ - INFO - ============================================================
2025-11-21 00:23:24,587 - __main__ - INFO - Initializing database...
2025-11-21 00:23:24,587 - data.database - INFO - Initializing database...
2025-11-21 00:23:25,507 - data.database - INFO - Database initialized successfully
2025-11-21 00:23:25,507 - __main__ - INFO - Database initialized successfully
2025-11-21 00:23:25,507 - __main__ - INFO - Starting reminder scheduler...
2025-11-21 00:23:25,507 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-21 00:23:25,519 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-21 00:23:25,520 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-21 00:23:25,520 - apscheduler.scheduler - INFO - Scheduler started
2025-11-21 00:23:25,520 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-11-21 00:23:25,521 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-21 00:23:25,521 - __main__ - INFO - Starting queue listener...
2025-11-21 00:23:25,521 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-21 00:23:25,521 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-21 00:23:25,521 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-21 00:23:25,521 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-21 00:23:25,575 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-21 00:23:25,582 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.172.159.105', 58999), raddr=('34.196.5.176', 5672)>
2025-11-21 00:23:25,583 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105cf7380>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105cf7380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-21 00:23:25,601 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105cf7380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-21 00:23:25,601 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105cf7380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-21 00:23:25,601 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105cf7380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-21 00:23:25,602 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-21 00:23:25,619 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-21 00:23:25,619 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-21 00:23:25,625 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-21 00:23:30,150 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-21 00:23:30,152 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-21 00:23:30,152 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-21 00:23:30,152 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-21 00:23:30,177 - processor.notification_processor - INFO - Step 3: Total participants to process: 1
2025-11-21 00:23:30,188 - processor.notification_processor - INFO - Step 4: Processing batch 1 (1 participants, offset=0)
2025-11-21 00:23:30,188 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-21 00:23:31,739 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-21 00:23:31,740 - email_service.email_service - INFO - Batch email results: 1 successful, 0 failed
2025-11-21 00:23:31,740 - processor.notification_processor - INFO - Batch 1 complete: 1 sent, 0 failed
2025-11-21 00:23:31,747 - processor.notification_processor - INFO - No more participants to process
2025-11-21 00:23:31,747 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 1 emails sent successfully, 0 failed out of 1 total
2025-11-21 00:23:31,755 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-21 00:24:00,007 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-21 00:25:00 EST)" (scheduled at 2025-11-21 00:24:00-05:00)
2025-11-21 00:24:00,010 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-21 00:24:00,050 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-21 00:25:00 EST)" executed successfully
2025-11-30 14:51:11,011 - __main__ - INFO - ============================================================
2025-11-30 14:51:11,012 - __main__ - INFO - Starting Notification Service
2025-11-30 14:51:11,012 - __main__ - INFO - ============================================================
2025-11-30 14:51:11,012 - __main__ - INFO - Initializing database...
2025-11-30 14:51:11,012 - data.database - INFO - Initializing database...
2025-11-30 14:51:11,589 - data.database - INFO - Database initialized successfully
2025-11-30 14:51:11,589 - __main__ - INFO - Database initialized successfully
2025-11-30 14:51:11,589 - __main__ - INFO - Starting reminder scheduler...
2025-11-30 14:51:11,589 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-30 14:51:11,596 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-30 14:51:11,597 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-30 14:51:11,597 - apscheduler.scheduler - INFO - Scheduler started
2025-11-30 14:51:11,597 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-11-30 14:51:11,597 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-30 14:51:11,597 - __main__ - INFO - Starting queue listener...
2025-11-30 14:51:11,597 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-30 14:51:11,597 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-30 14:51:11,598 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-30 14:51:11,598 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-30 14:51:11,638 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-30 14:51:11,647 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 51454), raddr=('34.196.5.176', 5672)>
2025-11-30 14:51:11,648 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103b4f380>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103b4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-30 14:51:11,675 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103b4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 14:51:11,675 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103b4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 14:51:11,676 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103b4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 14:51:11,676 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-30 14:51:11,703 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-30 14:51:11,704 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-30 14:51:11,713 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-30 14:52:00,011 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:53:00 EST)" (scheduled at 2025-11-30 14:52:00-05:00)
2025-11-30 14:52:00,012 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 14:52:00,082 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:53:00 EST)" executed successfully
2025-11-30 14:53:00,017 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:54:00 EST)" (scheduled at 2025-11-30 14:53:00-05:00)
2025-11-30 14:53:00,018 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 14:53:00,069 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:54:00 EST)" executed successfully
2025-11-30 14:54:00,013 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:55:00 EST)" (scheduled at 2025-11-30 14:54:00-05:00)
2025-11-30 14:54:00,015 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 14:54:00,060 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:55:00 EST)" executed successfully
2025-11-30 14:55:00,008 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:56:00 EST)" (scheduled at 2025-11-30 14:55:00-05:00)
2025-11-30 14:55:00,011 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 14:55:00,058 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:56:00 EST)" executed successfully
2025-11-30 14:56:00,008 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:57:00 EST)" (scheduled at 2025-11-30 14:56:00-05:00)
2025-11-30 14:56:00,011 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 14:56:00,068 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:57:00 EST)" executed successfully
2025-11-30 14:57:00,007 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:58:00 EST)" (scheduled at 2025-11-30 14:57:00-05:00)
2025-11-30 14:57:00,010 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 14:57:00,063 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:58:00 EST)" executed successfully
2025-11-30 14:58:00,010 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:59:00 EST)" (scheduled at 2025-11-30 14:58:00-05:00)
2025-11-30 14:58:00,012 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 14:58:00,068 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 14:59:00 EST)" executed successfully
2025-11-30 14:59:00,006 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 15:00:00 EST)" (scheduled at 2025-11-30 14:59:00-05:00)
2025-11-30 14:59:00,009 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 14:59:00,109 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 15:00:00 EST)" executed successfully
2025-11-30 14:59:31,170 - __main__ - INFO - ============================================================
2025-11-30 14:59:31,170 - __main__ - INFO - Starting Notification Service
2025-11-30 14:59:31,170 - __main__ - INFO - ============================================================
2025-11-30 14:59:31,170 - __main__ - INFO - Initializing database...
2025-11-30 14:59:31,170 - data.database - INFO - Initializing database...
2025-11-30 14:59:31,622 - data.database - INFO - Database initialized successfully
2025-11-30 14:59:31,622 - __main__ - INFO - Database initialized successfully
2025-11-30 14:59:31,623 - __main__ - INFO - Starting reminder scheduler...
2025-11-30 14:59:31,623 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-30 14:59:31,639 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-30 14:59:31,641 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-30 14:59:31,642 - apscheduler.scheduler - INFO - Scheduler started
2025-11-30 14:59:31,642 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-11-30 14:59:31,642 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-30 14:59:31,642 - __main__ - INFO - Starting queue listener...
2025-11-30 14:59:31,642 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-30 14:59:31,642 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-30 14:59:31,642 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-30 14:59:31,642 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-30 14:59:31,674 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-30 14:59:31,682 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54718), raddr=('34.196.5.176', 5672)>
2025-11-30 14:59:31,683 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105d4f380>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105d4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-30 14:59:31,707 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105d4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 14:59:31,707 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105d4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 14:59:31,707 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105d4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 14:59:31,707 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-30 14:59:31,728 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-30 14:59:31,728 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-30 14:59:31,735 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-30 15:00:00,005 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 15:00:00 EST)" (scheduled at 2025-11-30 15:00:00-05:00)
2025-11-30 15:00:00,017 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 15:00:00,069 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 15:01:00 EST)" executed successfully
2025-11-30 15:01:00,009 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 15:02:00 EST)" (scheduled at 2025-11-30 15:01:00-05:00)
2025-11-30 15:01:00,012 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 15:01:00,067 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 15:02:00 EST)" executed successfully
2025-11-30 15:02:01,399 - __main__ - INFO - ============================================================
2025-11-30 15:02:01,399 - __main__ - INFO - Starting Notification Service
2025-11-30 15:02:01,400 - __main__ - INFO - ============================================================
2025-11-30 15:02:01,400 - __main__ - INFO - Initializing database...
2025-11-30 15:02:01,400 - data.database - INFO - Initializing database...
2025-11-30 15:02:01,856 - data.database - INFO - Database initialized successfully
2025-11-30 15:02:01,857 - __main__ - INFO - Database initialized successfully
2025-11-30 15:02:01,857 - __main__ - INFO - Starting reminder scheduler...
2025-11-30 15:02:01,857 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-30 15:02:01,866 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-30 15:02:01,867 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-30 15:02:01,867 - apscheduler.scheduler - INFO - Scheduler started
2025-11-30 15:02:01,867 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-11-30 15:02:01,867 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-30 15:02:01,867 - __main__ - INFO - Starting queue listener...
2025-11-30 15:02:01,867 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-30 15:02:01,868 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-30 15:02:01,868 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-30 15:02:01,868 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-30 15:02:01,899 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-30 15:02:01,911 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54937), raddr=('34.196.5.176', 5672)>
2025-11-30 15:02:01,912 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104d4f380>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104d4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-30 15:02:01,947 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104d4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 15:02:01,947 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104d4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 15:02:01,947 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x104d4f380> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 15:02:01,948 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-30 15:02:01,983 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-30 15:02:01,983 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-30 15:02:01,994 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-30 15:02:30,772 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "bd8814f8-5901-44bf-84a2-65041925f4de", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 15:02:30,775 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 15:02:30,775 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 15:02:30,775 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 15:02:30,806 - processor.notification_processor - INFO - Step 3: Total participants to process: 1
2025-11-30 15:02:30,819 - processor.notification_processor - INFO - Step 4: Processing batch 1 (1 participants, offset=0)
2025-11-30 15:02:30,819 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 15:02:32,437 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 15:02:32,438 - email_service.email_service - INFO - Batch email results: 1 successful, 0 failed
2025-11-30 15:02:32,438 - processor.notification_processor - INFO - Batch 1 complete: 1 sent, 0 failed
2025-11-30 15:02:32,449 - processor.notification_processor - INFO - No more participants to process
2025-11-30 15:02:32,452 - processor.notification_processor - INFO - Processing complete for event_id=bd8814f8-5901-44bf-84a2-65041925f4de: 1 emails sent successfully, 0 failed out of 1 total
2025-11-30 15:02:32,463 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=bd8814f8-5901-44bf-84a2-65041925f4de, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 15:03:00,006 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 15:04:00 EST)" (scheduled at 2025-11-30 15:03:00-05:00)
2025-11-30 15:03:00,008 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 15:03:00,051 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 15:04:00 EST)" executed successfully
2025-11-30 18:08:20,292 - __main__ - INFO - ============================================================
2025-11-30 18:08:20,293 - __main__ - INFO - Starting Notification Service
2025-11-30 18:08:20,293 - __main__ - INFO - ============================================================
2025-11-30 18:08:20,293 - __main__ - INFO - Initializing database...
2025-11-30 18:08:20,293 - data.database - INFO - Initializing database...
2025-11-30 18:08:20,605 - data.database - INFO - Database initialized successfully
2025-11-30 18:08:20,605 - __main__ - INFO - Database initialized successfully
2025-11-30 18:08:20,605 - __main__ - INFO - Starting reminder scheduler...
2025-11-30 18:08:20,606 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-30 18:08:20,613 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-30 18:08:20,613 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-30 18:08:20,613 - apscheduler.scheduler - INFO - Scheduler started
2025-11-30 18:08:20,613 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-11-30 18:08:20,613 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-30 18:08:20,613 - __main__ - INFO - Starting queue listener...
2025-11-30 18:08:20,613 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-30 18:08:20,613 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-30 18:08:20,614 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-30 18:08:20,614 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-30 18:08:20,632 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-30 18:08:20,639 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 53200), raddr=('34.196.5.176', 5672)>
2025-11-30 18:08:20,640 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10577d010>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10577d010> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-30 18:08:20,662 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10577d010> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:08:20,662 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10577d010> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:08:20,662 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10577d010> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:08:20,662 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-30 18:08:20,684 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-30 18:08:20,684 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-30 18:08:20,691 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-30 18:08:20,698 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd", "event_name": "test_sagar123", "description": null, "start_time": "2025-11-28T17:50:00", "end_time": "2025-11-28T18:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD, USA", "remaining_seats": 100}}
2025-11-30 18:08:20,698 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd, event_name=test_sagar123)
2025-11-30 18:08:20,698 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd, event_name=test_sagar123
2025-11-30 18:08:20,698 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:08:20,803 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:08:20,803 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:08:20,861 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd "HTTP/1.1 200 OK"
2025-11-30 18:08:20,861 - api.booking_client - INFO - Retrieved booking count for event_id=92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd: 0
2025-11-30 18:08:20,861 - processor.notification_processor - INFO - Step 3: Total participants to process: 0
2025-11-30 18:08:20,861 - processor.notification_processor - WARNING - No participants found for event_id=92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd
2025-11-30 18:08:20,862 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd, event_name=test_sagar123)
2025-11-30 18:08:20,868 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd", "event_name": "test_sagar123456", "description": null, "start_time": "2025-11-28T17:50:00", "end_time": "2025-11-28T18:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD, USA", "remaining_seats": 100}}
2025-11-30 18:08:20,868 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd, event_name=test_sagar123456)
2025-11-30 18:08:20,868 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd, event_name=test_sagar123456
2025-11-30 18:08:20,868 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:08:20,869 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:08:20,869 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:08:20,900 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd "HTTP/1.1 200 OK"
2025-11-30 18:08:20,900 - api.booking_client - INFO - Retrieved booking count for event_id=92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd: 0
2025-11-30 18:08:20,900 - processor.notification_processor - INFO - Step 3: Total participants to process: 0
2025-11-30 18:08:20,900 - processor.notification_processor - WARNING - No participants found for event_id=92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd
2025-11-30 18:08:20,900 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=92c5fd45-ec2f-44cb-a2c7-4ac2d943e9cd, event_name=test_sagar123456)
2025-11-30 18:08:20,906 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "8dbfa71c-20d1-4654-9ee1-d94e641edd33", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 123465", "description": null, "start_time": "2025-11-30T04:31:00", "end_time": "2025-11-30T16:30:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "Hyattsville, MD, USA", "remaining_seats": 789}}
2025-11-30 18:08:20,906 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=8dbfa71c-20d1-4654-9ee1-d94e641edd33, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 123465)
2025-11-30 18:08:20,906 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=8dbfa71c-20d1-4654-9ee1-d94e641edd33, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 123465
2025-11-30 18:08:20,906 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:08:20,906 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:08:20,907 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:08:20,940 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=8dbfa71c-20d1-4654-9ee1-d94e641edd33 "HTTP/1.1 200 OK"
2025-11-30 18:08:20,940 - api.booking_client - INFO - Retrieved booking count for event_id=8dbfa71c-20d1-4654-9ee1-d94e641edd33: 0
2025-11-30 18:08:20,940 - processor.notification_processor - INFO - Step 3: Total participants to process: 0
2025-11-30 18:08:20,940 - processor.notification_processor - WARNING - No participants found for event_id=8dbfa71c-20d1-4654-9ee1-d94e641edd33
2025-11-30 18:08:20,940 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=8dbfa71c-20d1-4654-9ee1-d94e641edd33, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 123465)
2025-11-30 18:09:00,017 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:10:00 EST)" (scheduled at 2025-11-30 18:09:00-05:00)
2025-11-30 18:09:00,022 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 18:09:00,074 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:10:00 EST)" executed successfully
2025-11-30 18:09:30,245 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:09:30,252 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:09:30,253 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:09:30,253 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:09:30,254 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:09:30,254 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:09:30,333 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:09:30,333 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 0
2025-11-30 18:09:30,333 - processor.notification_processor - INFO - Step 3: Total participants to process: 0
2025-11-30 18:09:30,334 - processor.notification_processor - WARNING - No participants found for event_id=10111111-1111-1111-1111-111111111111
2025-11-30 18:09:30,334 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:10:00,009 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:11:00 EST)" (scheduled at 2025-11-30 18:10:00-05:00)
2025-11-30 18:10:00,012 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 18:10:00,071 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:11:00 EST)" executed successfully
2025-11-30 18:11:00,007 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:12:00 EST)" (scheduled at 2025-11-30 18:11:00-05:00)
2025-11-30 18:11:00,023 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 18:11:00,075 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:12:00 EST)" executed successfully
2025-11-30 18:12:00,029 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:13:00 EST)" (scheduled at 2025-11-30 18:12:00-05:00)
2025-11-30 18:12:00,032 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 18:12:00,075 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:13:00 EST)" executed successfully
2025-11-30 18:12:16,322 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:12:16,326 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:12:16,326 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:12:16,326 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:12:16,327 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:12:16,327 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:12:16,403 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:12:16,403 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 0
2025-11-30 18:12:16,403 - processor.notification_processor - INFO - Step 3: Total participants to process: 0
2025-11-30 18:12:16,403 - processor.notification_processor - WARNING - No participants found for event_id=10111111-1111-1111-1111-111111111111
2025-11-30 18:12:16,404 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:13:00,012 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:14:00 EST)" (scheduled at 2025-11-30 18:13:00-05:00)
2025-11-30 18:13:00,015 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 18:13:00,064 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:14:00 EST)" executed successfully
2025-11-30 18:14:00,026 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:15:00 EST)" (scheduled at 2025-11-30 18:14:00-05:00)
2025-11-30 18:14:00,032 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 18:14:00,072 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:15:00 EST)" executed successfully
2025-11-30 18:15:00,017 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:16:00 EST)" (scheduled at 2025-11-30 18:15:00-05:00)
2025-11-30 18:15:00,023 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 18:15:00,063 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:16:00 EST)" executed successfully
2025-11-30 18:16:00,009 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:17:00 EST)" (scheduled at 2025-11-30 18:16:00-05:00)
2025-11-30 18:16:00,014 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 18:16:00,084 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:17:00 EST)" executed successfully
2025-11-30 18:17:00,006 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:18:00 EST)" (scheduled at 2025-11-30 18:17:00-05:00)
2025-11-30 18:17:00,008 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 18:17:00,060 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:18:00 EST)" executed successfully
2025-11-30 18:18:00,006 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:19:00 EST)" (scheduled at 2025-11-30 18:18:00-05:00)
2025-11-30 18:18:00,008 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 18:18:00,065 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:19:00 EST)" executed successfully
2025-11-30 18:18:04,881 - consumer.queue_listener - INFO - Received signal 2, initiating graceful shutdown...
2025-11-30 18:18:04,882 - consumer.queue_listener - INFO - Stopping queue listener...
2025-11-30 18:18:04,896 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10577d010> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-30 18:18:04,904 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10577d010> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-30 18:18:04,904 - consumer.queue_listener - INFO - Channel closed
2025-11-30 18:18:04,905 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-30 18:18:04,905 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-30 18:18:04,915 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 53200), raddr=('34.196.5.176', 5672)>
2025-11-30 18:18:04,916 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 53200), raddr=('34.196.5.176', 5672)>
2025-11-30 18:18:04,916 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 53200), raddr=('34.196.5.176', 5672)>
2025-11-30 18:18:04,916 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-30 18:18:04,917 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-30 18:18:04,918 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 53200), raddr=('34.196.5.176', 5672)>
2025-11-30 18:18:04,918 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-30 18:18:04,918 - consumer.queue_listener - INFO - Connection closed
2025-11-30 18:18:04,918 - consumer.queue_listener - INFO - Queue listener stopped
2025-11-30 18:18:04,919 - consumer.queue_listener - ERROR - Error in consumer: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-11-30 18:18:04,930 - __main__ - ERROR - Fatal error: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/run.py", line 78, in main
    listener.start()
    ~~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-11-30 18:18:04,931 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-11-30 18:18:04,932 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-11-30 18:18:04,932 - __main__ - INFO - ============================================================
2025-11-30 18:18:04,932 - __main__ - INFO - Notification Service Stopped
2025-11-30 18:18:04,932 - __main__ - INFO - ============================================================
2025-11-30 18:19:13,904 - __main__ - INFO - ============================================================
2025-11-30 18:19:13,905 - __main__ - INFO - Starting Notification Service
2025-11-30 18:19:13,905 - __main__ - INFO - ============================================================
2025-11-30 18:19:13,905 - __main__ - INFO - Initializing database...
2025-11-30 18:19:13,905 - data.database - INFO - Initializing database...
2025-11-30 18:19:14,152 - data.database - INFO - Database initialized successfully
2025-11-30 18:19:14,152 - __main__ - INFO - Database initialized successfully
2025-11-30 18:19:14,152 - __main__ - INFO - Starting reminder scheduler...
2025-11-30 18:19:14,152 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-30 18:19:14,159 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-30 18:19:14,159 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-30 18:19:14,160 - apscheduler.scheduler - INFO - Scheduler started
2025-11-30 18:19:14,160 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-11-30 18:19:14,160 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-30 18:19:14,160 - __main__ - INFO - Starting queue listener...
2025-11-30 18:19:14,160 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-30 18:19:14,160 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-30 18:19:14,160 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-30 18:19:14,160 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-30 18:19:14,188 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-30 18:19:14,195 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54214), raddr=('34.196.5.176', 5672)>
2025-11-30 18:19:14,196 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107cfcd70>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107cfcd70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-30 18:19:14,221 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107cfcd70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:19:14,221 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107cfcd70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:19:14,221 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107cfcd70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:19:14,222 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-30 18:19:14,246 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-30 18:19:14,246 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-30 18:19:14,254 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-30 18:19:21,113 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:19:21,117 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:19:21,117 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:19:21,118 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:19:21,260 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:19:21,260 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:19:21,297 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:19:21,297 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:19:21,297 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:19:21,330 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:19:21,330 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:19:21,330 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:19:21,330 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:19:22,560 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:19:22,979 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:23,284 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:23,868 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:24,286 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:24,671 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:24,671 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:19:24,671 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:19:24,734 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:19:24,734 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:24,734 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:24,736 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:24,749 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:19:24,750 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:19:24,750 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:19:24,750 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:19:24,750 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:19:24,750 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:19:24,786 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:19:24,786 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:19:24,786 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:19:24,823 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:19:24,823 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:19:24,823 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:19:24,823 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:19:26,207 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:19:26,306 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:26,818 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:26,948 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:27,607 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:28,130 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:28,130 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:19:28,130 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:19:28,183 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:19:28,184 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:28,184 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:28,186 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:28,194 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:19:28,194 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:19:28,194 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:19:28,194 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:19:28,194 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:19:28,194 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:19:28,230 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:19:28,230 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:19:28,230 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:19:28,333 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:19:28,343 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:19:28,343 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:19:28,343 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:19:29,693 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:19:30,041 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:30,387 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:30,921 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:31,436 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:31,697 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:31,698 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:19:31,699 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:19:31,760 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:19:31,760 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:31,760 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:31,762 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:31,770 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:19:31,770 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:19:31,770 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:19:31,770 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:19:31,770 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:19:31,770 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:19:31,809 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:19:31,809 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:19:31,809 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:19:31,844 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:19:31,845 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:19:31,845 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:19:31,845 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:19:32,971 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:33,329 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:33,683 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:34,022 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:19:34,422 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:35,362 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:35,363 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:19:35,363 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:19:35,421 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:19:35,422 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:35,422 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:35,424 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:35,432 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:19:35,432 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:19:35,432 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:19:35,432 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:19:35,432 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:19:35,432 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:19:35,469 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:19:35,470 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:19:35,470 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:19:35,508 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:19:35,508 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:19:35,508 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:19:35,508 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:19:36,752 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:37,179 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:37,586 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:38,120 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:38,492 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:38,852 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:19:38,853 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:19:38,854 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:19:38,917 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:19:38,917 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:38,917 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:38,918 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:38,928 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:19:38,928 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:19:38,928 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:19:38,928 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:19:38,928 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:19:38,928 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:19:38,960 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:19:38,961 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:19:38,961 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:19:38,992 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:19:38,992 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:19:38,992 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:19:38,992 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:19:40,345 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:40,651 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:40,953 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:41,260 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:19:41,670 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:42,258 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:42,258 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:19:42,258 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:19:42,309 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:19:42,310 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:42,310 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:42,311 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:42,319 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:19:42,319 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:19:42,319 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:19:42,319 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:19:42,319 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:19:42,319 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:19:42,351 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:19:42,352 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:19:42,352 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:19:42,385 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:19:42,385 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:19:42,386 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:19:42,386 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:19:43,619 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:19:44,010 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:44,221 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:44,708 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:45,035 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:45,437 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:45,438 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:19:45,438 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:19:45,501 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:19:45,501 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:45,502 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:45,503 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:45,513 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:19:45,514 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:19:45,514 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:19:45,514 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:19:45,514 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:19:45,514 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:19:45,551 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:19:45,551 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:19:45,551 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:19:45,588 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:19:45,588 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:19:45,588 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:19:45,588 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:19:46,780 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:47,252 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:47,612 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:47,955 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:19:48,600 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:49,202 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:49,203 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:19:49,204 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:19:49,264 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:19:49,264 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:49,264 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:49,266 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:49,274 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:19:49,275 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:19:49,275 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:19:49,275 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:19:49,275 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:19:49,275 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:19:49,312 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:19:49,312 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:19:49,312 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:19:49,351 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:19:49,351 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:19:49,351 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:19:49,351 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:19:50,568 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:50,935 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:51,816 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:52,178 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:52,627 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:19:52,940 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:52,940 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:19:52,941 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:19:53,004 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:19:53,004 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:53,004 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:53,006 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:53,023 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:19:53,023 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:19:53,023 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:19:53,024 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:19:53,024 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:19:53,024 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:19:53,062 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:19:53,062 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:19:53,062 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:19:53,098 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:19:53,098 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:19:53,099 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:19:53,099 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:19:54,332 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:54,676 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:19:54,984 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:55,392 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:55,750 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:56,161 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:56,161 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:19:56,161 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:19:56,219 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:19:56,219 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:56,219 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:56,221 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:19:57,015 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:19:57,016 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:19:57,016 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:19:57,016 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:19:57,016 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:19:57,016 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:19:57,063 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:19:57,064 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:19:57,064 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:19:57,104 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:19:57,104 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:19:57,104 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:19:57,104 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:19:58,192 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:58,678 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:19:58,916 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:19:59,874 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:00,018 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:21:00 EST)" (scheduled at 2025-11-30 18:20:00-05:00)
2025-11-30 18:20:00,020 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 18:20:00,062 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:21:00 EST)" executed successfully
2025-11-30 18:20:00,243 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:01,039 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:01,039 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:20:01,039 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:20:01,091 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:20:01,092 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:01,092 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:01,095 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:01,103 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:20:01,103 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:20:01,103 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:20:01,103 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:20:01,103 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:20:01,103 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:20:01,140 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:20:01,140 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:20:01,140 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:20:01,173 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:20:01,173 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:20:01,173 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:20:01,173 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:20:02,366 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:02,866 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:03,008 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:20:03,344 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:04,190 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:04,686 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:04,687 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:20:04,687 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:20:04,744 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:20:04,745 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:04,745 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:04,746 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:04,754 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:20:04,755 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:20:04,755 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:20:04,755 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:20:04,755 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:20:04,755 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:20:04,791 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:20:04,791 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:20:04,791 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:20:04,826 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:20:04,826 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:20:04,826 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:20:04,826 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:20:05,940 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:06,357 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:06,596 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:07,180 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:07,568 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:07,920 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:20:07,922 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:20:07,922 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:20:07,982 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:20:07,983 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:07,983 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:07,989 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:07,997 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:20:07,998 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:20:07,998 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:20:07,998 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:20:07,998 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:20:07,998 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:20:08,037 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:20:08,037 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:20:08,038 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:20:08,075 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:20:08,076 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:20:08,076 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:20:08,076 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:20:09,149 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:09,627 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:10,021 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:10,548 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:10,958 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:20:11,416 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:11,417 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:20:11,417 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:20:11,472 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:20:11,472 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:11,472 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:11,474 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:11,482 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:20:11,483 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:20:11,483 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:20:11,483 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:20:11,483 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:20:11,483 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:20:11,520 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:20:11,521 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:20:11,521 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:20:11,556 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:20:11,556 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:20:11,556 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:20:11,557 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:20:12,829 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:13,275 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:13,579 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:14,003 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:14,425 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:14,717 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:20:14,717 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:20:14,717 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:20:14,799 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:20:14,799 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:14,799 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:14,800 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:14,812 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:20:14,812 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:20:14,812 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:20:14,813 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:20:14,813 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:20:14,813 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:20:14,854 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:20:14,854 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:20:14,854 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:20:14,896 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:20:14,896 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:20:14,897 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:20:14,897 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:20:16,366 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:16,414 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:16,819 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:17,324 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:20:17,981 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:18,164 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:20:18,164 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:20:18,165 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:20:18,197 - consumer.queue_listener - INFO - Received signal 2, initiating graceful shutdown...
2025-11-30 18:20:18,197 - consumer.queue_listener - INFO - Stopping queue listener...
2025-11-30 18:20:18,212 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107cfcd70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-30 18:20:18,224 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107cfcd70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-30 18:20:18,224 - consumer.queue_listener - INFO - Channel closed
2025-11-30 18:20:18,224 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-30 18:20:18,224 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-30 18:20:18,242 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54214), raddr=('34.196.5.176', 5672)>
2025-11-30 18:20:18,242 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54214), raddr=('34.196.5.176', 5672)>
2025-11-30 18:20:18,242 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54214), raddr=('34.196.5.176', 5672)>
2025-11-30 18:20:18,243 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-30 18:20:18,243 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-30 18:20:18,243 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54214), raddr=('34.196.5.176', 5672)>
2025-11-30 18:20:18,243 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-30 18:20:18,243 - consumer.queue_listener - INFO - Connection closed
2025-11-30 18:20:18,243 - consumer.queue_listener - INFO - Queue listener stopped
2025-11-30 18:20:18,295 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:20:18,295 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:18,295 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:18,297 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:20:18,298 - consumer.queue_listener - ERROR - Error in consumer: Channel is closed.
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 851, in process_data_events
    self._dispatch_channel_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 567, in _dispatch_channel_events
    impl_channel._get_cookie()._dispatch_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1510, in _dispatch_events
    consumer_info.on_message_callback(self, evt.method,
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
                                      evt.properties, evt.body)
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 164, in _on_message
    channel.basic_nack(delivery_tag=method.delivery_tag, requeue=True)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2151, in basic_nack
    self._impl.basic_nack(
    ~~~~~~~~~~~~~~~~~~~~~^
        delivery_tag=delivery_tag, multiple=multiple, requeue=requeue)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 401, in basic_nack
    self._raise_if_not_open()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 1403, in _raise_if_not_open
    raise exceptions.ChannelWrongStateError('Channel is closed.')
pika.exceptions.ChannelWrongStateError: Channel is closed.
2025-11-30 18:20:18,304 - __main__ - ERROR - Fatal error: Channel is closed.
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/run.py", line 78, in main
    listener.start()
    ~~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 851, in process_data_events
    self._dispatch_channel_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 567, in _dispatch_channel_events
    impl_channel._get_cookie()._dispatch_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1510, in _dispatch_events
    consumer_info.on_message_callback(self, evt.method,
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
                                      evt.properties, evt.body)
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 164, in _on_message
    channel.basic_nack(delivery_tag=method.delivery_tag, requeue=True)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2151, in basic_nack
    self._impl.basic_nack(
    ~~~~~~~~~~~~~~~~~~~~~^
        delivery_tag=delivery_tag, multiple=multiple, requeue=requeue)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 401, in basic_nack
    self._raise_if_not_open()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 1403, in _raise_if_not_open
    raise exceptions.ChannelWrongStateError('Channel is closed.')
pika.exceptions.ChannelWrongStateError: Channel is closed.
2025-11-30 18:20:18,307 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-11-30 18:20:18,307 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-11-30 18:20:18,307 - __main__ - INFO - ============================================================
2025-11-30 18:20:18,307 - __main__ - INFO - Notification Service Stopped
2025-11-30 18:20:18,308 - __main__ - INFO - ============================================================
2025-11-30 18:21:19,639 - __main__ - INFO - ============================================================
2025-11-30 18:21:19,639 - __main__ - INFO - Starting Notification Service
2025-11-30 18:21:19,639 - __main__ - INFO - ============================================================
2025-11-30 18:21:19,639 - __main__ - INFO - Initializing database...
2025-11-30 18:21:19,639 - data.database - INFO - Initializing database...
2025-11-30 18:21:19,846 - data.database - INFO - Database initialized successfully
2025-11-30 18:21:19,846 - __main__ - INFO - Database initialized successfully
2025-11-30 18:21:19,847 - __main__ - INFO - Starting reminder scheduler...
2025-11-30 18:21:19,847 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-30 18:21:19,853 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-30 18:21:19,854 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-30 18:21:19,854 - apscheduler.scheduler - INFO - Scheduler started
2025-11-30 18:21:19,854 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-11-30 18:21:19,854 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-30 18:21:19,854 - __main__ - INFO - Starting queue listener...
2025-11-30 18:21:19,854 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-30 18:21:19,854 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-30 18:21:19,855 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-30 18:21:19,855 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-30 18:21:19,874 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-30 18:21:19,880 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54555), raddr=('34.196.5.176', 5672)>
2025-11-30 18:21:19,881 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107f00d70>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107f00d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-30 18:21:19,902 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107f00d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:21:19,903 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107f00d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:21:19,903 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107f00d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:21:19,903 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-30 18:21:19,923 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-30 18:21:19,923 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-30 18:21:19,931 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-30 18:21:27,916 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:21:27,918 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:21:27,918 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:21:27,918 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:21:28,075 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:21:28,075 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:21:28,119 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:21:28,120 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:21:28,120 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:21:28,154 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:21:28,154 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:21:28,154 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:21:28,154 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:21:28,321 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:28,321 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:28,321 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 1/3)
2025-11-30 18:21:28,321 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:28,321 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:28,321 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 1/3)
2025-11-30 18:21:28,322 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:28,322 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Unexpected EOF received
2025-11-30 18:21:28,322 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 1/3)
2025-11-30 18:21:28,325 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:28,325 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:28,325 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 1/3)
2025-11-30 18:21:28,338 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:28,339 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:28,339 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 1/3)
2025-11-30 18:21:28,349 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:28,349 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:28,349 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 1/3)
2025-11-30 18:21:33,515 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:33,515 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:33,515 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 2/3)
2025-11-30 18:21:33,517 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:33,517 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:33,517 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 2/3)
2025-11-30 18:21:33,521 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:33,521 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:33,521 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 2/3)
2025-11-30 18:21:33,521 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:33,521 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:33,521 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 2/3)
2025-11-30 18:21:33,522 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:33,522 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Unexpected EOF received
2025-11-30 18:21:33,522 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 2/3)
2025-11-30 18:21:33,534 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:33,534 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:33,534 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 2/3)
2025-11-30 18:21:38,716 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:38,717 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:38,717 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 3/3)
2025-11-30 18:21:38,717 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:38,717 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:38,717 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 3/3)
2025-11-30 18:21:38,717 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:38,717 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:38,717 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 3/3)
2025-11-30 18:21:38,719 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:38,719 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Unexpected EOF received
2025-11-30 18:21:38,719 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 3/3)
2025-11-30 18:21:38,720 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:38,720 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:38,720 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 3/3)
2025-11-30 18:21:38,729 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:38,729 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:38,729 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 3/3)
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu after 3 retries
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu after 3 retries
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu after 3 retries
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu after 3 retries
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Unexpected EOF received
2025-11-30 18:21:43,912 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu after 3 retries
2025-11-30 18:21:43,921 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:43,921 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:43,921 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu after 3 retries
2025-11-30 18:21:43,921 - email_service.email_service - INFO - Batch email results: 0 successful, 6 failed
2025-11-30 18:21:43,921 - processor.notification_processor - INFO - Batch 1 complete: 0 sent, 6 failed
2025-11-30 18:21:43,966 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:21:43,966 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:21:43,966 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:21:43,967 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:21:43,977 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:21:43,977 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:21:43,977 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:21:43,977 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:21:43,977 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:21:43,977 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:21:44,009 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:21:44,009 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:21:44,009 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:21:44,040 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:21:44,041 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:21:44,041 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:21:44,041 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:21:44,218 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:44,218 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:44,218 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 1/3)
2025-11-30 18:21:44,218 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:44,218 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Unexpected EOF received
2025-11-30 18:21:44,218 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 1/3)
2025-11-30 18:21:44,218 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:44,218 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:44,218 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 1/3)
2025-11-30 18:21:44,218 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:44,218 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:44,218 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 1/3)
2025-11-30 18:21:44,219 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:44,219 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:44,219 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 1/3)
2025-11-30 18:21:44,236 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:44,236 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:44,236 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 1/3)
2025-11-30 18:21:49,413 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:49,413 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:49,413 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 2/3)
2025-11-30 18:21:49,415 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:49,415 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:49,415 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 2/3)
2025-11-30 18:21:49,416 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:49,416 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:49,416 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 2/3)
2025-11-30 18:21:49,417 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:49,417 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Unexpected EOF received
2025-11-30 18:21:49,417 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 2/3)
2025-11-30 18:21:49,418 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:49,418 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:49,418 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 2/3)
2025-11-30 18:21:49,425 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:49,425 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:49,425 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 2/3)
2025-11-30 18:21:54,607 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:54,607 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:54,607 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 3/3)
2025-11-30 18:21:54,611 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:54,611 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:54,611 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 3/3)
2025-11-30 18:21:54,611 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:54,611 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:54,611 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 3/3)
2025-11-30 18:21:54,612 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:54,612 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:54,613 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 3/3)
2025-11-30 18:21:54,616 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:54,616 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Unexpected EOF received
2025-11-30 18:21:54,616 - email_service.email_service - INFO - Retrying email to chetank@umd.edu (attempt 3/3)
2025-11-30 18:21:54,625 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:54,625 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:54,625 - email_service.email_service - INFO - Retrying email to nikhilvb@umd.edu (attempt 3/3)
2025-11-30 18:21:59,753 - consumer.queue_listener - INFO - Received signal 2, initiating graceful shutdown...
2025-11-30 18:21:59,754 - consumer.queue_listener - INFO - Stopping queue listener...
2025-11-30 18:21:59,760 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107f00d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-30 18:21:59,769 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x107f00d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-30 18:21:59,770 - consumer.queue_listener - INFO - Channel closed
2025-11-30 18:21:59,770 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-30 18:21:59,770 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-30 18:21:59,777 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54555), raddr=('34.196.5.176', 5672)>
2025-11-30 18:21:59,778 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54555), raddr=('34.196.5.176', 5672)>
2025-11-30 18:21:59,778 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54555), raddr=('34.196.5.176', 5672)>
2025-11-30 18:21:59,778 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-30 18:21:59,778 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-30 18:21:59,778 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54555), raddr=('34.196.5.176', 5672)>
2025-11-30 18:21:59,778 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-30 18:21:59,778 - consumer.queue_listener - INFO - Connection closed
2025-11-30 18:21:59,778 - consumer.queue_listener - INFO - Queue listener stopped
2025-11-30 18:21:59,822 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:59,822 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu: Unexpected EOF received
2025-11-30 18:21:59,822 - email_service.email_service - ERROR - Failed to send email to chetank@umd.edu after 3 retries
2025-11-30 18:21:59,826 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:59,826 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:59,826 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu after 3 retries
2025-11-30 18:21:59,826 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:59,826 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:59,826 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu after 3 retries
2025-11-30 18:21:59,831 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:59,831 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:59,831 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu after 3 retries
2025-11-30 18:21:59,839 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:59,839 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:59,839 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu after 3 retries
2025-11-30 18:21:59,842 - email_service.email_service - ERROR - SMTP error: SMTPServerDisconnected: Unexpected EOF received
2025-11-30 18:21:59,842 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu: Unexpected EOF received
2025-11-30 18:21:59,842 - email_service.email_service - ERROR - Failed to send email to nikhilvb@umd.edu after 3 retries
2025-11-30 18:21:59,843 - email_service.email_service - INFO - Batch email results: 0 successful, 6 failed
2025-11-30 18:21:59,843 - processor.notification_processor - INFO - Batch 1 complete: 0 sent, 6 failed
2025-11-30 18:21:59,885 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:21:59,885 - api.booking_client - ERROR - HTTP error fetching booking batch: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:21:59,885 - data.repository - ERROR - Error fetching participants from API: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:21:59,886 - consumer.queue_listener - ERROR - Error processing message: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-11-30 18:21:59,886 - consumer.queue_listener - ERROR - Error in consumer: Channel is closed.
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 851, in process_data_events
    self._dispatch_channel_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 567, in _dispatch_channel_events
    impl_channel._get_cookie()._dispatch_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1510, in _dispatch_events
    consumer_info.on_message_callback(self, evt.method,
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
                                      evt.properties, evt.body)
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 164, in _on_message
    channel.basic_nack(delivery_tag=method.delivery_tag, requeue=True)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2151, in basic_nack
    self._impl.basic_nack(
    ~~~~~~~~~~~~~~~~~~~~~^
        delivery_tag=delivery_tag, multiple=multiple, requeue=requeue)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 401, in basic_nack
    self._raise_if_not_open()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 1403, in _raise_if_not_open
    raise exceptions.ChannelWrongStateError('Channel is closed.')
pika.exceptions.ChannelWrongStateError: Channel is closed.
2025-11-30 18:21:59,890 - __main__ - ERROR - Fatal error: Channel is closed.
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 80, in process
    participants = repo.get_participants_by_event(
        event_id=event.event_id,
        offset=offset,
        limit=self.batch_size
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 48, in get_participants_by_event
    participants = self.booking_client.get_bookings_batch(
        event_id=event_id,
        offset=offset,
        batch_size=limit
    )
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 107, in get_bookings_batch
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/run.py", line 78, in main
    listener.start()
    ~~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 851, in process_data_events
    self._dispatch_channel_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 567, in _dispatch_channel_events
    impl_channel._get_cookie()._dispatch_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1510, in _dispatch_events
    consumer_info.on_message_callback(self, evt.method,
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
                                      evt.properties, evt.body)
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 164, in _on_message
    channel.basic_nack(delivery_tag=method.delivery_tag, requeue=True)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2151, in basic_nack
    self._impl.basic_nack(
    ~~~~~~~~~~~~~~~~~~~~~^
        delivery_tag=delivery_tag, multiple=multiple, requeue=requeue)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 401, in basic_nack
    self._raise_if_not_open()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 1403, in _raise_if_not_open
    raise exceptions.ChannelWrongStateError('Channel is closed.')
pika.exceptions.ChannelWrongStateError: Channel is closed.
2025-11-30 18:21:59,891 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-11-30 18:21:59,891 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-11-30 18:21:59,891 - __main__ - INFO - ============================================================
2025-11-30 18:21:59,891 - __main__ - INFO - Notification Service Stopped
2025-11-30 18:21:59,891 - __main__ - INFO - ============================================================
2025-11-30 18:21:59,910 - asyncio - ERROR - Future exception was never retrieved
future: <Future finished exception=SMTPServerDisconnected('Connection lost')>
aiosmtplib.errors.SMTPServerDisconnected: Connection lost
2025-11-30 18:21:59,910 - asyncio - ERROR - Future exception was never retrieved
future: <Future finished exception=SMTPServerDisconnected('Connection lost')>
aiosmtplib.errors.SMTPServerDisconnected: Connection lost
2025-11-30 18:21:59,910 - asyncio - ERROR - Future exception was never retrieved
future: <Future finished exception=SMTPServerDisconnected('Connection lost')>
aiosmtplib.errors.SMTPServerDisconnected: Connection lost
2025-11-30 18:21:59,910 - asyncio - ERROR - Future exception was never retrieved
future: <Future finished exception=SMTPServerDisconnected('Connection lost')>
aiosmtplib.errors.SMTPServerDisconnected: Connection lost
2025-11-30 18:21:59,910 - asyncio - ERROR - Future exception was never retrieved
future: <Future finished exception=SMTPServerDisconnected('Connection lost')>
aiosmtplib.errors.SMTPServerDisconnected: Connection lost
2025-11-30 18:21:59,910 - asyncio - ERROR - Future exception was never retrieved
future: <Future finished exception=SMTPServerDisconnected('Connection lost')>
aiosmtplib.errors.SMTPServerDisconnected: Connection lost
2025-11-30 18:23:44,813 - __main__ - INFO - ============================================================
2025-11-30 18:23:44,816 - __main__ - INFO - Starting Notification Service
2025-11-30 18:23:44,816 - __main__ - INFO - ============================================================
2025-11-30 18:23:44,816 - __main__ - INFO - Initializing database...
2025-11-30 18:23:44,816 - data.database - INFO - Initializing database...
2025-11-30 18:23:45,103 - data.database - INFO - Database initialized successfully
2025-11-30 18:23:45,103 - __main__ - INFO - Database initialized successfully
2025-11-30 18:23:45,103 - __main__ - INFO - Starting reminder scheduler...
2025-11-30 18:23:45,103 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-30 18:23:45,107 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-30 18:23:45,108 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-30 18:23:45,108 - apscheduler.scheduler - INFO - Scheduler started
2025-11-30 18:23:45,108 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-11-30 18:23:45,108 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-30 18:23:45,108 - __main__ - INFO - Starting queue listener...
2025-11-30 18:23:45,108 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-30 18:23:45,108 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-30 18:23:45,108 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-30 18:23:45,108 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-30 18:23:45,126 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-30 18:23:45,133 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54836), raddr=('34.196.5.176', 5672)>
2025-11-30 18:23:45,134 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103a80d70>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103a80d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-30 18:23:45,156 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103a80d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:23:45,157 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103a80d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:23:45,157 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103a80d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:23:45,157 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-30 18:23:45,179 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-30 18:23:45,179 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-30 18:23:45,187 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-30 18:23:45,193 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:23:45,193 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:23:45,193 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:23:45,193 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:23:45,299 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:23:45,299 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:23:45,343 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:23:45,343 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:23:45,343 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:23:45,382 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:23:45,382 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:23:45,382 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:23:45,383 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:23:46,507 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:23:47,123 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:23:47,620 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:23:48,004 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:23:48,341 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:23:48,563 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:23:48,564 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:23:48,565 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:23:48,626 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:23:48,626 - api.booking_client - INFO - No more bookings available for event_id=10111111-1111-1111-1111-111111111111 at offset=100 (404 response)
2025-11-30 18:23:48,626 - processor.notification_processor - INFO - No more participants to process
2025-11-30 18:23:48,626 - processor.notification_processor - INFO - Processing complete for event_id=10111111-1111-1111-1111-111111111111: 6 emails sent successfully, 0 failed out of 6 total
2025-11-30 18:23:48,628 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:24:00,010 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:25:00 EST)" (scheduled at 2025-11-30 18:24:00-05:00)
2025-11-30 18:24:00,012 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-11-30 18:24:00,071 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-11-30 18:25:00 EST)" executed successfully
2025-11-30 18:24:38,758 - consumer.queue_listener - INFO - Received signal 2, initiating graceful shutdown...
2025-11-30 18:24:38,760 - consumer.queue_listener - INFO - Stopping queue listener...
2025-11-30 18:24:38,771 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103a80d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-30 18:24:38,778 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103a80d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-30 18:24:38,779 - consumer.queue_listener - INFO - Channel closed
2025-11-30 18:24:38,779 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-30 18:24:38,779 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-30 18:24:38,785 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54836), raddr=('34.196.5.176', 5672)>
2025-11-30 18:24:38,786 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54836), raddr=('34.196.5.176', 5672)>
2025-11-30 18:24:38,786 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54836), raddr=('34.196.5.176', 5672)>
2025-11-30 18:24:38,786 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-30 18:24:38,787 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-30 18:24:38,787 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.135', 54836), raddr=('34.196.5.176', 5672)>
2025-11-30 18:24:38,787 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-30 18:24:38,788 - consumer.queue_listener - INFO - Connection closed
2025-11-30 18:24:38,788 - consumer.queue_listener - INFO - Queue listener stopped
2025-11-30 18:24:38,788 - consumer.queue_listener - ERROR - Error in consumer: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-11-30 18:24:38,793 - __main__ - ERROR - Fatal error: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/run.py", line 78, in main
    listener.start()
    ~~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-11-30 18:24:38,795 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-11-30 18:24:38,795 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-11-30 18:24:38,795 - __main__ - INFO - ============================================================
2025-11-30 18:24:38,795 - __main__ - INFO - Notification Service Stopped
2025-11-30 18:24:38,795 - __main__ - INFO - ============================================================
2025-11-30 18:31:28,328 - __main__ - INFO - ============================================================
2025-11-30 18:31:28,328 - __main__ - INFO - Starting Notification Service
2025-11-30 18:31:28,328 - __main__ - INFO - ============================================================
2025-11-30 18:31:28,328 - __main__ - INFO - Initializing database...
2025-11-30 18:31:28,328 - data.database - INFO - Initializing notification database...
2025-11-30 18:31:28,564 - data.database - INFO - Notification database initialized successfully
2025-11-30 18:31:28,564 - __main__ - INFO - Database initialized successfully
2025-11-30 18:31:28,564 - __main__ - INFO - Starting reminder scheduler...
2025-11-30 18:31:28,564 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-11-30 18:31:28,571 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-11-30 18:31:28,572 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-11-30 18:31:28,572 - apscheduler.scheduler - INFO - Scheduler started
2025-11-30 18:31:28,572 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-11-30 18:31:28,572 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-11-30 18:31:28,572 - __main__ - INFO - Starting queue listener...
2025-11-30 18:31:28,572 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-11-30 18:31:28,572 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-11-30 18:31:28,572 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-11-30 18:31:28,573 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-11-30 18:31:28,592 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-11-30 18:31:28,600 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.135', 55538), raddr=('34.196.5.176', 5672)>
2025-11-30 18:31:28,600 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081cf8c0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081cf8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-11-30 18:31:28,624 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081cf8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:31:28,624 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081cf8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:31:28,624 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081cf8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-11-30 18:31:28,625 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-11-30 18:31:28,648 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-11-30 18:31:28,648 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-11-30 18:31:28,656 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-11-30 18:31:31,979 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "10111111-1111-1111-1111-111111111111", "event_name": "Sagar Wagh Amazon DynamoDB Lecture Please Attend 2", "description": null, "start_time": "2025-11-21T18:57:00", "end_time": "2025-11-21T18:59:00", "organizer_id": "3827df91-2d63-4f87-865d-0dff20893db5", "location": "12", "remaining_seats": 2}}
2025-11-30 18:31:31,980 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:31:31,981 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2
2025-11-30 18:31:31,981 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-11-30 18:31:32,116 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-11-30 18:31:32,117 - data.repository - INFO - ParticipantRepository initialized with API client
2025-11-30 18:31:32,166 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=10111111-1111-1111-1111-111111111111 "HTTP/1.1 200 OK"
2025-11-30 18:31:32,167 - api.booking_client - INFO - Retrieved booking count for event_id=10111111-1111-1111-1111-111111111111: 6
2025-11-30 18:31:32,167 - processor.notification_processor - INFO - Step 3: Total participants to process: 6
2025-11-30 18:31:32,201 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-11-30 18:31:32,201 - api.booking_client - INFO - Retrieved 6 bookings for event_id=10111111-1111-1111-1111-111111111111, offset=0
2025-11-30 18:31:32,201 - processor.notification_processor - INFO - Step 4: Processing batch 1 (6 participants, offset=0)
2025-11-30 18:31:32,201 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-11-30 18:31:33,339 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:31:33,702 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:31:34,041 - email_service.email_service - INFO - Email sent successfully to chetank@umd.edu
2025-11-30 18:31:34,624 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:31:35,099 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:31:35,461 - email_service.email_service - INFO - Email sent successfully to nikhilvb@umd.edu
2025-11-30 18:31:35,462 - email_service.email_service - INFO - Batch email results: 6 successful, 0 failed
2025-11-30 18:31:35,462 - processor.notification_processor - INFO - Batch 1 complete: 6 sent, 0 failed
2025-11-30 18:31:35,513 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=10111111-1111-1111-1111-111111111111&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-11-30 18:31:35,514 - api.booking_client - INFO - No more bookings available for event_id=10111111-1111-1111-1111-111111111111 at offset=100 (404 response)
2025-11-30 18:31:35,514 - processor.notification_processor - INFO - No more participants to process
2025-11-30 18:31:35,514 - processor.notification_processor - INFO - Processing complete for event_id=10111111-1111-1111-1111-111111111111: 6 emails sent successfully, 0 failed out of 6 total
2025-11-30 18:31:35,515 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=10111111-1111-1111-1111-111111111111, event_name=Sagar Wagh Amazon DynamoDB Lecture Please Attend 2)
2025-11-30 18:31:43,776 - consumer.queue_listener - INFO - Received signal 2, initiating graceful shutdown...
2025-11-30 18:31:43,778 - consumer.queue_listener - INFO - Stopping queue listener...
2025-11-30 18:31:43,788 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081cf8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-30 18:31:43,796 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081cf8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-11-30 18:31:43,797 - consumer.queue_listener - INFO - Channel closed
2025-11-30 18:31:43,797 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-11-30 18:31:43,797 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-11-30 18:31:43,804 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.135', 55538), raddr=('34.196.5.176', 5672)>
2025-11-30 18:31:43,804 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.135', 55538), raddr=('34.196.5.176', 5672)>
2025-11-30 18:31:43,804 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.135', 55538), raddr=('34.196.5.176', 5672)>
2025-11-30 18:31:43,804 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-30 18:31:43,804 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-11-30 18:31:43,805 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.135', 55538), raddr=('34.196.5.176', 5672)>
2025-11-30 18:31:43,805 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-11-30 18:31:43,805 - consumer.queue_listener - INFO - Connection closed
2025-11-30 18:31:43,805 - consumer.queue_listener - INFO - Queue listener stopped
2025-11-30 18:31:43,805 - consumer.queue_listener - ERROR - Error in consumer: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-11-30 18:31:43,809 - __main__ - ERROR - Fatal error: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/run.py", line 78, in main
    listener.start()
    ~~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-11-30 18:31:43,814 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-11-30 18:31:43,814 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-11-30 18:31:43,814 - __main__ - INFO - ============================================================
2025-11-30 18:31:43,814 - __main__ - INFO - Notification Service Stopped
2025-11-30 18:31:43,814 - __main__ - INFO - ============================================================
2025-12-01 17:57:37,575 - __main__ - INFO - ============================================================
2025-12-01 17:57:37,576 - __main__ - INFO - Starting Notification Service
2025-12-01 17:57:37,576 - __main__ - INFO - ============================================================
2025-12-01 17:57:37,576 - __main__ - INFO - Initializing database...
2025-12-01 17:57:37,576 - data.database - INFO - Initializing notification database...
2025-12-01 17:57:37,944 - data.database - INFO - Notification database initialized successfully
2025-12-01 17:57:37,944 - __main__ - INFO - Database initialized successfully
2025-12-01 17:57:37,944 - __main__ - INFO - Starting reminder scheduler...
2025-12-01 17:57:37,944 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-12-01 17:57:37,949 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-12-01 17:57:37,950 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-12-01 17:57:37,950 - apscheduler.scheduler - INFO - Scheduler started
2025-12-01 17:57:37,950 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-12-01 17:57:37,950 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-12-01 17:57:37,950 - __main__ - INFO - Starting queue listener...
2025-12-01 17:57:37,950 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-12-01 17:57:37,950 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-12-01 17:57:37,950 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-12-01 17:57:37,950 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-12-01 17:57:37,983 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-12-01 17:57:37,992 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 53650), raddr=('34.196.5.176', 5672)>
2025-12-01 17:57:37,993 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10608f8c0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10608f8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-12-01 17:57:38,022 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10608f8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 17:57:38,022 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10608f8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 17:57:38,022 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10608f8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 17:57:38,023 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-12-01 17:57:38,050 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-12-01 17:57:38,050 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-12-01 17:57:38,060 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-12-01 17:57:38,070 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,071 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,071 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,071 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,190 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,191 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,210 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,210 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,210 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,287 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,288 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,288 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,288 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,288 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,288 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,303 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,303 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,303 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,313 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,313 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,313 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,313 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,313 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,313 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,327 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,327 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,327 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,336 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,336 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,336 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,336 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,336 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,336 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,350 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,350 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,350 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,359 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,360 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,360 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,360 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,360 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,360 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,372 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,372 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,373 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,383 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,383 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,383 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,384 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,384 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,384 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,396 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,396 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,397 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,406 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,406 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,406 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,406 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,406 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,406 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,419 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,419 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,420 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,430 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,430 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,430 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,430 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,430 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,430 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,447 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,447 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,447 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,457 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,457 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,457 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,457 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,458 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,458 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,470 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,470 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,470 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,478 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,478 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,478 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,478 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,478 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,478 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,491 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,491 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,491 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,502 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,502 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,502 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,502 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,502 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,502 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,514 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,514 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,515 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,524 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,524 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,524 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,524 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,524 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,524 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,536 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,536 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,536 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,545 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,545 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,545 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,545 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,545 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,545 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,558 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,558 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,558 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,567 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,567 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,567 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,567 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,567 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,567 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,580 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,580 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,580 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,589 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,589 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,589 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,589 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,589 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,589 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,601 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,602 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,602 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,612 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,612 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,612 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,612 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,612 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,612 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,625 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,625 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,625 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,634 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,634 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,634 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,634 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,634 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,634 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,647 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,647 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,647 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,657 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,658 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,658 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,658 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,658 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,658 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,670 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,670 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,670 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,682 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,682 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,682 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,682 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,682 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,682 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,696 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,696 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,696 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,715 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,715 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,715 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,715 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,715 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,715 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,727 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,728 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,728 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,738 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,738 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,738 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,738 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,738 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,739 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,751 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,751 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,751 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,760 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,760 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,760 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,761 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,761 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,761 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,773 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,773 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,773 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,781 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,781 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,781 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,781 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,781 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,781 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,794 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,794 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,794 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,804 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,804 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,804 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,804 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,804 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,804 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,817 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,817 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,817 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,827 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,827 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,827 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,827 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,827 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,827 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,839 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,839 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,840 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,850 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,850 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,850 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,850 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,850 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,850 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,863 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,863 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,863 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,875 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,876 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,876 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,876 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,876 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,876 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,888 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,888 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,888 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,899 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,899 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,899 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,899 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,899 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,899 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,912 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,912 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,912 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,922 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,922 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,922 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,922 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,922 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,922 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,934 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,934 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,935 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,944 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,944 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,944 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,944 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,944 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,944 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,957 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,957 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,957 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,969 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,969 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,969 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,969 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,969 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,969 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:38,982 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:38,982 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:38,982 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:38,997 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:38,998 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:38,998 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:38,998 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:38,998 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:38,998 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,010 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,010 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,011 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,020 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,020 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,020 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,020 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,020 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,020 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,032 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,033 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,033 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,041 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,041 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,041 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,041 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,041 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,041 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,054 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,054 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,054 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,064 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,064 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,064 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,064 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,064 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,064 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,077 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,077 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,077 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,088 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,088 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,088 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,088 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,088 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,088 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,100 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,100 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,101 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,112 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,112 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,112 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,112 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,112 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,112 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,124 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,124 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,125 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,135 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,135 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,135 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,135 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,135 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,135 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,148 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,148 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,148 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,158 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,158 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,158 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,158 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,158 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,158 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,171 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,171 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,171 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,183 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,183 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,183 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,183 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,183 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,183 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,196 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,196 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,196 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,207 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,207 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,207 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,207 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,207 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,207 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,220 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,220 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,220 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,229 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,229 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,229 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,229 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,229 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,229 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,242 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,242 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,242 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,252 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,253 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,253 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,253 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,253 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,253 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,265 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,265 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,265 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,289 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,289 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,289 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,289 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,289 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,289 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,302 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,302 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,302 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,312 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,312 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,312 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,312 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,312 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,312 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,324 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,325 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,325 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,333 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,333 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,333 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,333 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,333 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,333 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,346 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,346 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,346 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,356 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,356 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,356 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,356 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,356 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,356 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,368 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,368 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,368 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,377 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,378 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,378 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,378 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,378 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,378 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,390 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,390 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,390 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,400 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,400 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,400 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,400 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,400 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,400 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,412 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,412 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,412 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,422 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,422 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,422 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,422 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,422 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,422 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,434 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,434 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,435 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,444 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,444 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,444 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,444 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,444 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,444 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,456 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,456 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,457 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,466 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,466 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,466 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,466 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,466 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,466 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,478 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,478 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,479 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,491 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,491 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,491 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,491 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,491 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,491 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,504 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,504 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,504 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,514 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,514 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,514 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,514 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,514 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,514 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,527 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,527 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,527 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,536 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,537 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,537 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,537 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,537 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,537 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,549 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,549 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,549 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,566 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,566 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,566 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,566 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,566 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,566 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,579 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,579 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,579 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,587 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,587 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,587 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,587 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,587 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,587 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,600 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,600 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,600 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,612 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,612 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,612 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,612 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,612 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,612 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,625 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,625 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,625 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,635 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,635 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,635 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,635 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,635 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,635 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,648 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,648 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,648 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,658 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,658 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,658 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,658 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,658 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,658 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,670 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,670 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,671 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,679 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,679 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,679 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,679 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,679 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,679 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,692 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,692 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,692 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,702 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,702 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,702 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,702 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,702 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,702 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,715 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,715 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,715 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,723 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,723 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,723 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,723 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,723 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,723 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,735 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,735 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,736 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,745 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,745 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,745 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,745 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,745 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,745 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,758 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,758 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,758 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,768 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,768 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,768 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,768 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,768 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,768 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,781 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,781 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,781 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,792 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,792 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,792 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,792 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,792 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,792 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,804 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,804 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,804 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,820 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,822 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,822 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,822 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,822 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,822 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,871 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,871 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,872 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,892 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,893 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,893 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,893 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,893 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,893 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,905 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,905 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,905 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,916 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,916 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,916 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,916 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,916 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,916 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,928 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,928 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,929 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,937 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,937 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,937 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,937 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,937 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,937 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,949 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,949 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,949 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,957 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,957 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,957 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,957 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,957 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,957 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,969 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,969 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,970 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:39,980 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:39,980 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:39,980 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:39,980 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:39,980 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:39,980 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:39,992 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:39,992 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:39,993 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,002 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,002 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,002 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,002 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,003 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,003 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,015 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,015 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,015 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,026 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,026 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,026 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,026 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,026 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,026 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,038 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,038 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,038 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,047 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,048 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,048 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,048 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,048 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,048 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,060 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,060 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,060 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,072 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,072 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,072 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,072 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,072 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,072 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,084 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,084 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,085 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,093 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,093 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,093 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,093 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,094 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,094 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,106 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,106 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,106 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,116 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,116 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,116 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,116 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,116 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,116 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,129 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,129 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,129 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,138 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,138 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,138 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,138 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,138 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,138 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,151 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,151 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,151 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,168 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,168 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,168 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,168 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,168 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,168 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,181 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,181 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,181 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,191 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,191 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,191 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,191 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,191 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,191 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,204 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,204 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,204 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,214 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,214 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,214 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,214 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,214 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,214 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,227 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,227 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,227 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,239 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,240 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,240 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,240 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,240 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,240 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,252 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,252 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,252 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,260 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,260 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,260 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,260 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,260 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,260 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,272 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,272 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,273 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,282 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,282 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,282 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,282 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,282 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,282 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,294 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,294 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,295 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,303 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,303 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,303 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,303 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,303 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,304 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,316 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,316 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,316 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,326 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,326 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,326 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,326 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,326 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,326 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,338 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,338 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,338 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,348 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,348 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,348 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,348 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,348 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,348 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,361 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,361 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,361 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,370 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,370 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,370 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,370 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,370 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,370 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,383 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,383 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,383 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,393 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,393 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,393 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,393 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,393 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,393 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,405 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,405 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,405 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,414 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,414 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,414 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,414 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,414 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,414 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,427 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,427 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,427 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,444 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,444 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,444 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,444 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,444 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,444 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,457 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,457 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,457 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,466 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,466 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,466 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,466 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,466 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,466 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,478 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,478 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,479 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,489 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,489 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,489 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,489 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,489 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,489 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,501 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,501 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,501 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,509 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,509 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,509 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,509 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,509 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,509 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,521 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,521 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,521 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,531 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,531 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,531 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,531 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,532 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,532 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,544 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,544 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,544 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,555 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,555 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,555 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,556 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,556 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,556 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,568 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,568 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,568 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,577 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,577 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,577 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,577 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,577 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,577 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,590 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,590 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,590 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,600 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,600 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,600 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,600 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,600 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,600 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,613 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,613 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,613 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,621 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,621 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,621 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,621 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,621 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,621 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,633 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,633 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,633 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,643 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,644 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,644 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,644 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,644 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,644 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,656 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,656 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,656 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,666 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,666 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,666 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,666 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,666 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,666 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,678 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,678 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,678 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,690 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,690 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,690 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,690 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,690 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,690 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,702 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,702 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,702 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,720 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,720 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,720 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,720 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,720 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,720 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,733 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,733 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,733 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,741 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,741 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,741 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,741 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,741 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,741 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,753 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,753 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,753 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,761 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,761 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,761 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,761 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,761 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,761 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,774 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,774 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,774 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,784 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,784 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,784 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,784 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,784 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,784 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,797 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,797 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,797 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,805 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,805 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,805 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,805 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,805 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,805 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,818 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,818 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,818 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,828 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,828 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,828 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,828 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,828 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,829 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,841 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,841 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,841 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,852 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,853 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,853 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,853 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,853 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,853 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,865 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,865 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,866 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,875 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,875 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,875 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,875 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,875 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,875 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,887 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,887 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,887 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,896 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,896 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,896 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,896 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,896 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,896 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,908 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,909 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,909 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,918 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,918 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,918 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,918 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,918 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,918 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,930 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,930 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,931 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,939 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,939 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,939 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,939 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,939 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,939 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,952 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,952 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,952 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,961 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,962 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,962 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,962 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,962 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,962 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:40,974 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:40,974 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:40,974 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:40,991 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:40,993 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:40,993 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:40,993 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:40,993 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:40,993 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,005 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,005 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,005 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,014 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,014 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,014 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,014 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,014 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,014 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,027 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,027 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,027 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,036 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,036 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,036 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,036 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,036 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,036 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,049 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,049 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,049 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,062 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,062 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,062 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,062 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,062 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,062 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,075 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,075 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,075 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,092 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,092 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,092 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,092 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,092 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,092 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,105 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,105 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,105 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,132 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,132 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,132 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,132 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,132 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,132 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,145 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,145 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,145 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,172 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,172 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,172 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,172 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,172 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,172 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,185 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,185 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,185 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,233 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,234 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,234 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,234 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,234 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,234 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,247 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,247 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,247 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,273 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,273 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,273 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,273 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,273 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,273 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,286 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,286 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,286 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,301 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,301 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,301 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,301 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,301 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,301 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,314 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,314 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,315 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,325 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,326 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,326 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,326 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,326 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,326 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,339 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,339 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,339 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,353 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,353 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,353 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,354 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,354 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,354 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,367 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,367 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,367 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,389 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,389 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,389 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,389 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,389 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,389 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,401 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,401 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,402 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,415 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,415 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,415 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,415 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,415 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,415 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,428 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,428 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,428 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,439 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,439 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,439 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,439 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,439 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,439 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,451 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,451 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,452 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,465 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,465 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,465 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,465 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,465 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,465 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,477 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,478 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,478 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,490 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,490 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,490 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,490 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,490 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,490 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,502 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,502 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,502 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,519 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,519 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,519 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,519 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,519 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,519 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,532 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,532 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,532 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,559 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,559 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,559 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,559 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,559 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,559 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,572 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,572 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,572 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,595 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,595 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,595 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,595 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,595 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,595 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,608 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,608 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,609 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,625 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,625 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,625 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,625 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,625 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,625 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,639 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,639 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,639 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,656 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,656 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,656 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,656 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,656 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,656 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,669 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,669 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,670 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,700 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,700 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,700 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,700 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,700 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,700 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,713 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,713 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,714 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,727 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,727 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,727 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,727 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,727 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,727 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,741 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,741 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,741 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,761 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,762 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,762 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,762 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,762 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,762 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,774 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,774 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,774 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,792 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,792 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,792 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,792 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,792 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,792 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,805 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,805 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,805 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,816 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,817 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,817 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,817 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,817 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,817 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,829 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,830 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,830 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,850 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,850 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,850 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,850 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,850 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,850 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,863 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,863 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,863 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,912 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,912 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,912 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,912 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,912 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,912 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,927 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,927 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,927 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,939 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,939 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,939 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,939 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,939 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,939 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,953 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,953 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,953 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,961 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,961 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,961 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,961 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,961 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,961 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:41,975 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:41,975 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:41,975 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:41,994 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:41,994 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:41,994 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:41,994 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:41,994 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:41,994 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,008 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,008 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,008 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,017 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,018 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,018 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,018 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,018 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,018 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,031 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,031 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,031 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,051 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,051 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,051 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,051 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,051 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,051 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,064 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,064 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,064 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,073 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,074 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,074 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,074 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,074 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,074 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,086 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,086 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,086 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,115 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,115 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,115 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,115 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,115 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,115 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,128 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,128 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,128 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,154 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,155 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,155 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,155 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,155 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,155 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,168 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,168 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,168 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,180 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,180 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,180 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,180 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,180 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,180 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,193 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,193 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,193 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,202 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,202 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,202 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,202 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,202 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,202 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,214 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,214 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,215 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,230 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,230 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,231 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,231 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,231 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,231 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,243 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,243 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,243 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,255 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,255 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,255 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,255 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,255 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,255 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,268 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,268 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,268 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,283 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,283 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,283 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,283 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,283 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,283 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,296 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,296 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,296 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,309 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,310 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,310 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,310 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,310 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,310 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,322 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,322 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,322 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,332 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,332 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,332 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,332 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,332 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,332 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,345 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,345 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,345 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,365 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,365 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,365 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,365 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,365 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,365 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,378 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,378 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,378 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,390 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,390 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,390 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,390 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,390 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,390 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,403 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,403 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,403 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,412 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,412 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,412 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,412 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,412 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,412 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,424 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,424 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,425 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,445 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,445 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,446 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,446 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,446 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,446 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,458 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,458 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,459 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,484 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,484 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,484 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,484 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,484 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,484 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,497 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,497 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,497 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,506 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,506 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,506 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,506 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,506 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,506 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,518 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,518 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,518 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,527 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,527 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,527 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,527 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,527 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,527 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,539 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,539 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,539 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,552 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,552 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,552 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,552 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,552 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,552 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,564 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,564 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,564 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,574 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,574 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,574 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,574 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,574 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,574 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,586 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,586 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,586 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,600 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,600 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,600 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,600 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,600 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,600 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,613 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,613 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,613 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,622 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,622 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,622 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,622 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,622 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,622 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,634 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,634 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,634 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,643 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,643 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,643 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,643 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,643 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,643 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,686 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,687 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,687 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,698 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,699 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,699 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,699 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,699 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,699 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,711 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,711 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,711 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,722 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,722 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,722 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,722 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,722 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,722 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,734 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,734 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,734 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,747 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,748 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,748 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,748 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,748 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,748 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,760 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,760 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,760 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,780 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,780 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,780 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,780 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,780 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,780 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,793 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,793 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,793 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,814 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,814 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,814 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,814 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,814 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,814 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,827 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,827 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,827 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,837 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,837 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,837 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,837 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,837 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,837 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,850 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,850 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,850 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,866 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,866 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,866 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,866 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,866 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,866 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,878 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,878 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,879 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,889 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,889 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,889 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,889 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,889 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,889 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,902 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,902 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,902 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,915 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,915 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,915 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,915 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,915 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,915 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,928 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,928 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,928 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,940 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,940 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,940 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,940 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,940 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,940 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,952 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,953 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,953 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,965 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,966 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,966 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,966 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,966 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,966 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:42,978 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:42,978 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:42,979 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:42,987 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:42,987 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:42,987 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:42,987 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:42,987 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:42,987 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,000 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,000 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,000 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,015 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,015 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,015 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,015 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,015 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,015 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,027 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,027 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,028 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,043 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,043 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,043 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,043 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,043 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,044 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,056 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,056 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,056 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,069 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,069 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,069 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,069 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,069 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,069 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,081 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,082 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,082 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,097 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,097 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,097 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,097 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,097 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,097 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,110 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,110 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,110 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,130 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,130 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,130 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,130 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,130 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,130 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,143 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,143 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,143 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,154 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,154 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,154 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,154 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,154 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,154 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,167 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,167 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,167 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,183 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,183 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,183 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,183 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,183 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,183 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,196 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,196 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,196 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,204 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,204 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,204 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,204 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,204 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,204 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,216 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,216 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,216 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,231 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,232 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,232 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,232 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,232 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,232 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,244 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,244 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,244 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,255 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,255 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,255 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,256 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,256 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,256 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,268 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,268 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,268 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,282 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,282 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,282 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,282 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,282 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,282 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,295 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,295 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,295 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,311 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,311 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,311 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,311 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,311 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,311 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,323 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,324 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,324 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,339 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,339 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,339 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,339 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,339 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,339 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,351 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,351 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,352 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,377 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,377 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,378 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,378 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,378 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,378 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,391 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,391 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,391 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,402 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,402 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,402 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,402 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,402 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,402 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,415 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,415 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,415 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,438 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,438 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,439 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,439 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,439 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,439 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,452 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,452 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,452 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,478 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,479 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,479 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,479 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,479 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,479 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,492 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,492 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,492 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,512 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,512 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,512 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,512 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,512 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,512 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,525 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,525 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,525 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,543 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,543 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,543 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,543 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,543 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,543 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,556 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,557 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,557 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,572 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,572 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,572 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,572 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,572 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,572 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,585 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,585 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,585 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,597 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,597 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,597 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,597 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,597 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,597 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,610 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,610 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,610 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,628 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,628 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,628 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,628 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,628 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,628 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,641 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,641 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,641 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,656 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,656 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,656 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,656 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,656 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,656 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,669 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,669 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,669 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,691 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,691 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,691 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,691 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,691 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,691 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,704 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,704 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,705 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,721 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,721 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,721 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,721 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,721 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,721 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,734 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,734 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,734 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,752 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,753 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,753 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,753 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,753 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,753 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,766 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,766 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,766 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,777 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,777 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,777 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,777 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,777 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,777 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,790 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,790 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,790 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,806 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,806 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,806 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,806 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,806 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,806 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,818 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,818 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,819 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,838 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,838 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,838 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,838 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,838 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,838 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,851 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,851 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,851 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,880 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,880 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,880 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,880 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,880 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,880 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,893 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,893 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,893 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,906 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,906 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,906 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,906 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,906 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,906 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,919 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,919 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,919 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,933 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,933 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,933 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,933 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,933 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,933 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,946 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,946 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,946 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,966 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,966 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,966 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,966 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,966 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,966 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:43,979 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:43,979 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:43,979 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:43,991 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:43,991 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:43,991 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:43,991 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:43,991 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:43,991 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,004 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,004 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,004 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,013 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,013 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,013 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,013 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,013 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,013 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,026 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,026 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,026 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,045 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,045 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,045 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,045 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,045 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,045 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,058 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,058 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,058 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,068 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,068 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,068 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,068 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,068 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,068 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,081 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,081 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,081 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,093 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,093 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,093 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,093 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,093 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,093 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,106 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,106 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,106 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,117 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,117 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,117 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,117 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,117 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,117 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,130 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,130 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,130 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,141 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,141 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,141 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,141 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,142 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,142 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,187 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,187 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,187 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,205 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,206 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,206 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,206 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,206 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,206 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,220 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,220 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,220 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,228 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,229 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,229 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,229 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,229 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,229 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,241 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,241 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,241 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,252 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,252 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,252 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,252 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,252 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,252 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,264 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,264 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,264 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,274 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,274 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,274 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,274 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,274 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,274 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,286 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,286 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,287 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,296 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,296 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,296 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,296 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,296 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,296 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,308 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,308 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,309 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,317 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,317 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,317 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,317 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,317 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,317 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,330 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,330 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,330 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,341 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,341 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,341 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,341 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,341 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,341 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,353 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,353 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,353 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,361 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,362 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,362 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,362 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,362 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,362 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,374 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,374 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,374 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,384 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,384 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,384 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,384 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,384 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,384 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,397 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,397 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,397 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,407 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,408 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,408 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,408 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,408 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,408 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,420 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,420 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,420 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,429 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,429 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,429 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,429 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,429 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,429 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,442 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,442 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,442 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,452 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,452 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,452 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,452 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,452 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,452 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,464 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,465 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,465 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,486 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,486 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,486 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,486 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,486 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,486 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,499 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,499 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,499 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,508 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,508 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,508 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,508 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,508 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,508 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,520 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,520 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,520 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,530 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,530 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,530 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,530 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,530 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,530 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,542 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,542 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,543 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,552 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,552 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,552 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,552 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,552 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,552 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,565 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,565 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,565 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,576 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,576 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,576 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,576 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,577 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,577 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,589 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,589 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,589 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,600 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,600 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,600 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,600 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,600 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,600 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,613 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,613 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,613 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,636 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,636 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,637 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,637 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,637 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,637 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,650 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,650 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,650 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,659 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,660 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,660 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,660 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,660 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,660 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,672 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,672 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,672 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,681 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,681 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,681 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,681 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,681 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,681 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,693 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,693 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,694 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,704 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,704 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,704 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,704 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,704 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,704 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,717 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,717 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,717 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,729 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,729 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,729 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,729 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,729 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,729 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,742 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,742 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,742 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,751 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,751 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,751 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,751 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,751 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,751 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,764 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,764 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,764 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,780 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,780 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,780 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,780 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,780 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,780 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,793 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,793 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,793 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,801 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,801 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,801 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,801 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,801 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,801 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,814 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,814 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,814 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,823 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,823 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,823 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,823 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,823 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,823 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,835 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,835 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,836 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,851 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,854 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,854 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,854 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,854 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,858 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,886 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,886 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,887 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,900 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,900 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,900 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,900 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,900 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,901 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,913 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,913 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,913 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,924 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,924 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,924 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,924 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,924 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,924 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,936 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,936 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,936 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,945 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,945 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,945 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,945 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,945 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,945 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,958 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,958 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,958 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,968 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,968 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,968 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,968 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,968 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,968 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:44,980 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:44,980 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:44,981 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:44,989 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:44,989 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:44,989 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:44,989 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:44,989 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:44,989 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:45,003 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:45,003 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:45,003 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:45,012 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:45,012 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:45,012 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:45,012 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:45,012 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:45,012 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:45,025 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:45,025 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:45,025 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:45,035 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:45,036 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:45,036 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:45,036 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:45,036 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:45,036 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:45,048 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:45,048 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:45,049 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:45,059 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:45,059 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:45,060 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:45,060 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:45,060 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:45,060 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:45,072 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:45,072 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:45,073 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:45,089 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:45,089 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:45,089 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:45,089 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:45,089 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:45,090 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:45,102 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:45,102 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:45,102 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:45,111 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:45,112 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:45,112 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:45,112 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:45,112 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:45,112 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:45,124 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:45,124 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:45,124 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:45,133 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:45,133 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:45,133 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:45,133 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:45,133 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:45,133 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:45,146 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:45,146 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:45,146 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:45,155 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:45,156 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:45,156 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:45,156 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:45,156 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:45,156 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:45,168 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:45,168 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:45,168 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:45,176 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:45,176 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:45,176 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:45,176 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:45,176 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:45,176 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:45,188 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:45,189 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:45,189 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:45,198 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:45,198 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:45,198 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:45,198 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:45,198 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:45,198 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:45,210 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:45,210 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:45,211 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:45,221 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:45,221 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:45,221 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:45,221 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:45,221 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:45,221 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:45,233 - consumer.queue_listener - INFO - Received signal 2, initiating graceful shutdown...
2025-12-01 17:57:45,233 - consumer.queue_listener - INFO - Stopping queue listener...
2025-12-01 17:57:45,244 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10608f8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-01 17:57:45,251 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10608f8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-01 17:57:45,251 - consumer.queue_listener - INFO - Channel closed
2025-12-01 17:57:45,251 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-12-01 17:57:45,251 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-12-01 17:57:45,261 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 53650), raddr=('34.196.5.176', 5672)>
2025-12-01 17:57:45,262 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 53650), raddr=('34.196.5.176', 5672)>
2025-12-01 17:57:45,262 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 53650), raddr=('34.196.5.176', 5672)>
2025-12-01 17:57:45,262 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-01 17:57:45,262 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-01 17:57:45,262 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 53650), raddr=('34.196.5.176', 5672)>
2025-12-01 17:57:45,262 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-12-01 17:57:45,262 - consumer.queue_listener - INFO - Connection closed
2025-12-01 17:57:45,262 - consumer.queue_listener - INFO - Queue listener stopped
2025-12-01 17:57:45,262 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:45,262 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:45,262 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:45,264 - consumer.queue_listener - ERROR - Error in consumer: Channel is closed.
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 851, in process_data_events
    self._dispatch_channel_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 567, in _dispatch_channel_events
    impl_channel._get_cookie()._dispatch_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1510, in _dispatch_events
    consumer_info.on_message_callback(self, evt.method,
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
                                      evt.properties, evt.body)
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 164, in _on_message
    channel.basic_nack(delivery_tag=method.delivery_tag, requeue=True)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2151, in basic_nack
    self._impl.basic_nack(
    ~~~~~~~~~~~~~~~~~~~~~^
        delivery_tag=delivery_tag, multiple=multiple, requeue=requeue)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 401, in basic_nack
    self._raise_if_not_open()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 1403, in _raise_if_not_open
    raise exceptions.ChannelWrongStateError('Channel is closed.')
pika.exceptions.ChannelWrongStateError: Channel is closed.
2025-12-01 17:57:45,267 - __main__ - ERROR - Fatal error: Channel is closed.
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/run.py", line 78, in main
    listener.start()
    ~~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 851, in process_data_events
    self._dispatch_channel_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 567, in _dispatch_channel_events
    impl_channel._get_cookie()._dispatch_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1510, in _dispatch_events
    consumer_info.on_message_callback(self, evt.method,
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
                                      evt.properties, evt.body)
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 164, in _on_message
    channel.basic_nack(delivery_tag=method.delivery_tag, requeue=True)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2151, in basic_nack
    self._impl.basic_nack(
    ~~~~~~~~~~~~~~~~~~~~~^
        delivery_tag=delivery_tag, multiple=multiple, requeue=requeue)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 401, in basic_nack
    self._raise_if_not_open()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 1403, in _raise_if_not_open
    raise exceptions.ChannelWrongStateError('Channel is closed.')
pika.exceptions.ChannelWrongStateError: Channel is closed.
2025-12-01 17:57:45,269 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-12-01 17:57:45,269 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-12-01 17:57:45,269 - __main__ - INFO - ============================================================
2025-12-01 17:57:45,269 - __main__ - INFO - Notification Service Stopped
2025-12-01 17:57:45,269 - __main__ - INFO - ============================================================
2025-12-01 17:57:51,329 - __main__ - INFO - ============================================================
2025-12-01 17:57:51,329 - __main__ - INFO - Starting Notification Service
2025-12-01 17:57:51,329 - __main__ - INFO - ============================================================
2025-12-01 17:57:51,329 - __main__ - INFO - Initializing database...
2025-12-01 17:57:51,329 - data.database - INFO - Initializing notification database...
2025-12-01 17:57:51,550 - data.database - INFO - Notification database initialized successfully
2025-12-01 17:57:51,550 - __main__ - INFO - Database initialized successfully
2025-12-01 17:57:51,550 - __main__ - INFO - Starting reminder scheduler...
2025-12-01 17:57:51,550 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-12-01 17:57:51,557 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-12-01 17:57:51,557 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-12-01 17:57:51,557 - apscheduler.scheduler - INFO - Scheduler started
2025-12-01 17:57:51,558 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-12-01 17:57:51,558 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-12-01 17:57:51,558 - __main__ - INFO - Starting queue listener...
2025-12-01 17:57:51,558 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-12-01 17:57:51,558 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-12-01 17:57:51,558 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-12-01 17:57:51,558 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-12-01 17:57:51,565 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-12-01 17:57:51,577 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 54025), raddr=('34.196.5.176', 5672)>
2025-12-01 17:57:51,578 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081bb8c0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081bb8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-12-01 17:57:51,609 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081bb8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 17:57:51,609 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081bb8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 17:57:51,609 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081bb8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 17:57:51,609 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-12-01 17:57:51,640 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-12-01 17:57:51,640 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-12-01 17:57:51,649 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-12-01 17:57:51,659 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:51,659 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:51,659 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:51,659 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:51,755 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:51,756 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:51,770 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:51,770 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:51,770 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:51,784 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:51,784 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:51,784 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:51,784 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:51,784 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:51,784 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:51,797 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:51,797 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:51,797 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:51,807 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:51,807 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:51,807 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:51,807 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:51,807 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:51,807 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:51,820 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:51,820 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:51,820 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:51,829 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:51,829 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:51,829 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:51,829 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:51,829 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:51,829 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:51,842 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:51,842 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:51,842 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:51,851 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:51,851 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:51,851 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:51,852 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:51,852 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:51,852 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:51,864 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:51,864 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:51,864 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:51,874 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:51,874 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:51,874 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:51,874 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:51,874 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:51,874 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:51,886 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:51,886 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:51,886 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:51,896 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:51,896 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:51,896 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:51,896 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:51,896 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:51,896 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:51,909 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:51,909 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:51,909 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:51,922 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:51,923 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:51,923 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:51,923 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:51,923 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:51,923 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:51,939 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:51,939 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:51,939 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:51,949 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:51,949 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:51,949 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:51,949 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:51,949 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:51,949 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:51,961 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:51,961 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:51,962 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:51,971 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:51,971 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:51,971 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:51,971 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:51,971 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:51,971 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:51,984 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:51,984 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:51,984 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:51,996 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:51,996 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:51,996 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:51,996 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:51,996 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:51,996 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,008 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,008 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,009 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,018 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,018 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,018 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,018 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,018 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,018 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,031 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,031 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,031 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,041 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,041 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,041 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,041 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,041 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,041 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,054 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,054 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,054 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,063 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,063 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,063 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,063 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,063 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,063 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,076 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,076 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,076 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,085 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,086 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,086 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,086 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,086 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,086 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,098 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,098 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,099 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,108 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,108 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,108 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,108 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,108 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,108 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,121 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,121 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,121 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,131 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,131 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,131 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,131 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,131 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,131 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,144 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,144 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,144 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,154 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,154 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,154 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,154 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,154 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,154 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,166 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,166 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,167 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,177 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,177 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,178 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,178 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,178 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,178 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,190 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,190 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,190 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,207 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,207 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,207 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,207 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,207 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,207 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,220 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,220 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,220 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,229 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,230 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,230 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,230 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,230 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,230 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,242 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,242 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,242 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,255 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,255 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,255 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,255 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,255 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,255 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,268 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,268 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,268 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,277 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,278 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,278 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,278 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,278 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,278 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,290 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,290 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,290 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,300 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,300 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,300 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,300 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,300 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,300 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,312 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,313 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,313 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,323 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,323 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,323 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,323 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,323 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,323 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,335 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,336 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,336 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,346 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,346 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,346 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,346 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,346 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,346 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,359 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,359 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,359 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,369 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,369 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,369 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,369 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,369 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,370 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,382 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,382 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,382 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,391 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,391 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,391 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,391 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,391 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,391 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,403 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,403 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,403 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,414 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,414 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,414 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,414 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,414 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,414 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,427 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,427 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,427 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,436 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,436 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,436 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,436 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,436 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,436 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,448 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,449 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,449 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,459 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,459 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,459 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,459 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,459 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,459 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,471 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,471 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,471 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,487 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,487 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,487 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,487 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,487 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,487 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,500 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,500 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,500 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,509 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,509 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,509 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,509 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,509 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,509 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,521 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,521 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,521 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,587 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,587 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,587 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,587 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,587 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,587 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,601 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,601 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,601 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,624 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,624 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,624 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,624 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,624 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,624 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,637 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,637 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,638 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,649 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,649 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,649 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,649 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,649 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,649 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,663 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,663 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,663 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,673 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,673 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,673 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,673 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,673 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,673 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,686 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,686 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,686 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,697 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,697 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,697 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,697 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,697 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,697 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,710 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,710 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,710 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,719 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,719 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,719 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,719 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,719 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,719 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,732 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,732 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,732 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,741 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,741 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,741 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,741 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,741 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,741 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,753 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,753 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,754 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,766 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,766 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,766 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,766 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,766 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,766 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,779 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,779 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,779 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,787 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,787 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,787 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,787 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,787 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,787 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,800 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,800 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,800 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,811 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,811 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,811 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,811 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,811 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,812 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,824 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,824 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,824 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,839 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,839 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,839 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,839 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,839 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,839 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,852 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,852 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,852 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,861 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,861 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,861 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,861 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,861 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,861 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,873 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,873 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,873 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,886 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,887 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,887 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,887 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,887 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,887 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,899 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,899 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,899 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,909 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,909 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,909 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,909 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,909 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,909 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,922 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,922 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,922 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,935 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,935 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,935 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,936 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,936 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,936 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,949 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,949 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,949 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,957 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,957 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,957 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,957 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,957 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,957 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,969 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,969 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,969 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:52,979 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:52,979 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:52,979 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:52,979 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:52,979 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:52,979 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:52,992 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:52,992 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:52,992 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,002 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,002 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,002 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,002 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,002 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,002 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,014 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,014 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,014 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,023 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,023 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,023 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,024 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,024 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,024 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,036 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,036 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,036 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,045 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,046 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,046 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,046 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,046 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,046 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,058 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,058 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,058 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,067 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,067 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,067 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,067 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,067 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,067 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,079 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,079 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,080 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,089 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,089 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,089 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,089 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,089 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,089 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,101 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,101 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,101 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,117 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,117 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,117 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,117 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,117 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,117 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,130 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,130 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,130 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,140 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,140 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,140 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,140 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,140 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,140 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,153 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,153 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,153 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,162 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,162 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,162 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,162 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,162 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,162 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,174 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,174 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,174 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,184 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,184 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,184 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,184 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,184 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,184 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,196 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,196 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,197 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,205 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,205 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,206 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,206 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,206 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,206 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,248 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,248 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,248 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,259 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,259 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,259 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,259 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,259 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,259 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,276 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,276 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,276 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,285 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,285 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,285 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,285 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,285 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,285 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,298 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,298 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,298 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,308 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,308 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,308 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,308 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,308 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,308 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,320 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,320 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,320 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,329 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,329 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,329 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,329 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,329 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,329 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,342 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,342 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,342 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,351 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,351 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,351 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,351 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,351 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,351 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,364 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,364 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,364 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,373 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,373 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,373 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,373 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,373 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,373 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,386 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,386 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,386 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,396 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,396 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,396 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,396 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,396 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,396 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,409 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,409 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,409 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,425 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,426 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,426 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,426 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,426 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,426 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,438 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,438 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,438 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,449 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,449 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,449 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,449 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,450 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,450 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,462 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,462 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,462 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,471 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,471 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,471 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,471 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,471 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,471 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,483 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,483 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,483 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,493 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,494 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,494 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,494 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,494 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,494 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,506 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,506 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,507 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,519 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,519 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,519 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,519 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,519 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,519 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,532 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,532 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,532 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,571 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,571 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,571 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,571 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,571 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,571 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,585 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,585 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,585 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,619 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,619 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,619 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,619 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,619 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,619 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,633 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,633 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,634 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,643 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,643 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,643 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,643 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,643 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,643 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,657 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,657 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,657 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,667 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,667 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,667 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,667 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,667 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,667 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,680 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,680 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,680 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,692 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,692 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,692 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,692 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,692 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,692 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,705 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,705 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,705 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,717 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,718 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,718 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,718 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,718 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,718 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,731 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,731 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,731 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,741 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,741 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,741 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,741 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,741 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,741 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,754 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,754 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,754 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,775 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,775 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,775 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,775 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,775 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,775 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,789 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,789 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,790 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,800 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,800 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,800 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,800 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,800 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,800 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,813 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,813 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,813 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,826 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,826 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,826 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,826 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,826 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,826 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,838 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,838 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,839 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,847 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,847 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,847 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,847 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,847 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,847 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,860 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,860 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,860 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,870 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,870 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,870 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,870 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,870 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,870 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,883 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,883 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,883 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,893 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,893 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,893 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,893 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,893 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,893 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,906 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,906 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,906 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,920 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,920 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,920 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,920 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,920 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,920 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,933 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,933 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,933 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,943 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,943 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,943 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,943 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,943 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,943 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,956 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,956 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,956 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,968 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,968 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,968 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,968 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,968 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,968 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:53,981 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:53,981 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:53,981 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:53,991 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:53,991 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:53,991 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:53,991 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:53,992 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:53,992 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:54,004 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:54,004 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:54,004 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:54,014 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:54,014 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:54,014 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:54,014 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:54,014 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:54,014 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:54,026 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:54,027 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:54,027 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:54,037 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:54,037 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:54,037 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:54,037 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:54,037 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:54,037 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:54,050 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:54,050 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:54,050 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:54,067 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:54,067 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:54,067 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:54,067 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:54,067 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:54,067 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:54,080 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:54,080 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:54,080 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:54,089 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:54,089 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:54,089 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:54,089 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:54,089 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:54,089 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:54,101 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:54,101 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:54,102 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:54,112 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:54,112 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:54,112 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:54,112 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:54,112 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:54,112 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:54,125 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:54,125 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:54,125 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:54,133 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:54,133 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:54,133 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:54,133 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:54,133 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:54,133 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:54,145 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:54,145 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:54,145 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:54,153 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:54,153 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:54,153 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:54,153 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:54,153 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:54,153 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:54,166 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:54,166 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:54,166 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:54,363 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:54,364 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:54,364 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:54,364 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:54,364 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:54,364 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:54,387 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:54,387 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:54,387 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:54,398 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:54,398 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:54,398 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:54,398 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:54,398 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:54,398 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:54,416 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:54,416 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:54,416 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:54,431 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:54,432 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:54,432 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:54,432 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:54,432 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:54,432 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:54,447 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:54,448 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:54,448 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:54,488 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 17:57:54,488 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 17:57:54,488 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 17:57:54,488 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 17:57:54,488 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 17:57:54,488 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 17:57:54,503 - consumer.queue_listener - INFO - Received signal 2, initiating graceful shutdown...
2025-12-01 17:57:54,504 - consumer.queue_listener - INFO - Stopping queue listener...
2025-12-01 17:57:54,511 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081bb8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-01 17:57:54,519 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1081bb8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-01 17:57:54,520 - consumer.queue_listener - INFO - Channel closed
2025-12-01 17:57:54,520 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-12-01 17:57:54,520 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-12-01 17:57:54,534 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 54025), raddr=('34.196.5.176', 5672)>
2025-12-01 17:57:54,534 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 54025), raddr=('34.196.5.176', 5672)>
2025-12-01 17:57:54,534 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 54025), raddr=('34.196.5.176', 5672)>
2025-12-01 17:57:54,534 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-01 17:57:54,534 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-01 17:57:54,534 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 54025), raddr=('34.196.5.176', 5672)>
2025-12-01 17:57:54,534 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-12-01 17:57:54,534 - consumer.queue_listener - INFO - Connection closed
2025-12-01 17:57:54,534 - consumer.queue_listener - INFO - Queue listener stopped
2025-12-01 17:57:54,535 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 17:57:54,535 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 17:57:54,535 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 17:57:54,536 - consumer.queue_listener - ERROR - Error in consumer: Channel is closed.
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 851, in process_data_events
    self._dispatch_channel_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 567, in _dispatch_channel_events
    impl_channel._get_cookie()._dispatch_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1510, in _dispatch_events
    consumer_info.on_message_callback(self, evt.method,
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
                                      evt.properties, evt.body)
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 164, in _on_message
    channel.basic_nack(delivery_tag=method.delivery_tag, requeue=True)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2151, in basic_nack
    self._impl.basic_nack(
    ~~~~~~~~~~~~~~~~~~~~~^
        delivery_tag=delivery_tag, multiple=multiple, requeue=requeue)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 401, in basic_nack
    self._raise_if_not_open()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 1403, in _raise_if_not_open
    raise exceptions.ChannelWrongStateError('Channel is closed.')
pika.exceptions.ChannelWrongStateError: Channel is closed.
2025-12-01 17:57:54,540 - __main__ - ERROR - Fatal error: Channel is closed.
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/run.py", line 78, in main
    listener.start()
    ~~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 851, in process_data_events
    self._dispatch_channel_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 567, in _dispatch_channel_events
    impl_channel._get_cookie()._dispatch_events()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1510, in _dispatch_events
    consumer_info.on_message_callback(self, evt.method,
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
                                      evt.properties, evt.body)
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 164, in _on_message
    channel.basic_nack(delivery_tag=method.delivery_tag, requeue=True)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2151, in basic_nack
    self._impl.basic_nack(
    ~~~~~~~~~~~~~~~~~~~~~^
        delivery_tag=delivery_tag, multiple=multiple, requeue=requeue)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 401, in basic_nack
    self._raise_if_not_open()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/channel.py", line 1403, in _raise_if_not_open
    raise exceptions.ChannelWrongStateError('Channel is closed.')
pika.exceptions.ChannelWrongStateError: Channel is closed.
2025-12-01 17:57:54,542 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-12-01 17:57:54,542 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-12-01 17:57:54,542 - __main__ - INFO - ============================================================
2025-12-01 17:57:54,542 - __main__ - INFO - Notification Service Stopped
2025-12-01 17:57:54,542 - __main__ - INFO - ============================================================
2025-12-01 18:00:29,736 - __main__ - INFO - ============================================================
2025-12-01 18:00:29,736 - __main__ - INFO - Starting Notification Service
2025-12-01 18:00:29,736 - __main__ - INFO - ============================================================
2025-12-01 18:00:29,736 - __main__ - INFO - Initializing database...
2025-12-01 18:00:29,736 - data.database - INFO - Initializing notification database...
2025-12-01 18:00:30,001 - data.database - INFO - Notification database initialized successfully
2025-12-01 18:00:30,001 - __main__ - INFO - Database initialized successfully
2025-12-01 18:00:30,001 - __main__ - INFO - Starting reminder scheduler...
2025-12-01 18:00:30,001 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-12-01 18:00:30,010 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-12-01 18:00:30,011 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-12-01 18:00:30,011 - apscheduler.scheduler - INFO - Scheduler started
2025-12-01 18:00:30,011 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-12-01 18:00:30,011 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-12-01 18:00:30,011 - __main__ - INFO - Starting queue listener...
2025-12-01 18:00:30,012 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-12-01 18:00:30,012 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-12-01 18:00:30,012 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-12-01 18:00:30,012 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-12-01 18:00:30,053 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-12-01 18:00:30,063 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 55346), raddr=('34.196.5.176', 5672)>
2025-12-01 18:00:30,064 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10631b8c0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10631b8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-12-01 18:00:30,093 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10631b8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 18:00:30,093 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10631b8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 18:00:30,093 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10631b8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 18:00:30,094 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-12-01 18:00:30,115 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-12-01 18:00:30,116 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-12-01 18:00:30,123 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-12-01 18:00:30,130 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,130 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,130 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,130 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,244 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,244 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,264 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,264 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,264 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,278 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,278 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,278 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,278 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,278 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,278 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,291 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,291 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,291 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,301 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,301 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,301 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,301 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,301 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,301 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,314 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,314 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,314 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,322 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,322 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,322 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,322 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,322 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,322 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,336 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,337 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,337 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,344 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,345 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,345 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,345 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,345 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,345 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,357 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,357 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,358 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,366 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,366 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,366 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,366 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,366 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,366 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,378 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,378 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,379 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,388 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,388 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,388 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,388 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,388 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,388 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,400 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,400 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,401 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,408 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,408 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,408 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,408 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,408 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,408 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,426 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,426 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,426 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,435 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,436 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,436 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,436 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,436 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,436 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,448 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,448 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,448 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,456 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,456 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,456 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,456 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,456 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,456 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,470 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,470 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,470 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,478 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,478 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,478 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,478 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,478 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,478 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,491 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,491 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,491 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,499 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,499 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,499 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,499 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,499 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,499 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,512 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,512 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,512 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,519 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,519 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,519 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,520 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,520 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,520 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,532 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,532 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,532 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,540 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,540 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,540 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,540 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,540 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,540 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,553 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,553 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,553 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,561 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,561 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,561 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,561 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,561 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,561 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,574 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,574 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,574 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,583 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,583 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,583 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,583 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,583 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,583 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,595 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,595 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,596 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,603 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,604 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,604 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,604 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,604 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,604 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,616 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,616 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,617 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,624 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,624 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,624 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,624 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,624 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,624 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,636 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,636 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,636 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,644 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,644 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,644 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,644 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,644 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,644 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,656 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,657 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,657 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,673 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,673 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,673 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,673 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,673 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,673 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,686 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,686 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,686 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,693 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,693 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,693 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,693 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,693 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,693 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,706 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,706 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,706 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,714 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,714 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,714 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,714 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,714 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,714 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,727 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,727 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,727 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,805 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,805 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,805 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,805 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,805 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,805 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,820 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,820 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,820 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,829 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,829 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,829 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,829 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,829 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,829 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,843 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,843 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,843 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,851 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,851 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,851 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,851 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,851 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,851 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,864 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,864 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,864 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,872 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,872 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,872 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,872 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,872 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,873 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,886 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,886 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,886 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,894 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,894 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,894 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,894 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,894 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,894 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,907 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,907 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,907 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,914 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,915 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,915 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,915 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,915 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,915 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,927 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,927 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,927 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,935 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,935 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,935 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,935 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,935 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,935 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,947 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,947 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,947 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,955 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,955 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,955 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,955 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,955 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,955 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,968 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,968 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,968 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:30,975 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:30,976 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:30,976 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:30,976 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:30,976 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:30,976 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:30,988 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:30,988 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:30,988 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,011 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,011 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,011 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,011 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,011 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,011 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,024 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,024 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,024 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,032 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,032 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,032 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,032 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,032 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,032 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,045 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,045 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,045 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,052 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,052 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,052 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,052 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,052 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,052 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,064 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,064 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,064 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,071 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,072 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,072 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,072 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,072 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,072 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,084 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,084 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,084 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,092 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,092 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,092 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,092 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,092 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,092 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,104 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,105 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,105 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,112 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,113 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,113 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,113 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,113 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,113 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,125 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,125 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,125 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,133 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,133 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,133 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,133 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,133 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,133 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,145 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,145 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,145 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,154 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,154 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,154 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,154 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,154 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,154 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,167 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,167 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,167 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,174 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,174 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,174 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,174 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,174 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,174 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,187 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,187 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,187 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,195 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,195 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,195 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,195 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,195 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,195 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,208 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,208 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,208 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,215 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,215 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,215 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,215 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,215 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,215 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,228 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,228 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,228 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,237 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,237 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,237 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,237 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,237 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,237 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,250 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,250 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,250 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,264 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,264 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,264 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,264 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,264 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,264 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,277 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,277 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,277 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,285 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,285 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,285 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,285 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,285 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,285 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,297 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,297 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,297 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,305 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,305 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,305 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,305 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,305 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,305 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,318 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,318 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,318 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,326 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,326 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,326 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,326 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,326 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,326 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,338 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,338 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,339 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,347 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,347 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,348 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,348 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,348 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,348 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,360 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,360 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,360 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,368 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,368 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,368 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,368 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,368 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,368 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,380 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,380 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,380 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,388 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,388 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,388 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,388 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,388 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,388 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,401 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,401 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,401 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,408 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,408 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,408 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,408 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,408 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,408 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,421 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,421 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,421 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,429 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,429 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,429 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,429 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,429 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,429 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,442 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,442 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,442 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,450 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,450 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,450 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,450 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,450 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,450 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,462 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,462 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,462 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,470 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,470 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,470 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,470 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,470 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,470 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,482 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,482 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,482 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,490 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,490 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,490 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,490 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,490 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,490 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,503 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,503 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,503 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,517 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,517 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,517 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,517 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,517 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,517 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,530 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,530 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,530 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,537 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,538 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,538 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,538 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,538 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,538 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,550 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,550 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,550 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,560 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,560 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,560 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,560 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,560 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,560 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,572 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,572 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,572 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,580 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,580 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,580 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,580 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,580 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,580 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,593 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,593 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,593 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,600 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,600 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,600 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,600 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,600 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,600 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,612 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,612 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,613 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,620 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,620 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,620 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,620 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,620 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,620 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,633 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,633 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,633 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,640 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,640 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,640 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,640 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,640 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,640 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,653 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,653 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,653 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,661 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,661 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,661 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,661 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,661 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,661 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,674 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,674 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,674 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,682 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,682 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,682 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,682 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,682 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,682 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,695 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,695 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,695 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,703 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,703 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,703 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,703 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,703 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,703 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,715 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,715 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,715 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,723 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,723 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,723 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,723 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,723 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,724 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,736 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,736 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,736 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,744 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,744 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,744 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,744 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,744 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,744 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,757 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,757 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,757 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,773 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,773 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,773 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,773 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,773 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,773 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,786 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,786 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,786 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,794 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,794 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,794 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,794 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,794 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,794 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,806 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,806 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,807 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,814 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,814 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,814 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,814 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,814 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,814 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,827 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,827 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,827 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,835 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,835 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,835 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,835 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,835 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,835 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,847 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,847 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,847 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,855 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,855 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,855 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,855 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,855 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,855 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,868 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,868 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,868 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,877 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,877 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,877 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,877 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,877 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,877 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,889 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,889 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,889 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,896 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,896 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,896 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,896 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,896 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,896 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,909 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,909 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,909 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,917 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,917 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,917 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,917 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,917 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,917 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,929 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,929 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,929 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,937 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,937 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,937 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,937 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,937 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,937 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,949 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,949 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,949 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,957 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,957 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,957 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,957 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,957 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,957 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,970 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,970 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,970 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,978 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,978 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,978 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,978 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,978 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,978 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:31,990 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:31,991 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:31,991 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:31,998 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:31,998 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:31,998 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:31,998 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:31,998 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:31,998 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,011 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,011 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,011 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,026 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,026 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,026 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,026 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,026 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,026 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,038 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,038 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,039 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,046 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,046 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,047 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,047 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,047 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,047 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,059 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,059 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,059 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,067 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,067 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,067 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,067 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,067 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,067 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,079 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,079 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,079 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,087 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,087 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,087 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,087 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,087 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,087 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,099 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,099 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,100 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,107 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,107 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,107 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,107 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,107 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,107 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,119 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,119 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,119 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,127 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,127 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,127 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,127 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,127 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,127 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,140 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,140 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,140 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,147 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,147 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,147 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,147 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,147 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,147 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,160 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,160 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,160 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,169 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,170 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,170 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,170 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,170 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,170 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,219 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,219 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,219 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,229 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,229 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,229 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,229 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,229 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,229 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,241 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,241 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,242 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,249 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,249 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,249 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,249 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,249 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,249 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,262 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,262 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,262 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,269 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,269 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,269 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,269 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,269 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,269 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,281 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,281 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,281 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,290 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,290 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,290 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,290 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,290 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,290 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,302 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,302 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,303 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,317 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,318 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,318 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,318 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,318 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,318 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,330 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,330 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,330 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,337 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,337 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,337 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,338 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,338 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,338 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,350 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,350 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,350 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,358 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,358 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,358 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,358 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,358 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,358 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,370 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,371 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,371 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,380 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,380 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,380 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,380 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,380 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,380 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,392 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,392 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,393 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,400 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,400 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,400 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,400 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,400 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,400 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,412 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,413 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,413 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,420 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,421 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,421 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,421 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,421 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,421 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,433 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,433 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,433 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,441 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,441 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,441 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,441 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,441 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,441 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,453 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,453 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,454 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,461 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,461 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,461 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,461 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,461 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,461 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,474 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,474 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,474 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,482 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,483 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,483 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,483 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,483 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,483 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,495 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,495 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,495 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,502 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,503 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,503 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,503 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,503 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,503 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,515 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,515 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,515 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,522 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,522 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,523 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,523 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,523 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,523 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,535 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,535 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,535 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,543 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,543 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,543 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,543 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,543 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,543 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,556 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,556 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,556 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,570 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,571 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,571 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,571 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,571 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,571 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,583 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,583 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,583 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,591 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,591 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,591 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,591 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,591 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,591 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,603 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,604 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,604 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,612 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,612 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,612 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,612 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,612 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,612 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,625 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,625 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,625 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,633 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,633 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,633 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,633 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,633 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,633 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,645 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,645 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,645 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,653 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,653 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,653 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,653 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,653 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,653 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,665 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,665 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,665 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,674 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,674 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,674 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,674 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,674 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,674 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,687 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,687 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,687 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,694 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,694 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,694 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,694 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,694 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,694 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,707 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,707 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,707 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,718 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,718 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,718 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,718 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,718 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,718 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,730 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,731 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,731 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,738 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,738 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,738 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,738 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,738 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,738 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,750 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,750 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,751 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,759 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,759 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,759 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,759 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,759 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,759 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,772 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,772 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,772 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,778 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,779 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,779 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,779 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,779 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,779 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,791 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,791 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,791 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,799 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,799 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,799 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,799 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,799 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,799 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,811 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,812 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,812 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,827 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,827 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,827 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,827 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,827 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,827 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,839 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,839 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,840 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,847 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,847 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,847 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,847 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,847 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,847 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,860 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,860 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,860 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,868 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,868 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,868 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,868 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,868 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,868 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,880 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,880 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,880 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,887 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,887 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,887 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,887 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,887 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,887 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,900 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,900 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,900 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,907 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,907 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,907 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,907 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,907 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,907 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,920 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,920 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,920 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,927 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,927 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,927 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,927 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,927 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,927 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,940 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,940 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,940 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,948 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,948 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,948 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,948 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,948 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,948 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,960 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,960 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,960 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,968 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,968 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,968 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,968 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,968 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,968 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:32,980 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:32,981 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:32,981 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:32,988 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:32,988 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:32,988 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:32,988 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:32,988 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:32,988 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,001 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,001 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,001 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,008 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,009 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,009 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,009 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,009 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,009 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,021 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,021 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,021 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,029 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,029 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,029 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,029 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,029 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,029 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,042 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,042 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,042 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,050 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,050 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,050 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,050 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,050 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,050 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,062 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,062 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,062 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,077 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,077 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,077 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,077 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,077 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,077 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,090 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,090 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,090 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,103 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,104 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,104 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,104 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,104 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,104 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,116 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,116 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,116 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,125 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,125 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,125 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,125 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,125 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,125 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,137 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,137 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,137 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,144 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,144 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,144 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,144 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,144 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,144 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,157 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,157 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,157 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,164 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,165 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,165 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,165 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,165 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,165 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,177 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,177 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,177 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,186 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,186 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,186 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,186 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,186 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,186 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,198 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,198 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,198 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,206 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,206 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,206 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,206 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,206 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,206 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,218 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,218 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,218 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,226 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,226 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,226 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,226 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,226 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,226 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,239 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,239 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,239 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,246 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,247 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,247 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,247 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,247 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,247 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,259 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,259 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,260 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,267 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,267 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,267 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,267 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,267 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,267 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,279 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,279 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,279 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,288 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,288 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,288 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,288 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,288 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,288 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,301 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,301 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,301 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,309 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,309 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,309 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,309 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,309 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,309 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,321 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,321 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,321 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,336 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,336 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,336 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,336 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,336 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,336 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,348 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,348 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,348 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,356 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,356 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,356 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,356 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,356 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,356 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,369 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,369 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,369 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,376 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,377 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,377 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,377 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,377 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,377 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,390 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,390 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,390 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,398 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,398 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,398 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,398 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,398 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,398 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,411 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,411 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,411 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,418 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,418 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,418 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,418 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,418 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,418 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,430 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,430 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,431 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,438 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,438 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,439 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,439 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,439 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,439 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,451 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,451 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,451 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,459 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,459 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,459 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,459 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,459 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,459 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,471 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,471 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,471 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,479 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:00:33,479 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:00:33,479 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:00:33,479 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:00:33,479 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:00:33,479 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:00:33,492 - api.booking_client - ERROR - HTTP error fetching booking count: [Errno 61] Connection refused
2025-12-01 18:00:33,492 - data.repository - ERROR - Error counting participants via API: [Errno 61] Connection refused
2025-12-01 18:00:33,492 - consumer.queue_listener - ERROR - Error processing message: [Errno 61] Connection refused
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
        pool_request.request
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_sync/connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_backends/sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
         ~~~~~~~~~~~~~~^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 151, in _on_message
    asyncio.run(self.processor.process(message))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/anaconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/processor/notification_processor.py", line 62, in process
    total_participants = repo.count_participants_by_event(event.event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/data/repository.py", line 73, in count_participants_by_event
    count = self.booking_client.get_bookings_count(event_id)
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/api/booking_client.py", line 55, in get_bookings_count
    response = client.get(url, params=params)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1054, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
2025-12-01 18:00:33,493 - consumer.queue_listener - INFO - Received signal 2, initiating graceful shutdown...
2025-12-01 18:00:33,493 - consumer.queue_listener - INFO - Stopping queue listener...
2025-12-01 18:00:33,507 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10631b8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-01 18:00:33,515 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x10631b8c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-01 18:00:33,515 - consumer.queue_listener - INFO - Channel closed
2025-12-01 18:00:33,515 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-12-01 18:00:33,515 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-12-01 18:00:33,521 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 55346), raddr=('34.196.5.176', 5672)>
2025-12-01 18:00:33,521 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 55346), raddr=('34.196.5.176', 5672)>
2025-12-01 18:00:33,522 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 55346), raddr=('34.196.5.176', 5672)>
2025-12-01 18:00:33,522 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-01 18:00:33,522 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-01 18:00:33,522 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 55346), raddr=('34.196.5.176', 5672)>
2025-12-01 18:00:33,522 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-12-01 18:00:33,522 - consumer.queue_listener - INFO - Connection closed
2025-12-01 18:00:33,522 - consumer.queue_listener - INFO - Queue listener stopped
2025-12-01 18:00:33,522 - consumer.queue_listener - ERROR - Error in consumer: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-12-01 18:00:33,524 - __main__ - ERROR - Fatal error: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/run.py", line 78, in main
    listener.start()
    ~~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-12-01 18:00:33,525 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-12-01 18:00:33,525 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-12-01 18:00:33,525 - __main__ - INFO - ============================================================
2025-12-01 18:00:33,525 - __main__ - INFO - Notification Service Stopped
2025-12-01 18:00:33,525 - __main__ - INFO - ============================================================
2025-12-01 18:02:34,109 - __main__ - INFO - ============================================================
2025-12-01 18:02:34,109 - __main__ - INFO - Starting Notification Service
2025-12-01 18:02:34,109 - __main__ - INFO - ============================================================
2025-12-01 18:02:34,109 - __main__ - INFO - Initializing database...
2025-12-01 18:02:34,109 - data.database - INFO - Initializing notification database...
2025-12-01 18:02:34,303 - data.database - INFO - Notification database initialized successfully
2025-12-01 18:02:34,303 - __main__ - INFO - Database initialized successfully
2025-12-01 18:02:34,303 - __main__ - INFO - Starting reminder scheduler...
2025-12-01 18:02:34,303 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-12-01 18:02:34,310 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-12-01 18:02:34,311 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-12-01 18:02:34,311 - apscheduler.scheduler - INFO - Scheduler started
2025-12-01 18:02:34,311 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-12-01 18:02:34,311 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-12-01 18:02:34,311 - __main__ - INFO - Starting queue listener...
2025-12-01 18:02:34,311 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-12-01 18:02:34,311 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-12-01 18:02:34,311 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-12-01 18:02:34,311 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-12-01 18:02:34,317 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-12-01 18:02:34,325 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 55678), raddr=('34.196.5.176', 5672)>
2025-12-01 18:02:34,326 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103b878c0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103b878c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-12-01 18:02:34,350 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103b878c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 18:02:34,350 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103b878c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 18:02:34,350 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103b878c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 18:02:34,350 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-12-01 18:02:34,382 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-12-01 18:02:34,382 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-12-01 18:02:34,390 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-12-01 18:02:34,397 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "f73dba20-5e86-4bcc-bdc5-8be7385cc06d", "event_name": "football match UMD", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T14:00:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 1}}
2025-12-01 18:02:34,397 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:02:34,397 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD
2025-12-01 18:02:34,397 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:02:34,495 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:02:34,495 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:02:34,767 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d "HTTP/1.1 200 OK"
2025-12-01 18:02:34,767 - api.booking_client - INFO - Retrieved booking count for event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d: 16
2025-12-01 18:02:34,767 - processor.notification_processor - INFO - Step 3: Total participants to process: 16
2025-12-01 18:02:34,823 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-12-01 18:02:34,823 - api.booking_client - INFO - Retrieved 16 bookings for event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, offset=0
2025-12-01 18:02:34,823 - processor.notification_processor - INFO - Step 4: Processing batch 1 (16 participants, offset=0)
2025-12-01 18:02:34,824 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-12-01 18:02:35,538 - email_service.email_service - ERROR - SMTP error: SMTPDataError: (421, '4.3.0 Temporary System Problem. Try again later. For more information, go to\n4.3.0  https://support.google.com/a/answer/3221692 6a1803df08f44-886524af5c9sm92493166d6.10 - gsmtp')
2025-12-01 18:02:35,539 - email_service.email_service - ERROR - Failed to send email to swagh@umd.edu1: (421, '4.3.0 Temporary System Problem. Try again later. For more information, go to\n4.3.0  https://support.google.com/a/answer/3221692 6a1803df08f44-886524af5c9sm92493166d6.10 - gsmtp')
2025-12-01 18:02:35,539 - email_service.email_service - INFO - Retrying email to swagh@umd.edu1 (attempt 1/3)
2025-12-01 18:02:35,541 - email_service.email_service - ERROR - SMTP error: SMTPDataError: (421, '4.3.0 Temporary System Problem. Try again later. For more information, go to\n4.3.0  https://support.google.com/a/answer/3221692 af79cd13be357-8b52a1b7da4sm953856485a.34 - gsmtp')
2025-12-01 18:02:35,541 - email_service.email_service - ERROR - Failed to send email to student1@umd.edu: (421, '4.3.0 Temporary System Problem. Try again later. For more information, go to\n4.3.0  https://support.google.com/a/answer/3221692 af79cd13be357-8b52a1b7da4sm953856485a.34 - gsmtp')
2025-12-01 18:02:35,542 - email_service.email_service - INFO - Retrying email to student1@umd.edu (attempt 1/3)
2025-12-01 18:02:35,607 - email_service.email_service - ERROR - SMTP error: SMTPDataError: (421, '4.3.0 Temporary System Problem. Try again later. For more information, go to\n4.3.0  https://support.google.com/a/answer/3221692 af79cd13be357-8b52a1b74f3sm942008885a.26 - gsmtp')
2025-12-01 18:02:35,607 - email_service.email_service - ERROR - Failed to send email to swagh3@umd.edu: (421, '4.3.0 Temporary System Problem. Try again later. For more information, go to\n4.3.0  https://support.google.com/a/answer/3221692 af79cd13be357-8b52a1b74f3sm942008885a.26 - gsmtp')
2025-12-01 18:02:35,607 - email_service.email_service - INFO - Retrying email to swagh3@umd.edu (attempt 1/3)
2025-12-01 18:02:35,629 - email_service.email_service - ERROR - SMTP error: SMTPDataError: (421, '4.3.0 Temporary System Problem. Try again later. For more information, go to\n4.3.0  https://support.google.com/a/answer/3221692 af79cd13be357-8b52a1ca557sm949754885a.43 - gsmtp')
2025-12-01 18:02:35,629 - email_service.email_service - ERROR - Failed to send email to student1@umd.edu: (421, '4.3.0 Temporary System Problem. Try again later. For more information, go to\n4.3.0  https://support.google.com/a/answer/3221692 af79cd13be357-8b52a1ca557sm949754885a.43 - gsmtp')
2025-12-01 18:02:35,629 - email_service.email_service - INFO - Retrying email to student1@umd.edu (attempt 1/3)
2025-12-01 18:02:36,478 - email_service.email_service - INFO - Email sent successfully to swagh@umd.edu1
2025-12-01 18:02:36,882 - email_service.email_service - INFO - Email sent successfully to swagh3@umd.edu
2025-12-01 18:02:37,090 - email_service.email_service - INFO - Email sent successfully to student1@umd.edu
2025-12-01 18:02:37,512 - email_service.email_service - INFO - Email sent successfully to student1@umd.edu
2025-12-01 18:02:37,763 - email_service.email_service - INFO - Email sent successfully to student1@umd.edu
2025-12-01 18:02:38,131 - email_service.email_service - INFO - Email sent successfully to swagh@umd.edu1
2025-12-01 18:02:38,481 - email_service.email_service - INFO - Email sent successfully to student1@umd.edu
2025-12-01 18:02:39,045 - email_service.email_service - INFO - Email sent successfully to swagh3@umd.edu
2025-12-01 18:02:39,598 - email_service.email_service - INFO - Email sent successfully to student1@umd.edu
2025-12-01 18:02:39,765 - email_service.email_service - INFO - Email sent successfully to swagh@umd.edu1
2025-12-01 18:02:40,260 - email_service.email_service - INFO - Email sent successfully to swagh3@umd.edu
2025-12-01 18:02:40,755 - email_service.email_service - INFO - Email sent successfully to student1@umd.edu
2025-12-01 18:02:41,850 - email_service.email_service - INFO - Email sent successfully to swagh@umd.edu1
2025-12-01 18:02:42,238 - email_service.email_service - INFO - Email sent successfully to student1@umd.edu
2025-12-01 18:02:42,772 - email_service.email_service - INFO - Email sent successfully to swagh3@umd.edu
2025-12-01 18:02:43,067 - email_service.email_service - INFO - Email sent successfully to student1@umd.edu
2025-12-01 18:02:43,068 - email_service.email_service - INFO - Batch email results: 16 successful, 0 failed
2025-12-01 18:02:43,068 - processor.notification_processor - INFO - Batch 1 complete: 16 sent, 0 failed
2025-12-01 18:02:43,108 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-12-01 18:02:43,108 - api.booking_client - INFO - No more bookings available for event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d at offset=100 (404 response)
2025-12-01 18:02:43,109 - processor.notification_processor - INFO - No more participants to process
2025-12-01 18:02:43,109 - processor.notification_processor - INFO - Processing complete for event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d: 16 emails sent successfully, 0 failed out of 16 total
2025-12-01 18:02:43,110 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=f73dba20-5e86-4bcc-bdc5-8be7385cc06d, event_name=football match UMD)
2025-12-01 18:02:43,116 - consumer.queue_listener - INFO - Received message: {"type": "event_updated", "event": {"event_id": "4d0ae379-504c-42ab-a696-720022dfb4bc", "event_name": "football", "description": null, "start_time": "2025-12-01T13:00:00", "end_time": "2025-12-01T13:02:00", "organizer_id": "302a8c20-bec4-4cdc-8f9b-f50efd4aa52f", "location": "College Park, MD", "total_seats": 4}}
2025-12-01 18:02:43,116 - processor.notification_processor - INFO - Processing message: NotificationMessage(type=event_updated, event_id=4d0ae379-504c-42ab-a696-720022dfb4bc, event_name=football)
2025-12-01 18:02:43,117 - processor.notification_processor - INFO - Step 1: Extracted event_type=event_updated, event_id=4d0ae379-504c-42ab-a696-720022dfb4bc, event_name=football
2025-12-01 18:02:43,117 - processor.notification_processor - INFO - Step 2: Loaded template for event_type=event_updated
2025-12-01 18:02:43,117 - api.booking_client - INFO - BookingAPIClient initialized with base_url=http://127.0.0.1:8000, timeout=30s
2025-12-01 18:02:43,117 - data.repository - INFO - ParticipantRepository initialized with API client
2025-12-01 18:02:43,156 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/count?event_id=4d0ae379-504c-42ab-a696-720022dfb4bc "HTTP/1.1 200 OK"
2025-12-01 18:02:43,156 - api.booking_client - INFO - Retrieved booking count for event_id=4d0ae379-504c-42ab-a696-720022dfb4bc: 2
2025-12-01 18:02:43,156 - processor.notification_processor - INFO - Step 3: Total participants to process: 2
2025-12-01 18:02:43,191 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=4d0ae379-504c-42ab-a696-720022dfb4bc&offset=0&batch_size=100 "HTTP/1.1 200 OK"
2025-12-01 18:02:43,191 - api.booking_client - INFO - Retrieved 2 bookings for event_id=4d0ae379-504c-42ab-a696-720022dfb4bc, offset=0
2025-12-01 18:02:43,191 - processor.notification_processor - INFO - Step 4: Processing batch 1 (2 participants, offset=0)
2025-12-01 18:02:43,191 - processor.notification_processor - INFO - Sending emails for batch 1...
2025-12-01 18:02:44,551 - email_service.email_service - INFO - Email sent successfully to swagh6@umd.edu
2025-12-01 18:02:45,134 - email_service.email_service - INFO - Email sent successfully to swagh6@umd.edu
2025-12-01 18:02:45,135 - email_service.email_service - INFO - Batch email results: 2 successful, 0 failed
2025-12-01 18:02:45,135 - processor.notification_processor - INFO - Batch 1 complete: 2 sent, 0 failed
2025-12-01 18:02:45,189 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/bookings/batch?event_id=4d0ae379-504c-42ab-a696-720022dfb4bc&offset=100&batch_size=100 "HTTP/1.1 404 Not Found"
2025-12-01 18:02:45,190 - api.booking_client - INFO - No more bookings available for event_id=4d0ae379-504c-42ab-a696-720022dfb4bc at offset=100 (404 response)
2025-12-01 18:02:45,190 - processor.notification_processor - INFO - No more participants to process
2025-12-01 18:02:45,190 - processor.notification_processor - INFO - Processing complete for event_id=4d0ae379-504c-42ab-a696-720022dfb4bc: 2 emails sent successfully, 0 failed out of 2 total
2025-12-01 18:02:45,191 - consumer.queue_listener - INFO - Message processed and acknowledged: NotificationMessage(type=event_updated, event_id=4d0ae379-504c-42ab-a696-720022dfb4bc, event_name=football)
2025-12-01 18:03:00,004 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:04:00 EST)" (scheduled at 2025-12-01 18:03:00-05:00)
2025-12-01 18:03:00,005 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:03:00,055 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:04:00 EST)" executed successfully
2025-12-01 18:04:00,007 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:05:00 EST)" (scheduled at 2025-12-01 18:04:00-05:00)
2025-12-01 18:04:00,009 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:04:00,061 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:05:00 EST)" executed successfully
2025-12-01 18:05:00,006 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:06:00 EST)" (scheduled at 2025-12-01 18:05:00-05:00)
2025-12-01 18:05:00,009 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:05:00,054 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:06:00 EST)" executed successfully
2025-12-01 18:06:00,022 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:07:00 EST)" (scheduled at 2025-12-01 18:06:00-05:00)
2025-12-01 18:06:00,023 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:06:00,077 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:07:00 EST)" executed successfully
2025-12-01 18:07:00,009 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:08:00 EST)" (scheduled at 2025-12-01 18:07:00-05:00)
2025-12-01 18:07:00,014 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:07:00,063 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:08:00 EST)" executed successfully
2025-12-01 18:08:00,005 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:09:00 EST)" (scheduled at 2025-12-01 18:08:00-05:00)
2025-12-01 18:08:00,009 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:08:00,064 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:09:00 EST)" executed successfully
2025-12-01 18:09:00,005 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:10:00 EST)" (scheduled at 2025-12-01 18:09:00-05:00)
2025-12-01 18:09:00,007 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:09:00,058 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:10:00 EST)" executed successfully
2025-12-01 18:10:00,020 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:11:00 EST)" (scheduled at 2025-12-01 18:10:00-05:00)
2025-12-01 18:10:00,021 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:10:00,061 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:11:00 EST)" executed successfully
2025-12-01 18:10:25,135 - consumer.queue_listener - INFO - Received signal 2, initiating graceful shutdown...
2025-12-01 18:10:25,136 - consumer.queue_listener - INFO - Stopping queue listener...
2025-12-01 18:10:25,145 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103b878c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-01 18:10:25,154 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x103b878c0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-01 18:10:25,154 - consumer.queue_listener - INFO - Channel closed
2025-12-01 18:10:25,154 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-12-01 18:10:25,154 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-12-01 18:10:25,161 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 55678), raddr=('34.196.5.176', 5672)>
2025-12-01 18:10:25,161 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 55678), raddr=('34.196.5.176', 5672)>
2025-12-01 18:10:25,162 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 55678), raddr=('34.196.5.176', 5672)>
2025-12-01 18:10:25,162 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-01 18:10:25,162 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-01 18:10:25,162 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=11, family=2, type=1, proto=6, laddr=('10.3.13.144', 55678), raddr=('34.196.5.176', 5672)>
2025-12-01 18:10:25,163 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-12-01 18:10:25,163 - consumer.queue_listener - INFO - Connection closed
2025-12-01 18:10:25,163 - consumer.queue_listener - INFO - Queue listener stopped
2025-12-01 18:10:25,163 - consumer.queue_listener - ERROR - Error in consumer: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-12-01 18:10:25,170 - __main__ - ERROR - Fatal error: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/run.py", line 78, in main
    listener.start()
    ~~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-12-01 18:10:25,171 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-12-01 18:10:25,171 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-12-01 18:10:25,171 - __main__ - INFO - ============================================================
2025-12-01 18:10:25,171 - __main__ - INFO - Notification Service Stopped
2025-12-01 18:10:25,171 - __main__ - INFO - ============================================================
2025-12-01 18:10:25,202 - asyncio - ERROR - Future exception was never retrieved
future: <Future finished exception=SMTPServerDisconnected('Connection lost')>
aiosmtplib.errors.SMTPServerDisconnected: Connection lost
2025-12-01 18:10:25,202 - asyncio - ERROR - Future exception was never retrieved
future: <Future finished exception=SMTPServerDisconnected('Connection lost')>
aiosmtplib.errors.SMTPServerDisconnected: Connection lost
2025-12-01 18:10:25,202 - asyncio - ERROR - Future exception was never retrieved
future: <Future finished exception=SMTPServerDisconnected('Connection lost')>
aiosmtplib.errors.SMTPServerDisconnected: Connection lost
2025-12-01 18:10:27,231 - __main__ - INFO - ============================================================
2025-12-01 18:10:27,231 - __main__ - INFO - Starting Notification Service
2025-12-01 18:10:27,231 - __main__ - INFO - ============================================================
2025-12-01 18:10:27,231 - __main__ - INFO - Initializing database...
2025-12-01 18:10:27,231 - data.database - INFO - Initializing database...
2025-12-01 18:10:27,461 - data.database - INFO - Database initialized successfully
2025-12-01 18:10:27,461 - __main__ - INFO - Database initialized successfully
2025-12-01 18:10:27,461 - __main__ - INFO - Starting reminder scheduler...
2025-12-01 18:10:27,461 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-12-01 18:10:27,468 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-12-01 18:10:27,469 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-12-01 18:10:27,469 - apscheduler.scheduler - INFO - Scheduler started
2025-12-01 18:10:27,469 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-12-01 18:10:27,469 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-12-01 18:10:27,469 - __main__ - INFO - Starting queue listener...
2025-12-01 18:10:27,469 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-12-01 18:10:27,469 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-12-01 18:10:27,469 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-12-01 18:10:27,469 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-12-01 18:10:27,487 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-12-01 18:10:27,494 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.144', 56600), raddr=('34.196.5.176', 5672)>
2025-12-01 18:10:27,494 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1055d0d70>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1055d0d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-12-01 18:10:27,517 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1055d0d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 18:10:27,518 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1055d0d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 18:10:27,518 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1055d0d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 18:10:27,518 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-12-01 18:10:27,547 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-12-01 18:10:27,547 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-12-01 18:10:27,558 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-12-01 18:10:33,115 - consumer.queue_listener - INFO - Received signal 2, initiating graceful shutdown...
2025-12-01 18:10:33,116 - consumer.queue_listener - INFO - Stopping queue listener...
2025-12-01 18:10:33,541 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1055d0d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-01 18:10:33,548 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1055d0d70> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-01 18:10:33,549 - consumer.queue_listener - INFO - Channel closed
2025-12-01 18:10:33,549 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-12-01 18:10:33,549 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-12-01 18:10:33,558 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.144', 56600), raddr=('34.196.5.176', 5672)>
2025-12-01 18:10:33,558 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.144', 56600), raddr=('34.196.5.176', 5672)>
2025-12-01 18:10:33,558 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.144', 56600), raddr=('34.196.5.176', 5672)>
2025-12-01 18:10:33,559 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-01 18:10:33,559 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-01 18:10:33,560 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.144', 56600), raddr=('34.196.5.176', 5672)>
2025-12-01 18:10:33,560 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-12-01 18:10:33,560 - consumer.queue_listener - INFO - Connection closed
2025-12-01 18:10:33,561 - consumer.queue_listener - INFO - Queue listener stopped
2025-12-01 18:10:33,561 - consumer.queue_listener - ERROR - Error in consumer: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-12-01 18:10:33,567 - __main__ - ERROR - Fatal error: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/run.py", line 78, in main
    listener.start()
    ~~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-12-01 18:10:33,569 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-12-01 18:10:33,570 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-12-01 18:10:33,570 - __main__ - INFO - ============================================================
2025-12-01 18:10:33,570 - __main__ - INFO - Notification Service Stopped
2025-12-01 18:10:33,570 - __main__ - INFO - ============================================================
2025-12-01 18:10:39,355 - __main__ - INFO - ============================================================
2025-12-01 18:10:39,355 - __main__ - INFO - Starting Notification Service
2025-12-01 18:10:39,355 - __main__ - INFO - ============================================================
2025-12-01 18:10:39,355 - __main__ - INFO - Initializing database...
2025-12-01 18:10:39,355 - data.database - INFO - Initializing database...
2025-12-01 18:10:39,556 - data.database - INFO - Database initialized successfully
2025-12-01 18:10:39,556 - __main__ - INFO - Database initialized successfully
2025-12-01 18:10:39,556 - __main__ - INFO - Starting reminder scheduler...
2025-12-01 18:10:39,556 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-12-01 18:10:39,561 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-12-01 18:10:39,562 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-12-01 18:10:39,562 - apscheduler.scheduler - INFO - Scheduler started
2025-12-01 18:10:39,562 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-12-01 18:10:39,562 - __main__ - INFO - Reminder scheduler started (runs every 1 minute)
2025-12-01 18:10:39,563 - __main__ - INFO - Starting queue listener...
2025-12-01 18:10:39,563 - email_service.email_service - INFO - Email service initialized with SMTP: smtp.gmail.com:587
2025-12-01 18:10:39,563 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-12-01 18:10:39,563 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-12-01 18:10:39,563 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-12-01 18:10:39,570 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-12-01 18:10:39,576 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.144', 56622), raddr=('34.196.5.176', 5672)>
2025-12-01 18:10:39,577 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108124ad0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108124ad0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-12-01 18:10:39,601 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108124ad0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 18:10:39,601 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108124ad0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 18:10:39,601 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108124ad0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-01 18:10:39,601 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-12-01 18:10:39,622 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-12-01 18:10:39,622 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-12-01 18:10:39,630 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-12-01 18:11:00,006 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:12:00 EST)" (scheduled at 2025-12-01 18:11:00-05:00)
2025-12-01 18:11:00,008 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:11:00,072 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:12:00 EST)" executed successfully
2025-12-01 18:12:00,023 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:13:00 EST)" (scheduled at 2025-12-01 18:12:00-05:00)
2025-12-01 18:12:00,035 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:12:00,103 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:13:00 EST)" executed successfully
2025-12-01 18:13:00,006 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:14:00 EST)" (scheduled at 2025-12-01 18:13:00-05:00)
2025-12-01 18:13:00,008 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:13:00,059 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:14:00 EST)" executed successfully
2025-12-01 18:14:00,017 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:15:00 EST)" (scheduled at 2025-12-01 18:14:00-05:00)
2025-12-01 18:14:00,024 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:14:00,076 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:15:00 EST)" executed successfully
2025-12-01 18:15:00,017 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:16:00 EST)" (scheduled at 2025-12-01 18:15:00-05:00)
2025-12-01 18:15:00,018 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:15:00,061 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:16:00 EST)" executed successfully
2025-12-01 18:16:00,007 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:17:00 EST)" (scheduled at 2025-12-01 18:16:00-05:00)
2025-12-01 18:16:00,009 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:16:00,052 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:17:00 EST)" executed successfully
2025-12-01 18:17:00,005 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:18:00 EST)" (scheduled at 2025-12-01 18:17:00-05:00)
2025-12-01 18:17:00,007 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:17:00,062 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:18:00 EST)" executed successfully
2025-12-01 18:18:00,003 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:19:00 EST)" (scheduled at 2025-12-01 18:18:00-05:00)
2025-12-01 18:18:00,004 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:18:00,043 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:19:00 EST)" executed successfully
2025-12-01 18:19:00,004 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:20:00 EST)" (scheduled at 2025-12-01 18:19:00-05:00)
2025-12-01 18:19:00,006 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:19:00,062 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:20:00 EST)" executed successfully
2025-12-01 18:20:00,003 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:21:00 EST)" (scheduled at 2025-12-01 18:20:00-05:00)
2025-12-01 18:20:00,009 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:20:00,057 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:21:00 EST)" executed successfully
2025-12-01 18:21:00,004 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:22:00 EST)" (scheduled at 2025-12-01 18:21:00-05:00)
2025-12-01 18:21:00,005 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-01 18:21:00,048 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-01 18:22:00 EST)" executed successfully
2025-12-01 18:21:40,809 - consumer.queue_listener - INFO - Received signal 2, initiating graceful shutdown...
2025-12-01 18:21:40,810 - consumer.queue_listener - INFO - Stopping queue listener...
2025-12-01 18:21:40,823 - pika.channel - INFO - Closing channel (0): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108124ad0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-01 18:21:40,858 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x108124ad0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-01 18:21:40,858 - consumer.queue_listener - INFO - Channel closed
2025-12-01 18:21:40,858 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-12-01 18:21:40,858 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-12-01 18:21:40,875 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.144', 56622), raddr=('34.196.5.176', 5672)>
2025-12-01 18:21:40,876 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.144', 56622), raddr=('34.196.5.176', 5672)>
2025-12-01 18:21:40,876 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.144', 56622), raddr=('34.196.5.176', 5672)>
2025-12-01 18:21:40,878 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-01 18:21:40,878 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-01 18:21:40,879 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=12, family=2, type=1, proto=6, laddr=('10.3.13.144', 56622), raddr=('34.196.5.176', 5672)>
2025-12-01 18:21:40,879 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-12-01 18:21:40,879 - consumer.queue_listener - INFO - Connection closed
2025-12-01 18:21:40,879 - consumer.queue_listener - INFO - Queue listener stopped
2025-12-01 18:21:40,879 - consumer.queue_listener - ERROR - Error in consumer: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-12-01 18:21:40,887 - __main__ - ERROR - Fatal error: [Errno 9] Bad file descriptor
Traceback (most recent call last):
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/run.py", line 78, in main
    listener.start()
    ~~~~~~~~~~~~~~^^
  File "/Users/chetankumar/Documents/3rd sem/613/Projects/Notification_Code/notification-service/consumer/queue_listener.py", line 184, in start
    self.channel.start_consuming()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 1883, in start_consuming
    self._process_data_events(time_limit=None)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 2044, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 842, in process_data_events
    self._flush_output(common_terminator)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/blocking_connection.py", line 514, in _flush_output
    self._impl.ioloop.poll()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 579, in poll
    self._poller.poll()
    ~~~~~~~~~~~~~~~~~^^
  File "/opt/anaconda3/lib/python3.13/site-packages/pika/adapters/select_connection.py", line 1064, in poll
    kevents = self._kqueue.control(None, 1000, self._get_max_wait())
OSError: [Errno 9] Bad file descriptor
2025-12-01 18:21:40,889 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-12-01 18:21:40,889 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-12-01 18:21:40,889 - __main__ - INFO - ============================================================
2025-12-01 18:21:40,889 - __main__ - INFO - Notification Service Stopped
2025-12-01 18:21:40,889 - __main__ - INFO - ============================================================
2025-12-02 15:31:00,492 - api.main - INFO - Notification Service API started
2025-12-02 15:31:00,493 - __main__ - INFO - Initializing background services...
2025-12-02 15:31:00,493 - __main__ - INFO - Initializing database...
2025-12-02 15:31:00,493 - data.database - INFO - Initializing database...
2025-12-02 15:31:01,022 - data.database - INFO - Database initialized successfully
2025-12-02 15:31:01,023 - __main__ - INFO - Starting reminder scheduler...
2025-12-02 15:31:01,023 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-12-02 15:31:01,034 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-12-02 15:31:01,036 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-12-02 15:31:01,036 - apscheduler.scheduler - INFO - Scheduler started
2025-12-02 15:31:01,036 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-12-02 15:31:01,036 - __main__ - INFO - Starting queue listener...
2025-12-02 15:31:01,037 - email_service.email_service - INFO - Email service initialized with provider: SMTP (smtp.gmail.com:587)
2025-12-02 15:31:01,037 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-12-02 15:31:01,037 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-12-02 15:31:01,037 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-12-02 15:31:01,037 - __main__ - INFO - Queue listener started in background thread
2025-12-02 15:31:01,037 - main - INFO - Initializing background services...
2025-12-02 15:31:01,038 - main - INFO - Initializing database...
2025-12-02 15:31:01,038 - data.database - INFO - Initializing database...
2025-12-02 15:31:01,069 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-12-02 15:31:01,078 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=15, family=2, type=1, proto=6, laddr=('10.3.13.144', 54980), raddr=('34.196.5.176', 5672)>
2025-12-02 15:31:01,079 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053d1a90>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053d1a90> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-12-02 15:31:01,102 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053d1a90> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-02 15:31:01,102 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053d1a90> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-02 15:31:01,102 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053d1a90> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-02 15:31:01,102 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-12-02 15:31:01,119 - data.database - INFO - Database initialized successfully
2025-12-02 15:31:01,119 - main - INFO - Starting reminder scheduler...
2025-12-02 15:31:01,119 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-12-02 15:31:01,119 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-12-02 15:31:01,119 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-12-02 15:31:01,120 - apscheduler.scheduler - INFO - Scheduler started
2025-12-02 15:31:01,120 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-12-02 15:31:01,120 - main - INFO - Starting queue listener...
2025-12-02 15:31:01,120 - email_service.email_service - INFO - Email service initialized with provider: SMTP (smtp.gmail.com:587)
2025-12-02 15:31:01,120 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-12-02 15:31:01,120 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-12-02 15:31:01,120 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-12-02 15:31:01,120 - main - INFO - Queue listener started in background thread
2025-12-02 15:31:01,122 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-12-02 15:31:01,127 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-12-02 15:31:01,127 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-12-02 15:31:01,130 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=20, family=2, type=1, proto=6, laddr=('10.3.13.144', 54983), raddr=('34.196.5.176', 5672)>
2025-12-02 15:31:01,130 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053ce710>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053ce710> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-12-02 15:31:01,141 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-12-02 15:31:01,154 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053ce710> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-02 15:31:01,154 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053ce710> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-02 15:31:01,154 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053ce710> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-02 15:31:01,154 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-12-02 15:31:01,177 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-12-02 15:31:01,177 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-12-02 15:31:01,185 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-12-02 15:32:00,007 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-02 15:33:00 EST)" (scheduled at 2025-12-02 15:32:00-05:00)
2025-12-02 15:32:00,010 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-02 15:33:00 EST)" (scheduled at 2025-12-02 15:32:00-05:00)
2025-12-02 15:32:00,011 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-02 15:32:00,011 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-02 15:32:00,084 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-02 15:33:00 EST)" executed successfully
2025-12-02 15:32:00,170 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-02 15:33:00 EST)" executed successfully
2025-12-02 15:32:11,372 - api.main - INFO - Notification Service API shutting down
2025-12-02 15:32:11,373 - __main__ - INFO - Shutting down background services...
2025-12-02 15:32:11,373 - __main__ - INFO - Stopping scheduler...
2025-12-02 15:32:11,373 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-12-02 15:32:11,373 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-12-02 15:32:11,373 - __main__ - INFO - Stopping queue listener...
2025-12-02 15:32:11,373 - consumer.queue_listener - INFO - Stopping queue listener...
2025-12-02 15:32:11,382 - consumer.queue_listener - INFO - Channel stop_consuming called
2025-12-02 15:32:11,382 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-12-02 15:32:11,382 - pika.channel - INFO - Closing channel (200): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053d1a90> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-02 15:32:11,389 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053d1a90> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-02 15:32:11,389 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-12-02 15:32:11,396 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=15, family=2, type=1, proto=6, laddr=('10.3.13.144', 54980), raddr=('34.196.5.176', 5672)>
2025-12-02 15:32:11,396 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=15, family=2, type=1, proto=6, laddr=('10.3.13.144', 54980), raddr=('34.196.5.176', 5672)>
2025-12-02 15:32:11,396 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=15, family=2, type=1, proto=6, laddr=('10.3.13.144', 54980), raddr=('34.196.5.176', 5672)>
2025-12-02 15:32:11,397 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-02 15:32:11,397 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-02 15:32:11,397 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=15, family=2, type=1, proto=6, laddr=('10.3.13.144', 54980), raddr=('34.196.5.176', 5672)>
2025-12-02 15:32:11,397 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-12-02 15:32:11,397 - consumer.queue_listener - INFO - Connection closed in start() finally block
2025-12-02 15:32:11,397 - __main__ - INFO - Queue listener thread stopped
2025-12-02 15:32:11,397 - main - INFO - Shutting down background services...
2025-12-02 15:32:11,397 - main - INFO - Stopping scheduler...
2025-12-02 15:32:11,398 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-12-02 15:32:11,398 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-12-02 15:32:11,398 - main - INFO - Stopping queue listener...
2025-12-02 15:32:11,398 - consumer.queue_listener - INFO - Stopping queue listener...
2025-12-02 15:32:11,406 - consumer.queue_listener - INFO - Channel stop_consuming called
2025-12-02 15:32:11,406 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-12-02 15:32:11,406 - pika.channel - INFO - Closing channel (200): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053ce710> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-02 15:32:11,421 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x1053ce710> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-02 15:32:11,421 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-12-02 15:32:11,430 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=20, family=2, type=1, proto=6, laddr=('10.3.13.144', 54983), raddr=('34.196.5.176', 5672)>
2025-12-02 15:32:11,430 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=20, family=2, type=1, proto=6, laddr=('10.3.13.144', 54983), raddr=('34.196.5.176', 5672)>
2025-12-02 15:32:11,430 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=20, family=2, type=1, proto=6, laddr=('10.3.13.144', 54983), raddr=('34.196.5.176', 5672)>
2025-12-02 15:32:11,434 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-02 15:32:11,434 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-02 15:32:11,434 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=20, family=2, type=1, proto=6, laddr=('10.3.13.144', 54983), raddr=('34.196.5.176', 5672)>
2025-12-02 15:32:11,435 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-12-02 15:32:11,435 - consumer.queue_listener - INFO - Connection closed in start() finally block
2025-12-02 15:32:11,436 - main - INFO - Queue listener thread stopped
2025-12-02 15:44:50,843 - api.main - INFO - Notification Service API started
2025-12-02 15:44:50,843 - __main__ - INFO - Initializing background services...
2025-12-02 15:44:50,843 - __main__ - INFO - Initializing database...
2025-12-02 15:44:50,843 - data.database - INFO - Initializing database...
2025-12-02 15:44:51,260 - data.database - INFO - Database initialized successfully
2025-12-02 15:44:51,260 - __main__ - INFO - Starting reminder scheduler...
2025-12-02 15:44:51,260 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-12-02 15:44:51,275 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-12-02 15:44:51,275 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-12-02 15:44:51,275 - apscheduler.scheduler - INFO - Scheduler started
2025-12-02 15:44:51,276 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-12-02 15:44:51,276 - __main__ - INFO - Starting queue listener...
2025-12-02 15:44:51,301 - email_service.email_service - INFO - Email service initialized with provider: SendGrid (HTTP API)
2025-12-02 15:44:51,301 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-12-02 15:44:51,301 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-12-02 15:44:51,301 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-12-02 15:44:51,301 - __main__ - INFO - Queue listener started in background thread
2025-12-02 15:44:51,301 - main - INFO - Initializing background services...
2025-12-02 15:44:51,301 - main - INFO - Initializing database...
2025-12-02 15:44:51,301 - data.database - INFO - Initializing database...
2025-12-02 15:44:51,330 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-12-02 15:44:51,337 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=15, family=2, type=1, proto=6, laddr=('10.3.13.144', 58706), raddr=('34.196.5.176', 5672)>
2025-12-02 15:44:51,338 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105358ec0>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105358ec0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-12-02 15:44:51,364 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105358ec0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-02 15:44:51,364 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105358ec0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-02 15:44:51,364 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105358ec0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-02 15:44:51,364 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-12-02 15:44:51,374 - data.database - INFO - Database initialized successfully
2025-12-02 15:44:51,374 - main - INFO - Starting reminder scheduler...
2025-12-02 15:44:51,375 - scheduler.reminder_scheduler - INFO - Starting reminder scheduler...
2025-12-02 15:44:51,375 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-12-02 15:44:51,375 - apscheduler.scheduler - INFO - Added job "Check Event Reminders" to job store "default"
2025-12-02 15:44:51,375 - apscheduler.scheduler - INFO - Scheduler started
2025-12-02 15:44:51,375 - scheduler.reminder_scheduler - INFO - Reminder scheduler started with cron: * * * * *
2025-12-02 15:44:51,375 - main - INFO - Starting queue listener...
2025-12-02 15:44:51,375 - email_service.email_service - INFO - Email service initialized with provider: SendGrid (HTTP API)
2025-12-02 15:44:51,375 - processor.notification_processor - INFO - NotificationProcessor initialized with batch_size=100
2025-12-02 15:44:51,375 - consumer.queue_listener - INFO - QueueListener initialized for queue: notification
2025-12-02 15:44:51,376 - consumer.queue_listener - INFO - Connecting to LavinMQ at possum.lmq.cloudamqp.com:5672...
2025-12-02 15:44:51,376 - main - INFO - Queue listener started in background thread
2025-12-02 15:44:51,377 - pika.adapters.utils.connection_workflow - INFO - Pika version 1.3.2 connecting to ('34.196.5.176', 5672)
2025-12-02 15:44:51,385 - pika.adapters.utils.io_services_utils - INFO - Socket connected: <socket.socket fd=20, family=2, type=1, proto=6, laddr=('10.3.13.144', 58709), raddr=('34.196.5.176', 5672)>
2025-12-02 15:44:51,386 - pika.adapters.utils.connection_workflow - INFO - Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105378f50>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105378f50> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>).
2025-12-02 15:44:51,386 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-12-02 15:44:51,386 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-12-02 15:44:51,394 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-12-02 15:44:51,409 - pika.adapters.utils.connection_workflow - INFO - AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105378f50> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-02 15:44:51,409 - pika.adapters.utils.connection_workflow - INFO - AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105378f50> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-02 15:44:51,409 - pika.adapters.blocking_connection - INFO - Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105378f50> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>
2025-12-02 15:44:51,409 - pika.adapters.blocking_connection - INFO - Created channel=1
2025-12-02 15:44:51,432 - consumer.queue_listener - INFO - Successfully connected to LavinMQ
2025-12-02 15:44:51,432 - consumer.queue_listener - INFO - Starting to consume messages from queue: notification
2025-12-02 15:44:51,439 - consumer.queue_listener - INFO - Waiting for messages. Press CTRL+C to exit.
2025-12-02 15:45:00,002 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-02 15:46:00 EST)" (scheduled at 2025-12-02 15:45:00-05:00)
2025-12-02 15:45:00,002 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-02 15:45:00,005 - apscheduler.executors.default - INFO - Running job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-02 15:46:00 EST)" (scheduled at 2025-12-02 15:45:00-05:00)
2025-12-02 15:45:00,005 - scheduler.reminder_scheduler - INFO - Checking for pending event reminders...
2025-12-02 15:45:00,048 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-02 15:46:00 EST)" executed successfully
2025-12-02 15:45:00,121 - apscheduler.executors.default - INFO - Job "Check Event Reminders (trigger: cron[month='*', day='*', day_of_week='*', hour='*', minute='*'], next run at: 2025-12-02 15:46:00 EST)" executed successfully
2025-12-02 15:45:05,134 - api.main - INFO - Notification Service API shutting down
2025-12-02 15:45:05,135 - __main__ - INFO - Shutting down background services...
2025-12-02 15:45:05,135 - __main__ - INFO - Stopping scheduler...
2025-12-02 15:45:05,135 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-12-02 15:45:05,136 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-12-02 15:45:05,136 - __main__ - INFO - Stopping queue listener...
2025-12-02 15:45:05,136 - consumer.queue_listener - INFO - Stopping queue listener...
2025-12-02 15:45:05,145 - consumer.queue_listener - INFO - Channel stop_consuming called
2025-12-02 15:45:05,145 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-12-02 15:45:05,145 - pika.channel - INFO - Closing channel (200): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105358ec0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-02 15:45:05,155 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105358ec0> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-02 15:45:05,156 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-12-02 15:45:05,165 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=15, family=2, type=1, proto=6, laddr=('10.3.13.144', 58706), raddr=('34.196.5.176', 5672)>
2025-12-02 15:45:05,165 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=15, family=2, type=1, proto=6, laddr=('10.3.13.144', 58706), raddr=('34.196.5.176', 5672)>
2025-12-02 15:45:05,165 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=15, family=2, type=1, proto=6, laddr=('10.3.13.144', 58706), raddr=('34.196.5.176', 5672)>
2025-12-02 15:45:05,165 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-02 15:45:05,166 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-02 15:45:05,170 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=15, family=2, type=1, proto=6, laddr=('10.3.13.144', 58706), raddr=('34.196.5.176', 5672)>
2025-12-02 15:45:05,171 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-12-02 15:45:05,171 - consumer.queue_listener - INFO - Connection closed in start() finally block
2025-12-02 15:45:05,172 - __main__ - INFO - Queue listener thread stopped
2025-12-02 15:45:05,172 - main - INFO - Shutting down background services...
2025-12-02 15:45:05,172 - main - INFO - Stopping scheduler...
2025-12-02 15:45:05,172 - apscheduler.scheduler - INFO - Scheduler has been shut down
2025-12-02 15:45:05,173 - scheduler.reminder_scheduler - INFO - Reminder scheduler stopped
2025-12-02 15:45:05,173 - main - INFO - Stopping queue listener...
2025-12-02 15:45:05,173 - consumer.queue_listener - INFO - Stopping queue listener...
2025-12-02 15:45:05,180 - consumer.queue_listener - INFO - Channel stop_consuming called
2025-12-02 15:45:05,180 - pika.adapters.blocking_connection - INFO - Closing connection (200): Normal shutdown
2025-12-02 15:45:05,181 - pika.channel - INFO - Closing channel (200): 'Normal shutdown' on <Channel number=1 OPEN conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105378f50> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-02 15:45:05,191 - pika.channel - INFO - Received <Channel.CloseOk> on <Channel number=1 CLOSING conn=<SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncPlaintextTransport object at 0x105378f50> params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>>
2025-12-02 15:45:05,191 - pika.connection - INFO - Closing connection (200): 'Normal shutdown'
2025-12-02 15:45:05,199 - pika.adapters.utils.io_services_utils - INFO - Aborting transport connection: state=1; <socket.socket fd=20, family=2, type=1, proto=6, laddr=('10.3.13.144', 58709), raddr=('34.196.5.176', 5672)>
2025-12-02 15:45:05,200 - pika.adapters.utils.io_services_utils - INFO - _AsyncTransportBase._initate_abort(): Initiating abrupt asynchronous transport shutdown: state=1; error=None; <socket.socket fd=20, family=2, type=1, proto=6, laddr=('10.3.13.144', 58709), raddr=('34.196.5.176', 5672)>
2025-12-02 15:45:05,200 - pika.adapters.utils.io_services_utils - INFO - Deactivating transport: state=1; <socket.socket fd=20, family=2, type=1, proto=6, laddr=('10.3.13.144', 58709), raddr=('34.196.5.176', 5672)>
2025-12-02 15:45:05,200 - pika.connection - INFO - AMQP stack terminated, failed to connect, or aborted: opened=True, error-arg=None; pending-error=ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-02 15:45:05,200 - pika.connection - INFO - Stack terminated due to ConnectionClosedByClient: (200) 'Normal shutdown'
2025-12-02 15:45:05,200 - pika.adapters.utils.io_services_utils - INFO - Closing transport socket and unlinking: state=3; <socket.socket fd=20, family=2, type=1, proto=6, laddr=('10.3.13.144', 58709), raddr=('34.196.5.176', 5672)>
2025-12-02 15:45:05,200 - pika.adapters.blocking_connection - INFO - User-initiated close: result=BlockingConnection__OnClosedArgs(connection=<SelectConnection CLOSED transport=None params=<ConnectionParameters host=possum.lmq.cloudamqp.com port=5672 virtual_host=tbgpqjjh ssl=False>>, error=ConnectionClosedByClient: (200) 'Normal shutdown')
2025-12-02 15:45:05,200 - consumer.queue_listener - INFO - Connection closed in start() finally block
2025-12-02 15:45:05,200 - main - INFO - Queue listener thread stopped
